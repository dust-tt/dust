{"version":3,"sources":["../src/index.tsx","../src/ui/App.tsx","../src/utils/dustClient.ts","../src/utils/authService.ts","../src/utils/errors.ts","../src/utils/tokenStorage.ts","../src/ui/Auth.tsx","../src/ui/Chat.tsx","../src/utils/streamCompletion.ts","../src/agent/loop.ts","../src/agent/systemPrompt.ts","../src/tools/readFile.ts","../src/utils/fileHandling.ts","../src/tools/writeFile.ts","../src/tools/editFile.ts","../src/tools/bash.ts","../src/tools/glob.ts","../src/tools/grep.ts","../src/utils/grep.ts","../src/tools/askUser.ts","../src/tools/task.ts","../src/tools/index.ts","../src/ui/InputBox.tsx","../src/ui/CommandSelector.tsx","../src/ui/ToolApprovalSelector.tsx","../src/ui/ToolExecution.tsx","../src/ui/WelcomeHeader.tsx","../src/ui/commands/types.ts","../src/ui/WorkspaceSelector.tsx"],"sourcesContent":["#!/usr/bin/env node\n\nimport React from \"react\";\nimport { render } from \"ink\";\nimport meow from \"meow\";\n\nimport { App } from \"./ui/App.js\";\n\nconst cli = meow(\n  `\n  Usage\n    $ dust-code [prompt]\n\n  Options\n    --api-key   Dust API key (or set DUST_API_KEY env var)\n    --wId       Workspace ID (or set DUST_WORKSPACE_ID env var)\n    --cwd       Working directory (default: current directory)\n\n  Examples\n    $ dust-code\n    $ dust-code \"Fix the failing tests in src/utils/\"\n    $ dust-code --api-key sk-xxx --wId abc123 \"Explain the codebase\"\n`,\n  {\n    importMeta: import.meta,\n    flags: {\n      apiKey: {\n        type: \"string\",\n      },\n      wId: {\n        type: \"string\",\n      },\n      cwd: {\n        type: \"string\",\n        default: process.cwd(),\n      },\n    },\n  }\n);\n\nconst initialPrompt = cli.input.join(\" \") || undefined;\nconst cwd = cli.flags.cwd;\n\nrender(\n  <App\n    cwd={cwd}\n    initialPrompt={initialPrompt}\n    apiKey={cli.flags.apiKey}\n    wId={cli.flags.wId}\n  />\n);\n","import type { DustAPI } from \"@dust-tt/client\";\nimport { Box, Text } from \"ink\";\nimport Spinner from \"ink-spinner\";\nimport React, { useState, useCallback, useEffect } from \"react\";\n\nimport { getDustClient, resetDustClient } from \"../utils/dustClient.js\";\nimport AuthService from \"../utils/authService.js\";\nimport TokenStorage from \"../utils/tokenStorage.js\";\nimport { Auth } from \"./Auth.js\";\nimport { Chat } from \"./Chat.js\";\nimport { WorkspaceSelector } from \"./WorkspaceSelector.js\";\n\ntype AppState = \"checking\" | \"auth\" | \"select_workspace\" | \"ready\" | \"error\";\n\ninterface AppProps {\n  cwd: string;\n  initialPrompt?: string;\n  apiKey?: string;\n  wId?: string;\n}\n\nexport function App({ cwd, initialPrompt, apiKey, wId }: AppProps) {\n  const [state, setState] = useState<AppState>(\"checking\");\n  const [dustClient, setDustClient] = useState<DustAPI | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const initializeClient = useCallback(async () => {\n    // Check if we have a real workspace selected (not \"me\").\n    const workspaceId = await TokenStorage.getWorkspaceId();\n    if (!workspaceId || workspaceId === \"me\") {\n      setState(\"select_workspace\");\n      return;\n    }\n\n    // Reset to pick up the workspace ID.\n    resetDustClient();\n\n    const clientRes = await getDustClient();\n    if (clientRes.isErr()) {\n      setError(clientRes.error.message);\n      setState(\"error\");\n      return;\n    }\n\n    const client = clientRes.value;\n    if (!client) {\n      setState(\"auth\");\n      return;\n    }\n\n    setDustClient(client);\n    setState(\"ready\");\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      const isAuth = await AuthService.isAuthenticated();\n      if (isAuth) {\n        await initializeClient();\n      } else {\n        setState(\"auth\");\n      }\n    })();\n  }, [initializeClient]);\n\n  const handleAuthComplete = useCallback(async () => {\n    await initializeClient();\n  }, [initializeClient]);\n\n  const handleWorkspaceSelected = useCallback(async () => {\n    resetDustClient();\n    const clientRes = await getDustClient();\n    if (clientRes.isErr()) {\n      setError(clientRes.error.message);\n      setState(\"error\");\n      return;\n    }\n\n    const client = clientRes.value;\n    if (!client) {\n      setError(\"Failed to initialize client after workspace selection.\");\n      setState(\"error\");\n      return;\n    }\n\n    setDustClient(client);\n    setState(\"ready\");\n  }, []);\n\n  if (state === \"checking\") {\n    return (\n      <Box>\n        <Text color=\"green\"><Spinner type=\"dots\" /></Text>\n        <Text> Starting Dust Coding CLI...</Text>\n      </Box>\n    );\n  }\n\n  if (state === \"auth\") {\n    return <Auth onComplete={handleAuthComplete} apiKey={apiKey} wId={wId} />;\n  }\n\n  if (state === \"select_workspace\") {\n    return <WorkspaceSelector onComplete={handleWorkspaceSelected} />;\n  }\n\n  if (state === \"error\" || !dustClient) {\n    return (\n      <Box flexDirection=\"column\">\n        <Text color=\"red\">Error: {error ?? \"Failed to initialize.\"}</Text>\n        <Text>Try running again or check your authentication.</Text>\n      </Box>\n    );\n  }\n\n  return <Chat dustClient={dustClient} cwd={cwd} initialPrompt={initialPrompt} />;\n}\n","import type { Result } from \"@dust-tt/client\";\nimport { DustAPI, Err, Ok } from \"@dust-tt/client\";\n\nimport AuthService from \"./authService.js\";\nimport TokenStorage from \"./tokenStorage.js\";\n\nlet dustApiInstance: DustAPI | null = null;\n\nexport const getApiDomain = (region: string | null): Result<string, Error> => {\n  const url = (() => {\n    switch (region) {\n      case \"europe-west1\":\n        return process.env.DUST_EU_URL || process.env.DEFAULT_DUST_API_DOMAIN;\n      case \"us-central1\":\n        return process.env.DUST_US_URL || process.env.DEFAULT_DUST_API_DOMAIN;\n      default:\n        return process.env.DEFAULT_DUST_API_DOMAIN;\n    }\n  })();\n\n  if (!url) {\n    return new Err(new Error(\"Unable to determine API domain.\"));\n  }\n\n  return new Ok(url);\n};\n\nexport const getDustClient = async (): Promise<\n  Result<DustAPI | null, Error>\n> => {\n  if (dustApiInstance) {\n    return new Ok(dustApiInstance);\n  }\n\n  const accessToken = await AuthService.getValidAccessToken();\n\n  if (!accessToken) {\n    return new Ok(null);\n  }\n\n  const region = await TokenStorage.getRegion();\n  const apiDomainRes = getApiDomain(region);\n\n  if (apiDomainRes.isErr()) {\n    return new Err(apiDomainRes.error);\n  }\n\n  dustApiInstance = new DustAPI(\n    {\n      url: apiDomainRes.value,\n    },\n    {\n      apiKey: async () => {\n        const token = await AuthService.getValidAccessToken();\n        if (token.isErr()) {\n          return null;\n        }\n        return token.value || \"\";\n      },\n      workspaceId: (await TokenStorage.getWorkspaceId()) ?? \"me\",\n      extraHeaders: {\n        \"X-Dust-CLI-Version\": process.env.npm_package_version || \"0.1.0\",\n        \"User-Agent\": \"Dust Coding CLI\",\n      },\n    },\n    console\n  );\n\n  return new Ok(dustApiInstance);\n};\n\nexport const resetDustClient = (): void => {\n  dustApiInstance = null;\n};\n\nexport default {\n  getDustClient,\n  resetDustClient,\n};\n","import type { Result } from \"@dust-tt/client\";\nimport { Err, Ok } from \"@dust-tt/client\";\nimport type { JwtPayload } from \"jwt-decode\";\nimport { jwtDecode } from \"jwt-decode\";\nimport fetch from \"node-fetch\";\n\nimport { resetDustClient } from \"./dustClient.js\";\nimport { normalizeError } from \"./errors.js\";\nimport TokenStorage from \"./tokenStorage.js\";\n\ninterface RefreshTokenResponse {\n  access_token: string;\n  refresh_token: string;\n  id_token: string;\n  token_type: string;\n  expires_in: number;\n}\n\nexport const AuthService = {\n  async refreshTokens(): Promise<Result<boolean, Error>> {\n    const refreshToken = await TokenStorage.getRefreshToken();\n    if (!refreshToken) {\n      return new Err(new Error(\"No refresh token found\"));\n    }\n\n    const workOSDomain = process.env.WORKOS_DOMAIN || \"\";\n    const clientId = process.env.WORKOS_CLIENT_ID || \"\";\n\n    const response = await fetch(\n      `https://${workOSDomain}/user_management/authenticate`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        },\n        body: new URLSearchParams({\n          grant_type: \"refresh_token\",\n          client_id: clientId,\n          refresh_token: refreshToken,\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      if (response.status === 400 || response.status === 401) {\n        await TokenStorage.clearTokens();\n        resetDustClient();\n      }\n      return new Err(new Error(\"Failed to refresh tokens\"));\n    }\n\n    const data = (await response.json()) as RefreshTokenResponse;\n    await TokenStorage.saveTokens(data.access_token, data.refresh_token);\n\n    resetDustClient();\n\n    return new Ok(true);\n  },\n\n  async getValidAccessToken(): Promise<Result<string | null, Error>> {\n    const accessToken = await TokenStorage.getAccessToken();\n\n    if (accessToken?.startsWith(\"sk-\")) {\n      return new Ok(accessToken);\n    }\n\n    const isValid = await TokenStorage.hasValidAccessToken();\n\n    if (isValid.isErr()) {\n      return isValid;\n    }\n\n    if (!isValid.value || !accessToken) {\n      const refreshed = await this.refreshTokens();\n      if (refreshed.isErr()) {\n        return new Err(new Error(\"Failed to refresh tokens\"));\n      }\n\n      return new Ok(await TokenStorage.getAccessToken());\n    }\n\n    let decoded: JwtPayload;\n    try {\n      decoded = jwtDecode(accessToken);\n    } catch (error) {\n      const refreshed = await this.refreshTokens();\n      if (refreshed.isOk()) {\n        return new Ok(await TokenStorage.getAccessToken());\n      }\n      return new Err(normalizeError(error));\n    }\n\n    const currentTimeSeconds = Math.floor(Date.now() / 1000);\n    const timeUntilExpirySeconds = (decoded.exp ?? 0) - currentTimeSeconds;\n\n    if (timeUntilExpirySeconds < 30) {\n      const refreshed = await this.refreshTokens();\n      if (refreshed.isOk()) {\n        return new Ok(await TokenStorage.getAccessToken());\n      }\n      return refreshed;\n    }\n\n    return new Ok(accessToken);\n  },\n\n  async isAuthenticated(): Promise<boolean> {\n    const hasValidAccessToken = await TokenStorage.hasValidAccessToken();\n    if (hasValidAccessToken.isErr()) {\n      return false;\n    }\n\n    if (hasValidAccessToken.value) {\n      return true;\n    }\n\n    const refreshed = await this.refreshTokens();\n    if (refreshed.isOk()) {\n      return true;\n    }\n    return false;\n  },\n\n  async logout(): Promise<void> {\n    await TokenStorage.clearTokens();\n    resetDustClient();\n  },\n\n  async getSelectedWorkspaceId(): Promise<string | null> {\n    return TokenStorage.getWorkspaceId();\n  },\n\n  async getFreshAccessToken(): Promise<string | null> {\n    const accessToken = await TokenStorage.getAccessToken();\n\n    if (accessToken?.startsWith(\"sk-\")) {\n      return accessToken;\n    }\n\n    const refreshed = await this.refreshTokens();\n    if (!refreshed) {\n      return null;\n    }\n\n    return TokenStorage.getAccessToken();\n  },\n};\n\nexport default AuthService;\n","export interface CommandError {\n  message: string;\n  exitCode?: number;\n  stdout?: string;\n  stderr?: string;\n  command?: string;\n  signal?: string;\n  timedOut?: boolean;\n}\n\nexport function errorToString(error: unknown): string {\n  if (error instanceof Error) {\n    return error.message;\n  } else if (typeof error === \"string\") {\n    return error;\n  }\n\n  return JSON.stringify(error);\n}\n\nexport function normalizeError(error: unknown): Error {\n  if (error instanceof Error) {\n    return error;\n  }\n\n  return new Error(errorToString(error));\n}\n\nexport function isCommandError(error: unknown): error is CommandError {\n  return !!(\n    error &&\n    typeof error === \"object\" &&\n    \"exitCode\" in error &&\n    \"stdout\" in error &&\n    \"stderr\" in error &&\n    \"command\" in error\n  );\n}\n","import type { Result } from \"@dust-tt/client\";\nimport { Err, Ok } from \"@dust-tt/client\";\nimport { jwtDecode } from \"jwt-decode\";\n\nimport keytar from \"keytar\";\n\nimport { normalizeError } from \"./errors.js\";\n\nconst SERVICE_NAME = \"dust-cli\";\nconst ACCESS_TOKEN_KEY = \"access_token\";\nconst REFRESH_TOKEN_KEY = \"refresh_token\";\nconst WORKSPACE_KEY = \"workspace_sid\";\nconst REGION_KEY = \"region\";\n\ninterface JWTPayload {\n  exp: number;\n  [key: string]: unknown;\n}\n\nexport const TokenStorage = {\n  async saveTokens(accessToken: string, refreshToken: string): Promise<void> {\n    await keytar.setPassword(SERVICE_NAME, ACCESS_TOKEN_KEY, accessToken);\n    await keytar.setPassword(SERVICE_NAME, REFRESH_TOKEN_KEY, refreshToken);\n  },\n\n  async getAccessToken(): Promise<string | null> {\n    return keytar.getPassword(SERVICE_NAME, ACCESS_TOKEN_KEY);\n  },\n\n  async getRefreshToken(): Promise<string | null> {\n    return keytar.getPassword(SERVICE_NAME, REFRESH_TOKEN_KEY);\n  },\n\n  async hasValidAccessToken(): Promise<Result<boolean, Error>> {\n    const accessToken = await this.getAccessToken();\n    if (!accessToken) {\n      return new Err(new Error(\"No access token found\"));\n    }\n\n    if (accessToken.startsWith(\"sk-\")) {\n      return new Ok(true);\n    }\n\n    let decoded: JWTPayload;\n    try {\n      decoded = jwtDecode<JWTPayload>(accessToken);\n    } catch (error) {\n      return new Err(normalizeError(error));\n    }\n\n    const currentTimeSeconds = Math.floor(Date.now() / 1000);\n    return new Ok(decoded.exp > currentTimeSeconds);\n  },\n\n  async saveWorkspaceId(workspaceSid: string): Promise<void> {\n    await keytar.setPassword(SERVICE_NAME, WORKSPACE_KEY, workspaceSid);\n  },\n\n  async getWorkspaceId(): Promise<string | null> {\n    return keytar.getPassword(SERVICE_NAME, WORKSPACE_KEY);\n  },\n\n  async saveRegion(region: string): Promise<void> {\n    await keytar.setPassword(SERVICE_NAME, REGION_KEY, region);\n  },\n\n  async getRegion(): Promise<string | null> {\n    return keytar.getPassword(SERVICE_NAME, REGION_KEY);\n  },\n\n  async clearTokens(): Promise<void> {\n    await keytar.deletePassword(SERVICE_NAME, ACCESS_TOKEN_KEY);\n    await keytar.deletePassword(SERVICE_NAME, REFRESH_TOKEN_KEY);\n    await keytar.deletePassword(SERVICE_NAME, WORKSPACE_KEY);\n    await keytar.deletePassword(SERVICE_NAME, REGION_KEY);\n  },\n};\n\nexport default TokenStorage;\n","import { Box, Text } from \"ink\";\nimport Spinner from \"ink-spinner\";\nimport { jwtDecode } from \"jwt-decode\";\nimport fetch from \"node-fetch\";\nimport open from \"open\";\nimport React, { useCallback, useEffect, useState } from \"react\";\n\nimport { resetDustClient } from \"../utils/dustClient.js\";\nimport { normalizeError } from \"../utils/errors.js\";\nimport TokenStorage from \"../utils/tokenStorage.js\";\n\ninterface DeviceCodeResponse {\n  device_code: string;\n  user_code: string;\n  verification_uri: string;\n  verification_uri_complete: string;\n  expires_in: number;\n  interval: number;\n}\n\ninterface TokenResponse {\n  access_token: string;\n  refresh_token: string;\n  token_type: string;\n}\n\ninterface TokenErrorResponse {\n  error: string;\n  error_description?: string;\n}\n\ninterface DecodedAccessToken {\n  exp: number;\n  [key: string]: unknown;\n}\n\ninterface AuthProps {\n  onComplete: () => void;\n  apiKey?: string;\n  wId?: string;\n}\n\nexport function Auth({ onComplete, apiKey, wId }: AuthProps) {\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [deviceCode, setDeviceCode] = useState<DeviceCodeResponse | null>(null);\n  const [isPolling, setIsPolling] = useState(false);\n\n  const effectiveApiKey = apiKey || process.env.DUST_API_KEY;\n  const effectiveWId = wId || process.env.DUST_WORKSPACE_ID;\n\n  const workOSDomain = process.env.WORKOS_DOMAIN || \"\";\n  const clientId = process.env.WORKOS_CLIENT_ID || \"\";\n\n  const startPolling = useCallback(\n    (deviceCodeData: DeviceCodeResponse) => {\n      setIsPolling(true);\n\n      const pollIntervalSeconds = deviceCodeData.interval;\n      const expiresInSeconds = deviceCodeData.expires_in;\n      const maxAttempts = Math.floor(expiresInSeconds / pollIntervalSeconds);\n\n      let attempts = 0;\n\n      const pollForToken = async () => {\n        if (attempts >= maxAttempts) {\n          setIsPolling(false);\n          setError(\"Authentication timed out. Please try again.\");\n          return;\n        }\n\n        try {\n          const response = await fetch(\n            `https://${workOSDomain}/user_management/authenticate`,\n            {\n              method: \"POST\",\n              headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n              body: new URLSearchParams({\n                grant_type: \"urn:ietf:params:oauth:grant-type:device_code\",\n                device_code: deviceCodeData.device_code,\n                client_id: clientId,\n              }),\n            }\n          );\n\n          const data = (await response.json()) as TokenResponse | TokenErrorResponse;\n\n          if (\"error\" in data) {\n            if (data.error === \"authorization_pending\") {\n              attempts++;\n              setTimeout(pollForToken, pollIntervalSeconds * 1000);\n            } else if (data.error === \"slow_down\") {\n              attempts++;\n              setTimeout(pollForToken, (pollIntervalSeconds + 5) * 1000);\n            } else {\n              setIsPolling(false);\n              setError(`Authentication error: ${data.error_description || data.error}`);\n            }\n          } else {\n            await TokenStorage.saveTokens(data.access_token, data.refresh_token);\n\n            try {\n              const decodedToken = jwtDecode<DecodedAccessToken>(data.access_token);\n              const claimNamespace = process.env.WORKOS_CLAIM_NAMESPACE || \"\";\n              const regionClaimName = `${claimNamespace}region`;\n              const region = decodedToken[regionClaimName] as string | undefined;\n              await TokenStorage.saveRegion(region ?? \"us-central1\");\n            } catch {\n              await TokenStorage.saveRegion(\"us-central1\");\n            }\n\n            resetDustClient();\n            setIsPolling(false);\n            onComplete();\n          }\n        } catch (err) {\n          setIsPolling(false);\n          setError(normalizeError(err).message);\n        }\n      };\n\n      setTimeout(pollForToken, pollIntervalSeconds * 1000);\n    },\n    [clientId, workOSDomain, onComplete]\n  );\n\n  const startDeviceFlow = useCallback(async () => {\n    const hasValidToken = await TokenStorage.hasValidAccessToken();\n    if (hasValidToken.isOk() && hasValidToken.value) {\n      setIsLoading(false);\n      onComplete();\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(\n        `https://${workOSDomain}/user_management/authorize/device`,\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n          body: new URLSearchParams({ client_id: clientId, scope: \"openid profile email\" }),\n        }\n      );\n\n      if (!response.ok) {\n        setError(\"Failed to start device authorization flow.\");\n        return;\n      }\n\n      const data = (await response.json()) as DeviceCodeResponse;\n      setDeviceCode(data);\n      setIsLoading(false);\n\n      await open(data.verification_uri_complete);\n      startPolling(data);\n    } catch (err) {\n      setError(normalizeError(err).message);\n    }\n  }, [clientId, workOSDomain, startPolling, onComplete]);\n\n  const handleHeadlessAuth = useCallback(async () => {\n    if (!effectiveApiKey || !effectiveWId) {\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      await TokenStorage.saveTokens(effectiveApiKey, effectiveApiKey);\n      await TokenStorage.saveWorkspaceId(effectiveWId);\n      await TokenStorage.saveRegion(\"us-central1\");\n      resetDustClient();\n      setIsLoading(false);\n      onComplete();\n    } catch (err) {\n      setError(normalizeError(err).message);\n      setIsLoading(false);\n    }\n  }, [effectiveApiKey, effectiveWId, onComplete]);\n\n  useEffect(() => {\n    if (effectiveApiKey && effectiveWId) {\n      void handleHeadlessAuth();\n    } else {\n      void startDeviceFlow();\n    }\n  }, [effectiveApiKey, effectiveWId, handleHeadlessAuth, startDeviceFlow]);\n\n  if (error) {\n    return (\n      <Box flexDirection=\"column\">\n        <Text color=\"red\">Error: {error}</Text>\n      </Box>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <Box>\n        <Text color=\"green\"><Spinner type=\"dots\" /></Text>\n        <Text> Initializing authentication...</Text>\n      </Box>\n    );\n  }\n\n  if (isPolling && deviceCode) {\n    return (\n      <Box flexDirection=\"column\">\n        <Box>\n          <Text color=\"green\"><Spinner type=\"dots\" /></Text>\n          <Text> Waiting for you to authorize...</Text>\n        </Box>\n        <Box marginTop={1}>\n          <Text>Please enter code: </Text>\n          <Text color=\"yellow\" bold>{deviceCode.user_code}</Text>\n        </Box>\n        <Box>\n          <Text>at </Text>\n          <Text color=\"cyan\" underline>{deviceCode.verification_uri}</Text>\n        </Box>\n        <Text>The page should have opened automatically in your browser.</Text>\n      </Box>\n    );\n  }\n\n  return (\n    <Box>\n      <Text>Initializing...</Text>\n    </Box>\n  );\n}\n","import React, { useState, useCallback, useEffect, useRef, useMemo } from \"react\";\nimport { Box, Text, Static } from \"ink\";\nimport Spinner from \"ink-spinner\";\n\nimport type { DustAPI } from \"@dust-tt/client\";\nimport { createAgentLoop } from \"../agent/loop.js\";\nimport type { AgentEvent, ToolCall } from \"../agent/types.js\";\nimport { buildSystemPrompt } from \"../agent/systemPrompt.js\";\nimport {\n  createTools,\n  getToolDefinitions,\n  executeTool,\n} from \"../tools/index.js\";\nimport type { ToolContext } from \"../tools/index.js\";\nimport { InputBox } from \"./InputBox.js\";\nimport { ToolApprovalSelector } from \"./ToolApprovalSelector.js\";\nimport { ToolExecution } from \"./ToolExecution.js\";\nimport type { ToolCallDisplay } from \"./ToolExecution.js\";\nimport { WelcomeHeader } from \"./WelcomeHeader.js\";\nimport { createCommands } from \"./commands/types.js\";\nimport type { Command } from \"./commands/types.js\";\n\n// --- Types for ordered display ---\n\ntype LiveItem =\n  | { type: \"thinking\"; id: string; text: string }\n  | { type: \"text\"; id: string; text: string }\n  | { type: \"tool_call\"; id: string; call: ToolCallDisplay };\n\ntype HistoryItem =\n  | { type: \"welcome\"; id: string }\n  | { type: \"user\"; id: string; content: string }\n  | { type: \"thinking\"; id: string; content: string }\n  | { type: \"text\"; id: string; content: string }\n  | { type: \"tool_call\"; id: string; call: ToolCallDisplay }\n  | { type: \"info\"; id: string; content: string }\n  | { type: \"error\"; id: string; content: string }\n  | { type: \"separator\"; id: string };\n\ninterface ChatProps {\n  dustClient: DustAPI;\n  cwd: string;\n  initialPrompt?: string;\n}\n\nfunction formatTokenCount(n: number): string {\n  if (n >= 1000) return `${(n / 1000).toFixed(1)}k`;\n  return `${n}`;\n}\n\nconst SEPARATOR = \"─\".repeat(50);\n\nexport function Chat({ dustClient, cwd, initialPrompt }: ChatProps) {\n  const [history, setHistory] = useState<HistoryItem[]>([\n    { type: \"welcome\", id: \"welcome\" },\n  ]);\n  const [liveItems, setLiveItems] = useState<LiveItem[]>([]);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [totalTokens, setTotalTokens] = useState({ input: 0, output: 0 });\n\n  // Pending user question resolver for ask_user tool.\n  const askUserResolverRef = useRef<((answer: string) => void) | null>(null);\n  const [pendingQuestion, setPendingQuestion] = useState<string | null>(null);\n\n  // Pending tool approval resolver.\n  const approvalResolverRef = useRef<((approved: boolean) => void) | null>(\n    null\n  );\n  const [pendingApproval, setPendingApproval] = useState<ToolCall | null>(null);\n\n  const loopRef = useRef<ReturnType<typeof createAgentLoop> | null>(null);\n  const idCounter = useRef(0);\n\n  const nextId = useCallback(() => {\n    idCounter.current += 1;\n    return `item-${idCounter.current}`;\n  }, []);\n\n  // Initialize agent loop.\n  useEffect(() => {\n    const approveToolCall = (call: ToolCall): Promise<boolean> => {\n      return new Promise<boolean>((resolve) => {\n        setPendingApproval(call);\n        approvalResolverRef.current = resolve;\n      });\n    };\n\n    const toolContext: ToolContext = {\n      cwd,\n      dustClient,\n      askUser: async (question: string) => {\n        return new Promise<string>((resolve) => {\n          setPendingQuestion(question);\n          askUserResolverRef.current = resolve;\n        });\n      },\n      approveToolCall,\n    };\n\n    const tools = createTools(toolContext);\n    const toolDefs = getToolDefinitions(tools);\n    const systemPrompt = buildSystemPrompt(cwd);\n\n    const loop = createAgentLoop({\n      dustClient,\n      systemPrompt,\n      tools: toolDefs,\n      executeTool: (call) => executeTool(tools, call, approveToolCall),\n    });\n\n    loopRef.current = loop;\n\n    // Consume events in background.\n    (async () => {\n      for await (const event of loop.events()) {\n        handleEvent(event);\n      }\n    })();\n\n    // Send initial prompt if provided.\n    if (initialPrompt) {\n      setIsProcessing(true);\n      setHistory((prev) => [\n        ...prev,\n        { id: nextId(), type: \"user\", content: initialPrompt },\n        { id: nextId(), type: \"separator\" },\n      ]);\n      loop.sendMessage(initialPrompt);\n    }\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const handleEvent = useCallback(\n    (event: AgentEvent) => {\n      switch (event.type) {\n        case \"thinking_delta\":\n          setLiveItems((prev) => {\n            const last = prev[prev.length - 1];\n            if (last && last.type === \"thinking\") {\n              return [\n                ...prev.slice(0, -1),\n                { ...last, text: last.text + event.text },\n              ];\n            }\n            return [\n              ...prev,\n              { type: \"thinking\", id: `live-${Date.now()}`, text: event.text },\n            ];\n          });\n          break;\n\n        case \"text_delta\":\n          setLiveItems((prev) => {\n            const last = prev[prev.length - 1];\n            if (last && last.type === \"text\") {\n              return [\n                ...prev.slice(0, -1),\n                { ...last, text: last.text + event.text },\n              ];\n            }\n            return [\n              ...prev,\n              { type: \"text\", id: `live-${Date.now()}`, text: event.text },\n            ];\n          });\n          break;\n\n        case \"tool_use\":\n          setLiveItems((prev) => [\n            ...prev,\n            {\n              type: \"tool_call\",\n              id: `live-tc-${event.id}`,\n              call: {\n                id: event.id,\n                name: event.name,\n                input: event.input,\n                status: \"executing\",\n                startTime: Date.now(),\n              },\n            },\n          ]);\n          break;\n\n        case \"tool_executing\":\n          setLiveItems((prev) =>\n            prev.map((item) =>\n              item.type === \"tool_call\" && item.call.id === event.id\n                ? {\n                    ...item,\n                    call: { ...item.call, status: \"executing\" as const },\n                  }\n                : item\n            )\n          );\n          break;\n\n        case \"tool_result\":\n          setLiveItems((prev) =>\n            prev.map((item) =>\n              item.type === \"tool_call\" && item.call.id === event.id\n                ? {\n                    ...item,\n                    call: {\n                      ...item.call,\n                      status: \"done\" as const,\n                      result: event.result,\n                      duration: item.call.startTime\n                        ? (Date.now() - item.call.startTime) / 1000\n                        : undefined,\n                    },\n                  }\n                : item\n            )\n          );\n          break;\n\n        case \"usage\":\n          setTotalTokens((prev) => ({\n            input: prev.input + event.inputTokens,\n            output: prev.output + event.outputTokens,\n          }));\n          break;\n\n        case \"done\":\n          // Flush live items into history.\n          setLiveItems((prev) => {\n            if (prev.length > 0) {\n              const historyItems: HistoryItem[] = prev.map((item) => {\n                switch (item.type) {\n                  case \"thinking\":\n                    return {\n                      type: \"thinking\" as const,\n                      id: item.id,\n                      content: item.text,\n                    };\n                  case \"text\":\n                    return {\n                      type: \"text\" as const,\n                      id: item.id,\n                      content: item.text,\n                    };\n                  case \"tool_call\":\n                    return {\n                      type: \"tool_call\" as const,\n                      id: item.id,\n                      call: item.call,\n                    };\n                }\n              });\n              setHistory((h) => [\n                ...h,\n                ...historyItems,\n                { type: \"separator\", id: `sep-${Date.now()}` },\n              ]);\n            }\n            return [];\n          });\n          setIsProcessing(false);\n          break;\n\n        case \"error\":\n          setLiveItems([]);\n          setHistory((prev) => [\n            ...prev,\n            { type: \"error\", id: `err-${Date.now()}`, content: event.message },\n            { type: \"separator\", id: `sep-${Date.now()}` },\n          ]);\n          setIsProcessing(false);\n          break;\n      }\n    },\n    [nextId]\n  );\n\n  const commands = useMemo(\n    () =>\n      createCommands({\n        showHelp: () => {\n          setHistory((prev) => [\n            ...prev,\n            {\n              id: nextId(),\n              type: \"info\",\n              content: [\n                \"Available commands:\",\n                \"  /help    — Show this help message\",\n                \"  /clear   — Clear conversation history\",\n                \"  /status  — Show token usage and session info\",\n                \"  /exit    — Exit the CLI\",\n                \"\",\n                \"Keyboard shortcuts:\",\n                \"  Enter       — Send message\",\n                \"  \\\\Enter     — Insert newline\",\n                \"  Ctrl+U      — Clear input\",\n                \"  Ctrl+A/E    — Jump to line start/end\",\n                \"  Opt+←/→     — Jump by word\",\n                \"  ↑/↓         — Move between lines\",\n                \"  /           — Open command selector\",\n                \"  Ctrl+C      — Exit\",\n              ].join(\"\\n\"),\n            },\n            { id: nextId(), type: \"separator\" },\n          ]);\n        },\n        clearConversation: () => {\n          setHistory([{ type: \"welcome\", id: \"welcome\" }]);\n          setLiveItems([]);\n        },\n        showStatus: () => {\n          setHistory((prev) => [\n            ...prev,\n            {\n              id: nextId(),\n              type: \"info\",\n              content: [\n                `Directory: ${cwd}`,\n                `Tokens: ${formatTokenCount(totalTokens.input)} in / ${formatTokenCount(totalTokens.output)} out`,\n                `Messages: ${history.filter((h) => h.type === \"user\").length} sent`,\n                `Processing: ${isProcessing ? \"yes\" : \"no\"}`,\n              ].join(\"\\n\"),\n            },\n            { id: nextId(), type: \"separator\" },\n          ]);\n        },\n      }),\n    [nextId, cwd, totalTokens, history, isProcessing]\n  );\n\n  const handleCommandSelect = useCallback((command: Command) => {\n    void command.execute({});\n  }, []);\n\n  const handleSubmit = useCallback(\n    (text: string) => {\n      // Check if we're answering an ask_user question.\n      if (pendingQuestion && askUserResolverRef.current) {\n        askUserResolverRef.current(text);\n        askUserResolverRef.current = null;\n        setPendingQuestion(null);\n        return;\n      }\n\n      if (!loopRef.current || isProcessing) {\n        return;\n      }\n\n      setIsProcessing(true);\n      setHistory((prev) => [\n        ...prev,\n        { id: nextId(), type: \"user\", content: text },\n        { id: nextId(), type: \"separator\" },\n      ]);\n      loopRef.current.sendMessage(text);\n    },\n    [isProcessing, nextId, pendingQuestion]\n  );\n\n  // Check if there's an active tool executing (for spinner).\n  const hasActiveToolCall = liveItems.some(\n    (item) => item.type === \"tool_call\" && item.call.status === \"executing\"\n  );\n\n  return (\n    <Box flexDirection=\"column\" padding={1}>\n      {/* Static history: welcome header + all finalized items */}\n      <Static items={history}>\n        {(item) => {\n          switch (item.type) {\n            case \"welcome\":\n              return (\n                <Box key={item.id}>\n                  <WelcomeHeader cwd={cwd} />\n                </Box>\n              );\n            case \"user\":\n              return (\n                <Box key={item.id} flexDirection=\"column\">\n                  <Text color=\"green\" bold>\n                    You\n                  </Text>\n                  <Text>{item.content}</Text>\n                </Box>\n              );\n            case \"thinking\":\n              return (\n                <Box key={item.id}>\n                  <Text color=\"gray\" dimColor italic>\n                    {item.content}\n                  </Text>\n                </Box>\n              );\n            case \"text\":\n              return (\n                <Box key={item.id}>\n                  <Text>{item.content}</Text>\n                </Box>\n              );\n            case \"tool_call\":\n              return (\n                <Box key={item.id}>\n                  <ToolExecution toolCalls={[item.call]} />\n                </Box>\n              );\n            case \"info\":\n              return (\n                <Box key={item.id}>\n                  <Text dimColor>{item.content}</Text>\n                </Box>\n              );\n            case \"error\":\n              return (\n                <Box key={item.id}>\n                  <Text color=\"red\" bold>\n                    {\"✗ Error: \"}\n                    <Text color=\"red\">{item.content}</Text>\n                  </Text>\n                </Box>\n              );\n            case \"separator\":\n              return (\n                <Box key={item.id}>\n                  <Text dimColor>{SEPARATOR}</Text>\n                </Box>\n              );\n          }\n        }}\n      </Static>\n\n      {/* Live streaming area: items in arrival order */}\n      {liveItems.map((item) => {\n        switch (item.type) {\n          case \"thinking\":\n            return (\n              <Box key={item.id}>\n                <Text color=\"gray\" dimColor italic>\n                  {item.text}\n                </Text>\n              </Box>\n            );\n          case \"text\":\n            return (\n              <Box key={item.id}>\n                <Text>{item.text}</Text>\n              </Box>\n            );\n          case \"tool_call\":\n            return (\n              <Box key={item.id}>\n                <ToolExecution toolCalls={[item.call]} />\n              </Box>\n            );\n        }\n      })}\n\n      {/* Spinner when processing but nothing streaming yet */}\n      {isProcessing && liveItems.length === 0 && (\n        <Box>\n          <Text color=\"blue\">\n            <Spinner type=\"dots\" />\n          </Text>\n          <Text color=\"gray\"> Thinking...</Text>\n        </Box>\n      )}\n\n      {/* Spinner when waiting for a tool to complete */}\n      {isProcessing && hasActiveToolCall && (\n        <Box>\n          <Text color=\"blue\">\n            <Spinner type=\"dots\" />\n          </Text>\n          <Text color=\"gray\"> Running...</Text>\n        </Box>\n      )}\n\n      {/* Pending tool approval */}\n      {pendingApproval && (\n        <ToolApprovalSelector\n          call={pendingApproval}\n          onApproval={(approved) => {\n            if (approvalResolverRef.current) {\n              approvalResolverRef.current(approved);\n              approvalResolverRef.current = null;\n            }\n            setPendingApproval(null);\n          }}\n        />\n      )}\n\n      {/* Pending question from ask_user */}\n      {pendingQuestion && (\n        <Box paddingX={1} flexDirection=\"column\" marginTop={1}>\n          <Box width={15}>\n            <Text color=\"blue\" bold>\n              Agent asks\n            </Text>\n          </Box>\n          <Text>{pendingQuestion}</Text>\n        </Box>\n      )}\n\n      {/* Input */}\n      <InputBox\n        onSubmit={handleSubmit}\n        onCommandSelect={handleCommandSelect}\n        commands={commands}\n        disabled={(isProcessing && !pendingQuestion) || !!pendingApproval}\n        placeholder={\n          pendingQuestion\n            ? \"Answer the agent's question...\"\n            : \"Type a message...\"\n        }\n      />\n\n      {/* Token usage — compact one-liner */}\n      {(totalTokens.input > 0 || totalTokens.output > 0) && (\n        <Box marginTop={1}>\n          <Text dimColor>\n            tokens: {formatTokenCount(totalTokens.input)} in /{\" \"}\n            {formatTokenCount(totalTokens.output)} out\n          </Text>\n        </Box>\n      )}\n    </Box>\n  );\n}\n","import type { DustAPI } from \"@dust-tt/client\";\n\nimport type { DustMessage, ToolDefinition } from \"../agent/types.js\";\n\n/**\n * CLI completion event types (matching what the proxy endpoint emits).\n */\nexport interface CLITextDeltaEvent {\n  type: \"text_delta\";\n  text: string;\n}\n\nexport interface CLIThinkingDeltaEvent {\n  type: \"thinking_delta\";\n  text: string;\n}\n\nexport interface CLIToolUseEvent {\n  type: \"tool_use\";\n  id: string;\n  name: string;\n  input: Record<string, unknown>;\n}\n\nexport interface CLIUsageEvent {\n  type: \"usage\";\n  input_tokens: number;\n  output_tokens: number;\n  cache_creation_tokens?: number;\n  cached_tokens?: number;\n}\n\nexport interface CLIDoneEvent {\n  type: \"done\";\n  stop_reason: \"end_turn\" | \"tool_use\";\n}\n\nexport interface CLIErrorEvent {\n  type: \"error\";\n  message: string;\n  error_type?: string;\n  retryable?: boolean;\n}\n\nexport type CLICompletionEvent =\n  | CLITextDeltaEvent\n  | CLIThinkingDeltaEvent\n  | CLIToolUseEvent\n  | CLIUsageEvent\n  | CLIDoneEvent\n  | CLIErrorEvent;\n\ninterface StreamCompletionParams {\n  messages: DustMessage[];\n  tools?: ToolDefinition[];\n  system?: string;\n  maxTokens?: number;\n  temperature?: number;\n}\n\n/**\n * Stream a CLI completion through the Dust proxy endpoint.\n * Uses the DustAPI's request method directly.\n */\nexport async function streamCLICompletion(\n  dustClient: DustAPI,\n  params: StreamCompletionParams\n): Promise<AsyncGenerator<CLICompletionEvent, void, unknown>> {\n  // Use the DustAPI's request method to POST to the completion endpoint.\n  const res = await (dustClient as any).request({\n    method: \"POST\",\n    path: \"cli/completion\",\n    body: {\n      conversation: { messages: params.messages },\n      tools: params.tools,\n      system: params.system,\n      max_tokens: params.maxTokens,\n      temperature: params.temperature,\n    },\n    stream: true,\n  });\n\n  if (res.isErr()) {\n    return (async function* () {\n      yield {\n        type: \"error\" as const,\n        message: res.error.message,\n      };\n    })();\n  }\n\n  const { response } = res.value;\n\n  if (!response.ok || !response.body) {\n    const text =\n      typeof response.body === \"string\" ? response.body : \"Stream not available\";\n    return (async function* () {\n      yield {\n        type: \"error\" as const,\n        message: `Error streaming completion: status=${response.status} ${text}`,\n      };\n    })();\n  }\n\n  return parseSSEStream(response.body as ReadableStream<Uint8Array>);\n}\n\nasync function* parseSSEStream(\n  body: ReadableStream<Uint8Array>\n): AsyncGenerator<CLICompletionEvent, void, unknown> {\n  const reader = body.getReader();\n  const decoder = new TextDecoder();\n  let buffer = \"\";\n\n  try {\n    for (;;) {\n      const { value, done } = await reader.read();\n\n      if (value) {\n        buffer += decoder.decode(value, { stream: true });\n\n        // Parse SSE events from buffer.\n        const lines = buffer.split(\"\\n\");\n        buffer = lines.pop() ?? \"\";\n\n        for (const line of lines) {\n          if (line.startsWith(\"data: \")) {\n            const data = line.slice(6).trim();\n            if (data === \"done\") {\n              return;\n            }\n            try {\n              const event = JSON.parse(data) as CLICompletionEvent;\n              yield event;\n            } catch {\n              // Skip malformed events.\n            }\n          }\n        }\n      }\n\n      if (done) {\n        break;\n      }\n    }\n\n    // Process any remaining data in buffer.\n    if (buffer.startsWith(\"data: \")) {\n      const data = buffer.slice(6).trim();\n      if (data && data !== \"done\") {\n        try {\n          const event = JSON.parse(data) as CLICompletionEvent;\n          yield event;\n        } catch {\n          // Skip.\n        }\n      }\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n","import type { DustAPI } from \"@dust-tt/client\";\n\nimport { streamCLICompletion } from \"../utils/streamCompletion.js\";\nimport type { CLIToolUseEvent } from \"../utils/streamCompletion.js\";\n\nimport type {\n  AgentContentItem,\n  AgentEvent,\n  DustMessage,\n  ToolCall,\n  ToolDefinition,\n} from \"./types.js\";\n\ninterface AgentLoopParams {\n  dustClient: DustAPI;\n  systemPrompt: string;\n  tools: ToolDefinition[];\n  executeTool: (call: ToolCall) => Promise<string>;\n  maxTokens?: number;\n}\n\n/**\n * The local agent loop. Yields AgentEvents that the UI consumes for rendering.\n *\n * Usage:\n *   const loop = createAgentLoop(params);\n *   loop.sendMessage(\"Hello\");\n *   for await (const event of loop.events()) { ... }\n */\nexport function createAgentLoop(params: AgentLoopParams) {\n  const { dustClient, systemPrompt, tools, executeTool, maxTokens = 16384 } = params;\n  const messages: DustMessage[] = [];\n\n  // Event queue for the UI to consume.\n  let eventResolve: ((event: AgentEvent) => void) | null = null;\n  const eventQueue: AgentEvent[] = [];\n  let done = false;\n\n  function emit(event: AgentEvent) {\n    if (eventResolve) {\n      const resolve = eventResolve;\n      eventResolve = null;\n      resolve(event);\n    } else {\n      eventQueue.push(event);\n    }\n  }\n\n  async function* events(): AsyncGenerator<AgentEvent> {\n    while (!done) {\n      if (eventQueue.length > 0) {\n        yield eventQueue.shift()!;\n      } else {\n        yield await new Promise<AgentEvent>((resolve) => {\n          eventResolve = resolve;\n        });\n      }\n    }\n    // Flush remaining events.\n    while (eventQueue.length > 0) {\n      yield eventQueue.shift()!;\n    }\n  }\n\n  async function runCompletionLoop() {\n    // Keep looping as long as the model wants to use tools.\n    while (true) {\n      let eventStream: AsyncGenerator<import(\"../utils/streamCompletion.js\").CLICompletionEvent, void, unknown>;\n\n      try {\n        eventStream = await streamCLICompletion(dustClient, {\n          messages,\n          tools,\n          system: systemPrompt,\n          maxTokens,\n        });\n      } catch (err) {\n        const message = err instanceof Error ? err.message : String(err);\n        emit({ type: \"error\", message });\n        return;\n      }\n\n      // Accumulate tool calls from this turn.\n      const toolCalls: ToolCall[] = [];\n      let currentText = \"\";\n      let stopReason = \"end_turn\";\n\n      for await (const event of eventStream) {\n        switch (event.type) {\n          case \"text_delta\":\n            currentText += event.text;\n            emit({ type: \"text_delta\", text: event.text });\n            break;\n\n          case \"thinking_delta\":\n            emit({ type: \"thinking_delta\", text: event.text });\n            break;\n\n          case \"tool_use\": {\n            const toolEvent = event as CLIToolUseEvent;\n            toolCalls.push({\n              id: toolEvent.id,\n              name: toolEvent.name,\n              input: toolEvent.input,\n            });\n            emit({\n              type: \"tool_use\",\n              id: toolEvent.id,\n              name: toolEvent.name,\n              input: toolEvent.input,\n            });\n            break;\n          }\n\n          case \"usage\":\n            emit({\n              type: \"usage\",\n              inputTokens: event.input_tokens,\n              outputTokens: event.output_tokens,\n            });\n            break;\n\n          case \"done\":\n            stopReason = event.stop_reason;\n            break;\n\n          case \"error\":\n            emit({\n              type: \"error\",\n              message: event.message,\n              retryable: event.retryable,\n            });\n            return;\n        }\n      }\n\n      // Build assistant message in Dust internal format.\n      if (toolCalls.length > 0) {\n        const functionCalls = toolCalls.map((tc) => ({\n          id: tc.id,\n          name: tc.name,\n          arguments: JSON.stringify(tc.input),\n        }));\n        const contents: AgentContentItem[] = [];\n        if (currentText) {\n          contents.push({ type: \"text_content\", value: currentText });\n        }\n        for (const fc of functionCalls) {\n          contents.push({ type: \"function_call\", value: fc });\n        }\n        messages.push({ role: \"assistant\", function_calls: functionCalls, contents });\n      } else if (currentText) {\n        messages.push({\n          role: \"assistant\",\n          name: \"assistant\",\n          contents: [{ type: \"text_content\", value: currentText }],\n        });\n      }\n\n      // If no tool calls, we're done with this turn.\n      if (toolCalls.length === 0) {\n        emit({ type: \"done\", stopReason });\n        return;\n      }\n\n      // Execute tools and push one FunctionMessage per result.\n      for (const toolCall of toolCalls) {\n        emit({\n          type: \"tool_executing\",\n          id: toolCall.id,\n          name: toolCall.name,\n          input: toolCall.input,\n        });\n\n        const result = await executeTool(toolCall);\n\n        messages.push({\n          role: \"function\",\n          name: toolCall.name,\n          function_call_id: toolCall.id,\n          content: result,\n        });\n\n        emit({\n          type: \"tool_result\",\n          id: toolCall.id,\n          name: toolCall.name,\n          result,\n        });\n      }\n\n      // Loop back for the next LLM call.\n    }\n  }\n\n  return {\n    events,\n\n    sendMessage(content: string) {\n      messages.push({ role: \"user\", name: \"user\", content: [{ type: \"text\", text: content }] });\n      runCompletionLoop();\n    },\n\n    stop() {\n      done = true;\n      emit({ type: \"done\", stopReason: \"stopped\" });\n    },\n\n    getMessages() {\n      return messages;\n    },\n  };\n}\n\nexport type AgentLoop = ReturnType<typeof createAgentLoop>;\n","import { execSync } from \"child_process\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport os from \"os\";\n\n/**\n * Find the project root by walking up from cwd looking for .git directory.\n */\nfunction findProjectRoot(startDir: string): string | null {\n  let dir = startDir;\n  while (dir !== path.dirname(dir)) {\n    if (fs.existsSync(path.join(dir, \".git\"))) {\n      return dir;\n    }\n    dir = path.dirname(dir);\n  }\n  return null;\n}\n\n/**\n * Load DUST.md from project root if it exists.\n */\nfunction loadDustMd(projectRoot: string | null): string | null {\n  if (!projectRoot) {\n    return null;\n  }\n  const dustMdPath = path.join(projectRoot, \"DUST.md\");\n  if (fs.existsSync(dustMdPath)) {\n    return fs.readFileSync(dustMdPath, \"utf-8\");\n  }\n  return null;\n}\n\n/**\n * Get current git status (short format).\n */\nfunction getGitStatus(cwd: string): string {\n  try {\n    const status = execSync(\"git status --short\", { cwd, encoding: \"utf-8\" });\n    return status.trim() || \"(clean)\";\n  } catch {\n    return \"(not a git repository)\";\n  }\n}\n\n/**\n * Get current git branch.\n */\nfunction getGitBranch(cwd: string): string {\n  try {\n    return execSync(\"git branch --show-current\", { cwd, encoding: \"utf-8\" }).trim();\n  } catch {\n    return \"unknown\";\n  }\n}\n\n/**\n * Build the system prompt for the coding agent.\n */\nexport function buildSystemPrompt(cwd: string): string {\n  const projectRoot = findProjectRoot(cwd);\n  const dustMd = loadDustMd(projectRoot);\n  const gitStatus = getGitStatus(cwd);\n  const gitBranch = getGitBranch(cwd);\n  const date = new Date().toISOString().split(\"T\")[0];\n  const platform = os.platform();\n\n  let prompt = `You are a coding agent running in the Dust CLI. You help users with software engineering tasks by reading, writing, and editing code, running commands, and searching the codebase.\n\nYou have access to tools for file operations, command execution, and searching. Use them to assist the user.\n\n# Environment\n- Working directory: ${cwd}\n- Project root: ${projectRoot ?? cwd}\n- Platform: ${platform}\n- Date: ${date}\n- Git branch: ${gitBranch}\n- Git status: ${gitStatus}\n\n# Guidelines\n- Read files before modifying them.\n- Prefer editing existing files over creating new ones.\n- Show diffs for file edits when the change is significant.\n- Run tests after making code changes when appropriate.\n- Keep responses concise and focused on the task.\n- Use the glob and grep tools to search the codebase efficiently.\n- For complex tasks, break them down into steps.\n- You can call the call_dust_agent tool to delegate tasks to specialized Dust workspace agents.\n- You can use the task tool to run sub-agents in parallel for independent work.\n\n# Tool Usage\n- Use read_file to read files before editing.\n- Use edit_file for targeted text replacements (preferred over write_file for existing files).\n- Use write_file only for creating new files or complete rewrites.\n- Use bash for running commands, tests, and build tools.\n- Use glob to find files by pattern.\n- Use grep to search file contents.\n- Use ask_user when you need clarification or approval.`;\n\n  if (dustMd) {\n    prompt += `\n\n# Project Instructions (DUST.md)\n${dustMd}`;\n  }\n\n  return prompt;\n}\n","import path from \"path\";\n\nimport type { Tool, ToolContext } from \"./index.js\";\nimport { processFile } from \"../utils/fileHandling.js\";\n\nexport function readFileTool(context: ToolContext): Tool {\n  return {\n    name: \"read_file\",\n    description:\n      \"Read a file from the filesystem. Returns the file content with line numbers. \" +\n      \"For large files, use offset and limit to read specific sections.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        file_path: {\n          type: \"string\",\n          description: \"Absolute or relative path to the file to read.\",\n        },\n        offset: {\n          type: \"number\",\n          description: \"Line number to start reading from (0-indexed). Default: 0.\",\n        },\n        limit: {\n          type: \"number\",\n          description: \"Maximum number of lines to read. Default: 2000.\",\n        },\n      },\n      required: [\"file_path\"],\n    },\n    async execute(input) {\n      const filePath = path.resolve(\n        context.cwd,\n        input.file_path as string\n      );\n      const offset = (input.offset as number) ?? 0;\n      const limit = (input.limit as number) ?? 2000;\n\n      const result = await processFile(filePath, offset, limit);\n\n      if (\"error\" in result) {\n        return result.error;\n      }\n\n      return result.data;\n    },\n  };\n}\n","import fs from \"fs\";\nimport { stat } from \"fs/promises\";\nimport path from \"path\";\n\nexport const MAX_LINES_TEXT_FILE = 2000;\nexport const MAX_LINE_LENGTH_TEXT_FILE = 2000;\nexport const MAX_FILE_SIZE = 50 * 1024 * 1024;\n\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) {\n    return \"0 Bytes\";\n  }\n\n  const k = 1024;\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;\n}\n\nexport function detectFileType(\n  filePath: string\n): \"text\" | \"image\" | \"pdf\" | \"binary\" {\n  const fileExtension = path.extname(filePath).toLowerCase();\n\n  if (fileExtension === \".ts\" || fileExtension === \".tsx\") {\n    return \"text\";\n  }\n\n  const binaryExtensions = new Set([\n    \".zip\", \".tar\", \".gz\", \".exe\", \".dll\", \".so\", \".class\", \".jar\", \".war\",\n    \".7z\", \".doc\", \".docx\", \".xls\", \".xlsx\", \".ppt\", \".pptx\", \".odt\", \".ods\",\n    \".odp\", \".bin\", \".dat\", \".obj\", \".o\", \".a\", \".lib\", \".wasm\", \".pyc\", \".pyo\",\n  ]);\n\n  if (binaryExtensions.has(fileExtension)) {\n    return \"binary\";\n  }\n\n  const imageExtensions = new Set([\n    \".png\", \".jpg\", \".jpeg\", \".gif\", \".webp\", \".svg\", \".bmp\",\n  ]);\n\n  if (imageExtensions.has(fileExtension)) {\n    return \"image\";\n  }\n\n  if (fileExtension === \".pdf\") {\n    return \"pdf\";\n  }\n\n  return \"text\";\n}\n\nexport async function processFile(\n  filePath: string,\n  offset: number = 0,\n  limit: number = MAX_LINES_TEXT_FILE\n): Promise<{ data: string } | { error: string }> {\n  if (!fs.existsSync(filePath)) {\n    return { error: `File at ${filePath} does not exist.` };\n  }\n\n  const stats = await stat(filePath);\n\n  if (!stats.isFile()) {\n    return { error: `Path is not a file: ${filePath}` };\n  }\n\n  if (stats.size > MAX_FILE_SIZE) {\n    return { error: `File too large: ${formatFileSize(stats.size)}. Max: ${formatFileSize(MAX_FILE_SIZE)}` };\n  }\n\n  const fileType = detectFileType(filePath);\n\n  switch (fileType) {\n    case \"binary\":\n      return { error: \"Cannot handle binary files.\" };\n    case \"image\":\n    case \"pdf\": {\n      const contentBuffer = await fs.promises.readFile(filePath);\n      const base64Data = contentBuffer.toString(\"base64\");\n      return { data: base64Data };\n    }\n    case \"text\": {\n      const content = await fs.promises.readFile(filePath, \"utf-8\");\n      const lines = content.split(\"\\n\");\n      const oldLineCount = lines.length;\n\n      const startLine = Math.min(offset, oldLineCount);\n      const endLine = Math.min(startLine + limit, oldLineCount);\n\n      const selectedLines = lines.slice(startLine, endLine);\n\n      const totalCut = endLine < oldLineCount;\n      let linesCut = false;\n      const formattedLines = selectedLines.map((line) => {\n        if (line.length > MAX_LINE_LENGTH_TEXT_FILE) {\n          linesCut = true;\n          return line.substring(0, MAX_LINE_LENGTH_TEXT_FILE) + \"... [cut]\";\n        }\n        return line;\n      });\n\n      let cutMessage = \"\";\n      if (totalCut) {\n        cutMessage = `[File content cut: showing lines ${startLine + 1}-${endLine} of ${oldLineCount} total lines. Use offset/limit parameters to view more.]\\n`;\n      } else if (linesCut) {\n        cutMessage = `[File content partially cut: some lines exceeded maximum length of ${MAX_LINE_LENGTH_TEXT_FILE} characters.]\\n`;\n      }\n\n      const resContent = cutMessage + formattedLines.join(\"\\n\");\n      return { data: resContent };\n    }\n    default:\n      return { error: \"Unsupported file type.\" };\n  }\n}\n","import fs from \"fs\";\nimport path from \"path\";\n\nimport type { Tool, ToolContext } from \"./index.js\";\n\nexport function writeFileTool(context: ToolContext): Tool {\n  return {\n    name: \"write_file\",\n    description:\n      \"Write content to a file. Creates the file and parent directories if they don't exist. \" +\n      \"Overwrites the file if it already exists. Prefer edit_file for modifying existing files.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        file_path: {\n          type: \"string\",\n          description: \"Absolute or relative path to write to.\",\n        },\n        content: {\n          type: \"string\",\n          description: \"The content to write to the file.\",\n        },\n      },\n      required: [\"file_path\", \"content\"],\n    },\n    async execute(input) {\n      const filePath = path.resolve(\n        context.cwd,\n        input.file_path as string\n      );\n      const content = input.content as string;\n\n      // Create parent directories if needed.\n      const dir = path.dirname(filePath);\n      await fs.promises.mkdir(dir, { recursive: true });\n\n      await fs.promises.writeFile(filePath, content, \"utf-8\");\n\n      return `Successfully wrote ${content.length} characters to ${filePath}`;\n    },\n  };\n}\n","import fs from \"fs\";\nimport path from \"path\";\n\nimport type { Tool, ToolContext } from \"./index.js\";\n\nexport function editFileTool(context: ToolContext): Tool {\n  return {\n    name: \"edit_file\",\n    description:\n      \"Edit a file by replacing an exact string match with new content. \" +\n      \"The old_string must match exactly (including whitespace and indentation). \" +\n      \"Use read_file first to see the current content.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        file_path: {\n          type: \"string\",\n          description: \"Absolute or relative path to the file to edit.\",\n        },\n        old_string: {\n          type: \"string\",\n          description: \"The exact string to find and replace. Must be unique in the file.\",\n        },\n        new_string: {\n          type: \"string\",\n          description: \"The replacement string.\",\n        },\n        replace_all: {\n          type: \"boolean\",\n          description: \"If true, replace all occurrences. Default: false.\",\n        },\n      },\n      required: [\"file_path\", \"old_string\", \"new_string\"],\n    },\n    async execute(input) {\n      const filePath = path.resolve(\n        context.cwd,\n        input.file_path as string\n      );\n      const oldString = input.old_string as string;\n      const newString = input.new_string as string;\n      const replaceAll = (input.replace_all as boolean) ?? false;\n\n      if (!fs.existsSync(filePath)) {\n        return `Error: File does not exist: ${filePath}`;\n      }\n\n      const content = await fs.promises.readFile(filePath, \"utf-8\");\n\n      if (!content.includes(oldString)) {\n        return `Error: old_string not found in file. Make sure the string matches exactly (including whitespace).`;\n      }\n\n      if (!replaceAll) {\n        // Check uniqueness.\n        const firstIndex = content.indexOf(oldString);\n        const secondIndex = content.indexOf(oldString, firstIndex + 1);\n        if (secondIndex !== -1) {\n          return `Error: old_string appears multiple times in the file. Provide more context to make it unique, or set replace_all to true.`;\n        }\n      }\n\n      let newContent: string;\n      if (replaceAll) {\n        newContent = content.split(oldString).join(newString);\n      } else {\n        newContent = content.replace(oldString, newString);\n      }\n\n      await fs.promises.writeFile(filePath, newContent, \"utf-8\");\n\n      const linesChanged = newString.split(\"\\n\").length - oldString.split(\"\\n\").length;\n      const changeDesc = linesChanged === 0\n        ? \"modified\"\n        : linesChanged > 0\n          ? `added ${linesChanged} lines`\n          : `removed ${Math.abs(linesChanged)} lines`;\n\n      return `Successfully edited ${filePath}: ${changeDesc}`;\n    },\n  };\n}\n","import { execa } from \"execa\";\n\nimport type { Tool, ToolContext } from \"./index.js\";\n\nconst DEFAULT_TIMEOUT_MS = 120000;\nconst MAX_OUTPUT_LENGTH = 30000;\n\nexport function bashTool(context: ToolContext): Tool {\n  return {\n    name: \"bash\",\n    description:\n      \"Execute a bash command. Returns stdout, stderr, and exit code. \" +\n      \"Commands run in the project working directory. \" +\n      \"Use for running tests, builds, git operations, and other system commands.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        command: {\n          type: \"string\",\n          description: \"The bash command to execute.\",\n        },\n        timeout_ms: {\n          type: \"number\",\n          description: `Timeout in milliseconds. Default: ${DEFAULT_TIMEOUT_MS}.`,\n        },\n        cwd: {\n          type: \"string\",\n          description: \"Working directory for the command. Default: project root.\",\n        },\n      },\n      required: [\"command\"],\n    },\n    async execute(input) {\n      const command = input.command as string;\n      const timeoutMs = (input.timeout_ms as number) ?? DEFAULT_TIMEOUT_MS;\n      const cwd = (input.cwd as string) ?? context.cwd;\n\n      try {\n        const result = await execa(\"bash\", [\"-c\", command], {\n          cwd,\n          timeout: timeoutMs,\n          stdio: \"pipe\",\n          buffer: true,\n          env: {\n            ...process.env,\n            TERM: \"dumb\",\n            NO_COLOR: \"1\",\n          },\n        });\n\n        let output = \"\";\n        if (result.stdout) {\n          output += result.stdout;\n        }\n        if (result.stderr) {\n          output += (output ? \"\\n\\nSTDERR:\\n\" : \"STDERR:\\n\") + result.stderr;\n        }\n\n        if (output.length > MAX_OUTPUT_LENGTH) {\n          output = output.substring(0, MAX_OUTPUT_LENGTH) + \"\\n\\n[output truncated]\";\n        }\n\n        if (!output) {\n          output = \"(no output)\";\n        }\n\n        return `Exit code: ${result.exitCode}\\n${output}`;\n      } catch (err: unknown) {\n        if (\n          err &&\n          typeof err === \"object\" &&\n          \"stdout\" in err &&\n          \"stderr\" in err\n        ) {\n          const execErr = err as {\n            exitCode?: number;\n            stdout?: string;\n            stderr?: string;\n            timedOut?: boolean;\n            signal?: string;\n          };\n\n          if (execErr.timedOut) {\n            return `Error: Command timed out after ${timeoutMs}ms`;\n          }\n\n          let output = \"\";\n          if (execErr.stdout) {\n            output += execErr.stdout;\n          }\n          if (execErr.stderr) {\n            output += (output ? \"\\n\\nSTDERR:\\n\" : \"STDERR:\\n\") + execErr.stderr;\n          }\n\n          if (output.length > MAX_OUTPUT_LENGTH) {\n            output = output.substring(0, MAX_OUTPUT_LENGTH) + \"\\n\\n[output truncated]\";\n          }\n\n          return `Exit code: ${execErr.exitCode ?? 1}\\n${output || \"(no output)\"}`;\n        }\n\n        const message = err instanceof Error ? err.message : String(err);\n        return `Error executing command: ${message}`;\n      }\n    },\n  };\n}\n","import { glob as globFn } from \"glob\";\nimport path from \"path\";\nimport { stat } from \"fs/promises\";\n\nimport type { Tool, ToolContext } from \"./index.js\";\n\nconst DEFAULT_LIMIT = 100;\nconst DEFAULT_EXCLUDES = [\n  \"**/node_modules/**\",\n  \"**/.git/**\",\n  \"**/dist/**\",\n  \"**/build/**\",\n  \"**/.next/**\",\n  \"**/coverage/**\",\n];\n\nexport function globTool(context: ToolContext): Tool {\n  return {\n    name: \"glob\",\n    description:\n      \"Find files matching a glob pattern. Returns file paths sorted by modification time. \" +\n      'Examples: \"**/*.ts\", \"src/**/*.tsx\", \"package.json\".',\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        pattern: {\n          type: \"string\",\n          description: \"The glob pattern to match files against.\",\n        },\n        directory: {\n          type: \"string\",\n          description: \"Directory to search in. Default: project root.\",\n        },\n        limit: {\n          type: \"number\",\n          description: `Maximum number of results. Default: ${DEFAULT_LIMIT}.`,\n        },\n      },\n      required: [\"pattern\"],\n    },\n    async execute(input) {\n      const pattern = input.pattern as string;\n      const directory = (input.directory as string)\n        ? path.resolve(context.cwd, input.directory as string)\n        : context.cwd;\n      const limit = (input.limit as number) ?? DEFAULT_LIMIT;\n\n      const files = await globFn(pattern, {\n        cwd: directory,\n        ignore: DEFAULT_EXCLUDES,\n        nodir: true,\n        absolute: false,\n      });\n\n      if (files.length === 0) {\n        return \"No files found matching the pattern.\";\n      }\n\n      // Sort by modification time (most recent first).\n      const filesWithStats = await Promise.all(\n        files.slice(0, limit * 2).map(async (f) => {\n          const fullPath = path.resolve(directory, f);\n          try {\n            const s = await stat(fullPath);\n            return { file: f, mtimeMs: s.mtimeMs };\n          } catch {\n            return { file: f, mtimeMs: 0 };\n          }\n        })\n      );\n\n      filesWithStats.sort((a, b) => b.mtimeMs - a.mtimeMs);\n      const limited = filesWithStats.slice(0, limit);\n\n      let result = limited.map((f) => f.file).join(\"\\n\");\n\n      if (files.length > limit) {\n        result += `\\n\\n(${files.length - limit} more files not shown)`;\n      }\n\n      return result;\n    },\n  };\n}\n","import path from \"path\";\n\nimport type { Tool, ToolContext } from \"./index.js\";\nimport { performGrep, formatGrepRes } from \"../utils/grep.js\";\n\nconst MAX_RESULTS = 200;\nconst MAX_LINE_LENGTH = 2000;\n\nexport function grepTool(context: ToolContext): Tool {\n  return {\n    name: \"grep\",\n    description:\n      \"Search file contents using regex patterns. Returns matching lines with file paths and line numbers. \" +\n      \"Uses extended regular expression syntax.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        pattern: {\n          type: \"string\",\n          description: \"The regex pattern to search for.\",\n        },\n        directory: {\n          type: \"string\",\n          description: \"Directory to search in. Default: project root.\",\n        },\n        file_pattern: {\n          type: \"string\",\n          description: 'Optional glob to filter files. E.g. \"*.ts\", \"*.py\".',\n        },\n      },\n      required: [\"pattern\"],\n    },\n    async execute(input) {\n      const pattern = input.pattern as string;\n      const directory = (input.directory as string)\n        ? path.resolve(context.cwd, input.directory as string)\n        : context.cwd;\n      const filePattern = input.file_pattern as string | undefined;\n\n      const grepResult = await performGrep(pattern, directory, filePattern);\n\n      if (grepResult.isErr()) {\n        return `Error: ${grepResult.error.message}`;\n      }\n\n      const rawOutput = grepResult.value;\n\n      if (!rawOutput.trim()) {\n        return \"No matches found.\";\n      }\n\n      const results = formatGrepRes(rawOutput, directory);\n\n      if (results.length === 0) {\n        return \"No matches found.\";\n      }\n\n      const limited = results.slice(0, MAX_RESULTS);\n      const lines = limited.map((r) => {\n        const content =\n          r.content.length > MAX_LINE_LENGTH\n            ? r.content.substring(0, MAX_LINE_LENGTH) + \"... [cut]\"\n            : r.content;\n        return `${r.filePath}:${r.lineNumber}: ${content}`;\n      });\n\n      let output = lines.join(\"\\n\");\n\n      if (results.length > MAX_RESULTS) {\n        output += `\\n\\n(${results.length - MAX_RESULTS} more results not shown)`;\n      }\n\n      return output;\n    },\n  };\n}\n","import type { Result } from \"@dust-tt/client\";\nimport { Err, Ok } from \"@dust-tt/client\";\nimport { spawn } from \"child_process\";\nimport { EOL } from \"os\";\nimport path from \"path\";\n\nimport { normalizeError } from \"./errors.js\";\n\ninterface GrepResult {\n  filePath: string;\n  content: string;\n  lineNumber: number;\n}\n\nexport async function performGrep(\n  pattern: string,\n  searchPath: string,\n  filePattern?: string\n): Promise<Result<string, Error>> {\n  const grepArgs = [\"-r\", \"-n\", \"-H\", \"-E\"];\n  const commonExcludes = [\".git\", \"node_modules\", \"bower_components\"];\n  for (const dir of commonExcludes) {\n    grepArgs.push(`--exclude-dir=${dir}`);\n  }\n  if (filePattern) {\n    grepArgs.push(`--include=${filePattern}`);\n  }\n  grepArgs.push(pattern);\n  grepArgs.push(\".\");\n\n  try {\n    const output = await new Promise<string>((resolve, reject) => {\n      const child = spawn(\"grep\", grepArgs, {\n        cwd: searchPath,\n        windowsHide: true,\n      });\n      const stdoutChunks: Buffer[] = [];\n      const stderrChunks: Buffer[] = [];\n\n      const onData = (chunk: Buffer) => stdoutChunks.push(chunk);\n      const onStderr = (chunk: Buffer) => {\n        const stderrStr = chunk.toString();\n        if (\n          !stderrStr.includes(\"Permission denied\") &&\n          !/grep:.*: Is a directory/i.test(stderrStr)\n        ) {\n          stderrChunks.push(chunk);\n        }\n      };\n      const onError = (err: Error) => {\n        cleanup();\n        reject(new Error(`Failed to start system grep: ${err.message}`));\n      };\n      const onClose = (code: number | null) => {\n        const stdoutData = Buffer.concat(stdoutChunks).toString(\"utf8\");\n        const stderrData = Buffer.concat(stderrChunks).toString(\"utf8\").trim();\n        cleanup();\n        if (code === 0) {\n          resolve(stdoutData);\n        } else if (code === 1) {\n          resolve(\"\");\n        } else {\n          if (stderrData) {\n            reject(\n              new Error(`System grep exited with code ${code}: ${stderrData}`)\n            );\n          } else {\n            resolve(\"\");\n          }\n        }\n      };\n\n      const cleanup = () => {\n        child.stdout.removeListener(\"data\", onData);\n        child.stderr.removeListener(\"data\", onStderr);\n        child.removeListener(\"error\", onError);\n        child.removeListener(\"close\", onClose);\n        if (child.connected) {\n          child.disconnect();\n        }\n      };\n\n      child.stdout.on(\"data\", onData);\n      child.stderr.on(\"data\", onStderr);\n      child.on(\"error\", onError);\n      child.on(\"close\", onClose);\n    });\n\n    return new Ok(output);\n  } catch (grepError: unknown) {\n    return new Err(normalizeError(grepError));\n  }\n}\n\nexport function formatGrepRes(\n  unformattedGrep: string,\n  basePath: string\n): GrepResult[] {\n  const grepResults: GrepResult[] = [];\n\n  const grepLines = unformattedGrep.split(EOL);\n  for (const line of grepLines) {\n    if (!line.trim()) {\n      continue;\n    }\n\n    const firstColon = line.indexOf(\":\");\n    if (firstColon === -1) {\n      continue;\n    }\n    const secondColon = line.indexOf(\":\", firstColon + 1);\n    if (secondColon === -1) {\n      continue;\n    }\n\n    const unformattedFilePath = line.substring(0, firstColon);\n    const absPath = path.resolve(basePath, unformattedFilePath);\n    const relativePath = path.relative(basePath, absPath);\n\n    const sLineNumber = line.substring(firstColon + 1, secondColon);\n    const lineNumber = parseInt(sLineNumber);\n\n    if (isNaN(lineNumber)) {\n      continue;\n    }\n\n    const content = line.substring(secondColon + 1);\n\n    grepResults.push({\n      filePath: relativePath,\n      lineNumber,\n      content,\n    });\n  }\n\n  return grepResults;\n}\n","import type { Tool, ToolContext } from \"./index.js\";\n\nexport function askUserTool(context: ToolContext): Tool {\n  return {\n    name: \"ask_user\",\n    description:\n      \"Ask the user a question and wait for their response. \" +\n      \"Use this when you need clarification, approval, or input from the user.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        question: {\n          type: \"string\",\n          description: \"The question to ask the user.\",\n        },\n      },\n      required: [\"question\"],\n    },\n    async execute(input) {\n      const question = input.question as string;\n      return context.askUser(question);\n    },\n  };\n}\n","import type { DustAPI } from \"@dust-tt/client\";\n\nimport { createAgentLoop } from \"../agent/loop.js\";\nimport { buildSystemPrompt } from \"../agent/systemPrompt.js\";\nimport type { Tool, ToolContext } from \"./index.js\";\nimport { createTools, getToolDefinitions, executeTool as executeToolCall } from \"./index.js\";\n\nexport function taskTool(context: ToolContext): Tool {\n  return {\n    name: \"task\",\n    description:\n      \"Launch a sub-agent to handle a task. The sub-agent runs with its own conversation \" +\n      \"and can use tools independently. Use this for parallel work or isolated tasks. \" +\n      'Two modes: \"local\" spawns a local coding sub-agent, \"dust_agent\" delegates to a Dust workspace agent.',\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        type: {\n          type: \"string\",\n          enum: [\"local\", \"dust_agent\"],\n          description: '\"local\" for a coding sub-agent, \"dust_agent\" to call a Dust workspace agent.',\n        },\n        prompt: {\n          type: \"string\",\n          description: \"The task description or prompt for the sub-agent.\",\n        },\n        agent: {\n          type: \"string\",\n          description: 'For dust_agent type: the agent name (e.g. \"@security-auditor\").',\n        },\n        tools: {\n          type: \"array\",\n          items: { type: \"string\" },\n          description:\n            \"For local type: subset of tool names to enable. Default: all tools except task.\",\n        },\n      },\n      required: [\"type\", \"prompt\"],\n    },\n    async execute(input) {\n      const taskType = input.type as string;\n      const prompt = input.prompt as string;\n\n      if (taskType === \"dust_agent\") {\n        const agentName = input.agent as string;\n        if (!agentName) {\n          return 'Error: \"agent\" is required for dust_agent type.';\n        }\n        if (!context.dustClient) {\n          return \"Error: Dust client not available.\";\n        }\n\n        // Delegate to callDustAgent via direct import.\n        const { callDustAgentTool } = await import(\"./callDustAgent.js\");\n        const tool = callDustAgentTool(context);\n        return tool.execute({ agent: agentName, message: prompt });\n      }\n\n      if (taskType === \"local\") {\n        return runLocalSubAgent(context, prompt, input.tools as string[] | undefined);\n      }\n\n      return `Error: Unknown task type \"${taskType}\". Use \"local\" or \"dust_agent\".`;\n    },\n  };\n}\n\nasync function runLocalSubAgent(\n  context: ToolContext,\n  prompt: string,\n  toolSubset?: string[]\n): Promise<string> {\n  const dustClient = context.dustClient;\n  if (!dustClient) {\n    return \"Error: Dust client not available for sub-agent.\";\n  }\n\n  // Create tools for the sub-agent (no task tool to prevent recursion).\n  const allTools = createTools({\n    ...context,\n    askUser: async () => \"(sub-agent cannot ask user questions directly)\",\n  });\n\n  let enabledTools = allTools.filter((t) => t.name !== \"task\");\n\n  if (toolSubset && toolSubset.length > 0) {\n    const subsetSet = new Set(toolSubset);\n    enabledTools = enabledTools.filter((t) => subsetSet.has(t.name));\n  }\n\n  const toolDefs = getToolDefinitions(enabledTools);\n  const systemPrompt = buildSystemPrompt(context.cwd) +\n    \"\\n\\nYou are a sub-agent handling a specific task. Complete the task and return a clear summary of what you did.\";\n\n  const loop = createAgentLoop({\n    dustClient,\n    systemPrompt,\n    tools: toolDefs,\n    executeTool: (call) => executeToolCall(enabledTools, call, context.approveToolCall),\n    maxTokens: 8192,\n  });\n\n  // Collect all text output from the sub-agent.\n  let responseText = \"\";\n  let isDone = false;\n\n  // Start the agent with the task prompt.\n  loop.sendMessage(prompt);\n\n  for await (const event of loop.events()) {\n    switch (event.type) {\n      case \"text_delta\":\n        responseText += event.text;\n        break;\n      case \"done\":\n        isDone = true;\n        break;\n      case \"error\":\n        return `Sub-agent error: ${event.message}`;\n    }\n\n    if (isDone) {\n      break;\n    }\n  }\n\n  return responseText || \"(sub-agent returned no output)\";\n}\n","import type { ToolCall, ToolDefinition } from \"../agent/types.js\";\n\nimport { readFileTool } from \"./readFile.js\";\nimport { writeFileTool } from \"./writeFile.js\";\nimport { editFileTool } from \"./editFile.js\";\nimport { bashTool } from \"./bash.js\";\nimport { globTool } from \"./glob.js\";\nimport { grepTool } from \"./grep.js\";\nimport { askUserTool } from \"./askUser.js\";\nimport { callDustAgentTool } from \"./callDustAgent.js\";\nimport { taskTool } from \"./task.js\";\nimport type { DustAPI } from \"@dust-tt/client\";\n\nexport interface Tool {\n  name: string;\n  description: string;\n  inputSchema: Record<string, unknown>;\n  execute(input: Record<string, unknown>): Promise<string>;\n}\n\nexport interface ToolContext {\n  cwd: string;\n  dustClient: DustAPI | null;\n  askUser: (question: string) => Promise<string>;\n  approveToolCall: (call: ToolCall) => Promise<boolean>;\n  onSubAgentEvent?: (taskId: string, event: unknown) => void;\n}\n\nconst AUTO_APPROVED_TOOLS = new Set([\"read_file\", \"glob\", \"grep\", \"ask_user\"]);\n\n/**\n * Create all tools with the given context.\n */\nexport function createTools(context: ToolContext): Tool[] {\n  const tools: Tool[] = [\n    readFileTool(context),\n    writeFileTool(context),\n    editFileTool(context),\n    bashTool(context),\n    globTool(context),\n    grepTool(context),\n    askUserTool(context),\n  ];\n\n  if (context.dustClient) {\n    tools.push(callDustAgentTool(context));\n    tools.push(taskTool(context));\n  }\n\n  return tools;\n}\n\n/**\n * Get tool definitions for the LLM.\n */\nexport function getToolDefinitions(tools: Tool[]): ToolDefinition[] {\n  return tools.map((t) => ({\n    name: t.name,\n    description: t.description,\n    inputSchema: t.inputSchema,\n  }));\n}\n\n/**\n * Execute a tool call, gating on user approval for non-auto-approved tools.\n */\nexport async function executeTool(\n  tools: Tool[],\n  call: ToolCall,\n  approveToolCall: (call: ToolCall) => Promise<boolean>\n): Promise<string> {\n  const tool = tools.find((t) => t.name === call.name);\n  if (!tool) {\n    return `Error: Unknown tool \"${call.name}\"`;\n  }\n\n  if (!AUTO_APPROVED_TOOLS.has(call.name)) {\n    const approved = await approveToolCall(call);\n    if (!approved) {\n      return \"Tool execution rejected by user.\";\n    }\n  }\n\n  try {\n    return await tool.execute(call.input);\n  } catch (err) {\n    const message = err instanceof Error ? err.message : String(err);\n    return `Error executing ${call.name}: ${message}`;\n  }\n}\n","import React, { useState } from \"react\";\nimport { Box, Text, useInput } from \"ink\";\n\nimport type { Command } from \"./commands/types.js\";\nimport { CommandSelector } from \"./CommandSelector.js\";\n\ninterface InputBoxProps {\n  onSubmit: (text: string) => void;\n  onCommandSelect: (command: Command) => void;\n  commands: Command[];\n  placeholder?: string;\n  disabled?: boolean;\n}\n\nexport function InputBox({\n  onSubmit,\n  onCommandSelect,\n  commands,\n  placeholder = \"Type a message...\",\n  disabled = false,\n}: InputBoxProps) {\n  const [value, setValue] = useState(\"\");\n  const [cursorPosition, setCursorPosition] = useState(0);\n\n  // Command mode state.\n  const [showCommandSelector, setShowCommandSelector] = useState(false);\n  const [commandQuery, setCommandQuery] = useState(\"\");\n  const [selectedCommandIndex, setSelectedCommandIndex] = useState(0);\n\n  const getFilteredCommands = () =>\n    commands.filter((cmd) =>\n      cmd.name.toLowerCase().startsWith(commandQuery.toLowerCase())\n    );\n\n  const exitCommandMode = () => {\n    setShowCommandSelector(false);\n    setCommandQuery(\"\");\n    setSelectedCommandIndex(0);\n  };\n\n  useInput(\n    (input, key) => {\n      if (disabled) return;\n\n      // --- Command mode handling ---\n      if (showCommandSelector) {\n        if (key.escape) {\n          exitCommandMode();\n          return;\n        }\n\n        if (key.upArrow) {\n          setSelectedCommandIndex((prev) => Math.max(0, prev - 1));\n          return;\n        }\n\n        if (key.downArrow) {\n          const filtered = getFilteredCommands();\n          setSelectedCommandIndex((prev) =>\n            Math.min(filtered.length - 1, prev + 1)\n          );\n          return;\n        }\n\n        if (key.return) {\n          const filtered = getFilteredCommands();\n          if (filtered.length > 0 && selectedCommandIndex < filtered.length) {\n            const selected = filtered[selectedCommandIndex];\n            exitCommandMode();\n            setValue(\"\");\n            setCursorPosition(0);\n            onCommandSelect(selected);\n          }\n          return;\n        }\n\n        if (key.backspace || key.delete) {\n          if (commandQuery.length > 0) {\n            setCommandQuery((prev) => prev.slice(0, -1));\n            setSelectedCommandIndex(0);\n          } else {\n            exitCommandMode();\n          }\n          return;\n        }\n\n        // Regular character → append to command query.\n        if (!key.ctrl && !key.meta && input && input.length === 1) {\n          setCommandQuery((prev) => prev + input);\n          setSelectedCommandIndex(0);\n        }\n        return;\n      }\n\n      // --- Normal input mode ---\n\n      // Enter command mode when \"/\" is typed on empty input.\n      if (\n        input === \"/\" &&\n        value === \"\" &&\n        cursorPosition === 0 &&\n        !key.ctrl &&\n        !key.meta\n      ) {\n        setShowCommandSelector(true);\n        setCommandQuery(\"\");\n        setSelectedCommandIndex(0);\n        return;\n      }\n\n      if (key.return) {\n        // Backslash before Enter → insert newline.\n        if (cursorPosition > 0 && value[cursorPosition - 1] === \"\\\\\") {\n          const newValue =\n            value.slice(0, cursorPosition - 1) +\n            \"\\n\" +\n            value.slice(cursorPosition);\n          setValue(newValue);\n          return;\n        }\n\n        if (value.trim()) {\n          onSubmit(value.trim());\n          setValue(\"\");\n          setCursorPosition(0);\n        }\n        return;\n      }\n\n      if (key.backspace || key.delete) {\n        if (cursorPosition > 0) {\n          setValue(\n            value.slice(0, cursorPosition - 1) + value.slice(cursorPosition)\n          );\n          setCursorPosition(cursorPosition - 1);\n        }\n        return;\n      }\n\n      if (key.ctrl && input === \"c\") {\n        process.exit(0);\n      }\n\n      if (key.ctrl && input === \"u\") {\n        setValue(\"\");\n        setCursorPosition(0);\n        return;\n      }\n\n      // Ctrl+A → beginning of current line.\n      if (key.ctrl && input === \"a\") {\n        let newPos = cursorPosition;\n        while (newPos > 0 && value[newPos - 1] !== \"\\n\") {\n          newPos--;\n        }\n        setCursorPosition(newPos);\n        return;\n      }\n\n      // Ctrl+E → end of current line.\n      if (key.ctrl && input === \"e\") {\n        let newPos = cursorPosition;\n        while (newPos < value.length && value[newPos] !== \"\\n\") {\n          newPos++;\n        }\n        setCursorPosition(newPos);\n        return;\n      }\n\n      // Option+Left (meta+b) → previous word.\n      if (key.meta && input === \"b\" && cursorPosition > 0) {\n        let newPos = cursorPosition - 1;\n        while (newPos > 0 && /\\s/.test(value[newPos])) {\n          newPos--;\n        }\n        while (newPos > 0 && !/\\s/.test(value[newPos - 1])) {\n          newPos--;\n        }\n        setCursorPosition(newPos);\n        return;\n      }\n\n      // Option+Right (meta+f) → next word.\n      if (key.meta && input === \"f\" && cursorPosition < value.length) {\n        let newPos = cursorPosition;\n        if (/\\s/.test(value[newPos])) {\n          while (\n            newPos < value.length &&\n            /\\s/.test(value[newPos]) &&\n            value[newPos] !== \"\\n\"\n          ) {\n            newPos++;\n          }\n          if (value[newPos] === \"\\n\") {\n            setCursorPosition(newPos);\n            return;\n          }\n        } else {\n          while (newPos < value.length && !/\\s/.test(value[newPos])) {\n            newPos++;\n          }\n          while (\n            newPos < value.length &&\n            /\\s/.test(value[newPos]) &&\n            value[newPos] !== \"\\n\"\n          ) {\n            newPos++;\n          }\n        }\n        setCursorPosition(newPos);\n        return;\n      }\n\n      // Left arrow.\n      if (key.leftArrow && cursorPosition > 0) {\n        setCursorPosition(cursorPosition - 1);\n        return;\n      }\n\n      // Right arrow.\n      if (key.rightArrow && cursorPosition < value.length) {\n        setCursorPosition(cursorPosition + 1);\n        return;\n      }\n\n      // Up arrow → move to previous line.\n      if (key.upArrow) {\n        const lines = value.split(\"\\n\");\n        let pos = 0;\n        let lineIndex = 0;\n        let posInLine = 0;\n\n        for (let i = 0; i < lines.length; i++) {\n          if (\n            cursorPosition >= pos &&\n            cursorPosition <= pos + lines[i].length\n          ) {\n            lineIndex = i;\n            posInLine = cursorPosition - pos;\n            break;\n          }\n          pos += lines[i].length + 1;\n        }\n\n        if (lineIndex > 0) {\n          const prevLineLength = lines[lineIndex - 1].length;\n          const newPosInLine = Math.min(posInLine, prevLineLength);\n          let newCursorPos = 0;\n          for (let i = 0; i < lineIndex - 1; i++) {\n            newCursorPos += lines[i].length + 1;\n          }\n          newCursorPos += newPosInLine;\n          setCursorPosition(newCursorPos);\n        } else {\n          setCursorPosition(0);\n        }\n        return;\n      }\n\n      // Down arrow → move to next line.\n      if (key.downArrow) {\n        const lines = value.split(\"\\n\");\n        let pos = 0;\n        let lineIndex = 0;\n        let posInLine = 0;\n\n        for (let i = 0; i < lines.length; i++) {\n          if (\n            cursorPosition >= pos &&\n            cursorPosition <= pos + lines[i].length\n          ) {\n            lineIndex = i;\n            posInLine = cursorPosition - pos;\n            break;\n          }\n          pos += lines[i].length + 1;\n        }\n\n        if (lineIndex < lines.length - 1) {\n          const nextLineLength = lines[lineIndex + 1].length;\n          const newPosInLine = Math.min(posInLine, nextLineLength);\n          let newCursorPos = 0;\n          for (let i = 0; i <= lineIndex; i++) {\n            newCursorPos += lines[i].length + 1;\n          }\n          newCursorPos += newPosInLine;\n          setCursorPosition(newCursorPos);\n        } else {\n          setCursorPosition(value.length);\n        }\n        return;\n      }\n\n      // Regular character input.\n      if (!key.ctrl && !key.meta && input) {\n        if (input.length > 1) {\n          // Paste support.\n          const normalized = input.replace(/\\r/g, \"\\n\");\n          const newValue =\n            value.slice(0, cursorPosition) +\n            normalized +\n            value.slice(cursorPosition);\n          setValue(newValue);\n          setCursorPosition(cursorPosition + normalized.length);\n        } else {\n          const newValue =\n            value.slice(0, cursorPosition) +\n            input +\n            value.slice(cursorPosition);\n          setValue(newValue);\n          setCursorPosition(cursorPosition + 1);\n        }\n      }\n    },\n    { isActive: !disabled }\n  );\n\n  // Compute display text and cursor position.\n  const displayValue = showCommandSelector ? `/${commandQuery}` : value;\n  const displayCursorPosition = showCommandSelector\n    ? commandQuery.length + 1\n    : cursorPosition;\n\n  const lines = displayValue.split(\"\\n\");\n  let currentPos = 0;\n  let cursorLine = 0;\n  let cursorPosInLine = 0;\n\n  for (let i = 0; i < lines.length; i++) {\n    if (\n      displayCursorPosition >= currentPos &&\n      displayCursorPosition <= currentPos + lines[i].length\n    ) {\n      cursorLine = i;\n      cursorPosInLine = displayCursorPosition - currentPos;\n      break;\n    }\n    currentPos += lines[i].length + 1;\n  }\n\n  return (\n    <Box flexDirection=\"column\">\n      {/* Command selector dropdown */}\n      {showCommandSelector && !disabled && (\n        <CommandSelector\n          query={commandQuery}\n          selectedIndex={selectedCommandIndex}\n          commands={commands}\n        />\n      )}\n\n      <Box\n        flexDirection=\"column\"\n        borderStyle=\"round\"\n        borderColor={disabled ? \"gray\" : \"blue\"}\n        paddingLeft={1}\n        paddingRight={1}\n      >\n        {displayValue ? (\n          lines.map((line, index) => (\n            <Box key={index}>\n              {index === 0 && (\n                <Text color=\"blue\" bold>\n                  {\">\"}{\" \"}\n                </Text>\n              )}\n              {index !== 0 && <Text>{\"  \"}</Text>}\n              {!disabled && index === cursorLine ? (\n                <>\n                  <Text>{line.substring(0, cursorPosInLine)}</Text>\n                  <Text backgroundColor=\"blue\" color=\"white\">\n                    {line.charAt(cursorPosInLine) || \" \"}\n                  </Text>\n                  <Text>{line.substring(cursorPosInLine + 1)}</Text>\n                </>\n              ) : (\n                <Text>{line === \"\" ? \" \" : line}</Text>\n              )}\n            </Box>\n          ))\n        ) : (\n          <Box>\n            <Text color=\"blue\" bold>\n              {\">\"}{\" \"}\n            </Text>\n            {disabled ? (\n              <Text> </Text>\n            ) : (\n              <>\n                <Text backgroundColor=\"blue\" color=\"white\">\n                  {\" \"}\n                </Text>\n                <Text dimColor> {placeholder}</Text>\n              </>\n            )}\n          </Box>\n        )}\n      </Box>\n      {!disabled && (\n        <Box marginLeft={1}>\n          <Text dimColor>\n            {showCommandSelector\n              ? \"↑↓ to navigate · Enter to select · Esc to cancel\"\n              : \"Enter to send · \\\\Enter for newline · / for commands · Ctrl+C to exit\"}\n          </Text>\n        </Box>\n      )}\n    </Box>\n  );\n}\n","import { Box, Text } from \"ink\";\nimport React from \"react\";\n\nimport type { Command } from \"./commands/types.js\";\n\ninterface CommandSelectorProps {\n  query: string;\n  selectedIndex: number;\n  commands: Command[];\n}\n\nexport function CommandSelector({\n  query,\n  selectedIndex,\n  commands,\n}: CommandSelectorProps) {\n  const filteredCommands = commands.filter((command) =>\n    command.name.toLowerCase().startsWith(query.toLowerCase())\n  );\n\n  if (filteredCommands.length === 0) {\n    return (\n      <Box flexDirection=\"column\">\n        <Box paddingX={1}>\n          <Text dimColor>No commands found</Text>\n        </Box>\n      </Box>\n    );\n  }\n\n  return (\n    <Box flexDirection=\"column\">\n      <Box paddingX={1} flexDirection=\"column\">\n        {filteredCommands.map((command, index) => {\n          const isSelected = index === selectedIndex;\n          return (\n            <Box key={command.name} flexDirection=\"row\">\n              <Box width={15}>\n                <Text\n                  color={isSelected ? \"blue\" : undefined}\n                  bold={isSelected}\n                >\n                  /{command.name}\n                </Text>\n              </Box>\n              <Text dimColor={!isSelected}>{command.description}</Text>\n            </Box>\n          );\n        })}\n      </Box>\n    </Box>\n  );\n}\n","import { Box, Text, useInput } from \"ink\";\nimport type { FC } from \"react\";\nimport React, { useState } from \"react\";\n\nimport type { ToolCall } from \"../agent/types.js\";\n\ninterface ApprovalOption {\n  id: \"approve\" | \"reject\";\n  label: string;\n  description: string;\n}\n\nconst APPROVAL_OPTIONS: ApprovalOption[] = [\n  { id: \"approve\", label: \"Approve\", description: \"Execute this tool call\" },\n  {\n    id: \"reject\",\n    label: \"Reject\",\n    description: \"Block and return error to agent\",\n  },\n];\n\nfunction getToolSummary(call: ToolCall): string {\n  const input = call.input;\n  switch (call.name) {\n    case \"bash\":\n      return typeof input.command === \"string\" ? input.command : \"\";\n    case \"edit_file\":\n    case \"write_file\":\n    case \"read_file\":\n      return typeof input.path === \"string\" ? input.path : \"\";\n    case \"call_dust_agent\":\n      return typeof input.agent === \"string\" ? input.agent : \"\";\n    case \"task\":\n      return typeof input.description === \"string\" ? input.description : \"\";\n    default:\n      return JSON.stringify(input, null, 2);\n  }\n}\n\ninterface ToolApprovalSelectorProps {\n  call: ToolCall;\n  onApproval: (approved: boolean) => void;\n}\n\nexport const ToolApprovalSelector: FC<ToolApprovalSelectorProps> = ({\n  call,\n  onApproval,\n}) => {\n  const [cursor, setCursor] = useState(0);\n\n  useInput((_input, key) => {\n    if (key.upArrow) {\n      setCursor((prev) => (prev > 0 ? prev - 1 : APPROVAL_OPTIONS.length - 1));\n      return;\n    }\n\n    if (key.downArrow) {\n      setCursor((prev) => (prev < APPROVAL_OPTIONS.length - 1 ? prev + 1 : 0));\n      return;\n    }\n\n    if (key.return) {\n      const selectedOption = APPROVAL_OPTIONS[cursor];\n      onApproval(selectedOption.id === \"approve\");\n      return;\n    }\n  });\n\n  const summary = getToolSummary(call);\n\n  return (\n    <Box flexDirection=\"column\">\n      <Box paddingX={1} flexDirection=\"column\" marginTop={1}>\n        <Text color=\"yellow\" bold>\n          {call.name}\n        </Text>\n        {summary && <Text>{summary}</Text>}\n      </Box>\n      <Box paddingX={1} flexDirection=\"column\">\n        {APPROVAL_OPTIONS.map((option, index) => {\n          const isSelected = index === cursor;\n          return (\n            <Box key={option.id} flexDirection=\"row\">\n              <Box width={15}>\n                <Text\n                  color={isSelected ? \"blue\" : undefined}\n                  bold={isSelected}\n                >\n                  {option.label}\n                </Text>\n              </Box>\n              <Text dimColor={!isSelected}>{option.description}</Text>\n            </Box>\n          );\n        })}\n      </Box>\n    </Box>\n  );\n};\n","import React from \"react\";\nimport { Box, Text } from \"ink\";\n\ninterface ToolCallDisplay {\n  id: string;\n  name: string;\n  input: Record<string, unknown>;\n  status: \"executing\" | \"done\";\n  result?: string;\n  startTime?: number;\n  duration?: number;\n}\n\ninterface ToolExecutionProps {\n  toolCalls: ToolCallDisplay[];\n}\n\nconst TOOL_LABELS: Record<string, string> = {\n  read_file: \"Read\",\n  write_file: \"Write\",\n  edit_file: \"Edit\",\n  bash: \"Bash\",\n  grep: \"Search\",\n  glob: \"Files\",\n  ask_user: \"Ask\",\n  call_dust_agent: \"Agent\",\n  task: \"Task\",\n};\n\nfunction getLabel(name: string): string {\n  return TOOL_LABELS[name] || name;\n}\n\nfunction getPrimaryParam(\n  name: string,\n  input: Record<string, unknown>\n): string {\n  if ([\"read_file\", \"write_file\", \"edit_file\"].includes(name)) {\n    const p = input.path || input.file_path || input.filePath;\n    return typeof p === \"string\" ? shortenFilePath(p) : \"\";\n  }\n  if (name === \"bash\") {\n    const cmd = input.command;\n    return typeof cmd === \"string\" ? truncate(cmd, 60) : \"\";\n  }\n  if (name === \"grep\") {\n    const pattern = input.pattern || input.query;\n    return typeof pattern === \"string\" ? truncate(pattern, 60) : \"\";\n  }\n  if (name === \"glob\") {\n    const pattern = input.pattern || input.glob;\n    return typeof pattern === \"string\" ? truncate(pattern, 60) : \"\";\n  }\n  if (name === \"call_dust_agent\") {\n    const agent = input.agent_name || input.agentName;\n    return typeof agent === \"string\" ? agent : \"\";\n  }\n  for (const val of Object.values(input)) {\n    if (typeof val === \"string\") {\n      return truncate(val, 60);\n    }\n  }\n  return \"\";\n}\n\nfunction shortenFilePath(p: string): string {\n  const parts = p.split(\"/\");\n  if (parts.length > 4) {\n    return \".../\" + parts.slice(-3).join(\"/\");\n  }\n  return p;\n}\n\nfunction truncate(str: string, maxLength: number): string {\n  if (str.length <= maxLength) return str;\n  return str.substring(0, maxLength) + \"…\";\n}\n\nfunction formatDuration(seconds: number): string {\n  if (seconds < 0.1) return \"\";\n  if (seconds < 10) return `${seconds.toFixed(1)}s`;\n  return `${Math.round(seconds)}s`;\n}\n\ninterface DiffLine {\n  content: string;\n  type: \"remove\" | \"add\";\n}\n\nfunction buildDiffLines(oldStr: string, newStr: string): DiffLine[] {\n  const lines: DiffLine[] = [];\n  for (const line of oldStr.split(\"\\n\")) {\n    lines.push({ content: line, type: \"remove\" });\n  }\n  for (const line of newStr.split(\"\\n\")) {\n    lines.push({ content: line, type: \"add\" });\n  }\n  return lines;\n}\n\nfunction formatResult(result: string): string[] {\n  const lines = result.split(\"\\n\").filter((l) => l.trim());\n  return lines.slice(0, 10);\n}\n\nexport function ToolExecution({ toolCalls }: ToolExecutionProps) {\n  return (\n    <Box flexDirection=\"column\">\n      {toolCalls.map((tc) => {\n        const label = getLabel(tc.name);\n        const param = getPrimaryParam(tc.name, tc.input);\n        const isRejected =\n          tc.result === \"Tool execution rejected by user.\";\n        const isError =\n          isRejected ||\n          (tc.result ? tc.result.toLowerCase().startsWith(\"error\") : false);\n        const duration = tc.duration ? formatDuration(tc.duration) : \"\";\n\n        return (\n          <Box key={tc.id} flexDirection=\"column\">\n            <Box>\n              <Text\n                color={\n                  tc.status === \"executing\"\n                    ? \"yellow\"\n                    : isError\n                      ? \"red\"\n                      : \"green\"\n                }\n              >\n                {tc.status === \"executing\" ? \"  ⟳ \" : isError ? \"  ✗ \" : \"  ✓ \"}\n              </Text>\n              <Text\n                bold\n                color={\n                  tc.status === \"executing\"\n                    ? \"yellow\"\n                    : isError\n                      ? \"red\"\n                      : \"green\"\n                }\n              >\n                {label}\n              </Text>\n              <Text color=\"gray\">{\"  \"}{param}</Text>\n              {duration && <Text dimColor>{\"  \"}{duration}</Text>}\n            </Box>\n            {tc.result && isError && (\n              <Box marginLeft={4} flexDirection=\"column\">\n                {formatResult(tc.result).map((line, i) => (\n                  <Text key={i} color=\"red\" dimColor>\n                    {line}\n                  </Text>\n                ))}\n              </Box>\n            )}\n            {tc.name === \"edit_file\" &&\n              tc.status === \"executing\" &&\n              typeof tc.input.old_string === \"string\" &&\n              typeof tc.input.new_string === \"string\" && (\n                <Box marginLeft={4} flexDirection=\"column\">\n                  {buildDiffLines(\n                    tc.input.old_string,\n                    tc.input.new_string\n                  ).map((line, i) => (\n                    <Text\n                      key={i}\n                      backgroundColor={\n                        line.type === \"remove\" ? \"#3c1518\" : \"#132d13\"\n                      }\n                    >\n                      <Text\n                        color={line.type === \"remove\" ? \"red\" : \"green\"}\n                        bold\n                      >\n                        {line.type === \"remove\" ? \" - \" : \" + \"}\n                      </Text>\n                      <Text>{line.content} </Text>\n                    </Text>\n                  ))}\n                </Box>\n              )}\n          </Box>\n        );\n      })}\n    </Box>\n  );\n}\n\nexport type { ToolCallDisplay };\n","import React from \"react\";\nimport { Box, Text } from \"ink\";\nimport { execSync } from \"child_process\";\nimport { homedir } from \"os\";\n\ninterface WelcomeHeaderProps {\n  cwd: string;\n}\n\nfunction getGitBranch(cwd: string): string {\n  try {\n    return execSync(\"git rev-parse --abbrev-ref HEAD\", {\n      cwd,\n      encoding: \"utf8\",\n      stdio: [\"pipe\", \"pipe\", \"pipe\"],\n    }).trim();\n  } catch {\n    return \"n/a\";\n  }\n}\n\nfunction shortenPath(p: string): string {\n  const home = homedir();\n  if (p.startsWith(home)) {\n    return \"~\" + p.slice(home.length);\n  }\n  return p;\n}\n\nexport function WelcomeHeader({ cwd }: WelcomeHeaderProps) {\n  const branch = getGitBranch(cwd);\n  const shortCwd = shortenPath(cwd);\n\n  return (\n    <Box marginTop={1} marginBottom={1}>\n      <Box flexDirection=\"column\" marginRight={2}>\n        <Box>\n          <Text color=\"green\" dimColor>\n            {\"█\"}\n          </Text>\n          <Text color=\"green\">{\"▀▄ \"}</Text>\n          <Text color=\"red\" dimColor>\n            {\"█ █\"}\n          </Text>\n        </Box>\n        <Box>\n          <Text color=\"green\" dimColor>\n            {\"█\"}\n          </Text>\n          <Text color=\"green\">{\"▄▀ \"}</Text>\n          <Text color=\"red\">{\"█▄█\"}</Text>\n        </Box>\n        <Box>\n          <Text color=\"blue\" dimColor>\n            {\"█▀▀ \"}\n          </Text>\n          <Text color=\"blue\" dimColor>\n            {\"▀█▀\"}\n          </Text>\n        </Box>\n        <Box>\n          <Text color=\"blue\">{\"▄██ \"}</Text>\n          <Text color=\"yellow\" dimColor>\n            {\" █ \"}\n          </Text>\n        </Box>\n      </Box>\n      <Box flexDirection=\"column\" justifyContent=\"center\">\n        <Text dimColor>\n          Dust Coding CLI · {shortCwd}\n        </Text>\n        <Text dimColor>\n          Branch: <Text bold dimColor>{branch}</Text>\n          {\" · \"}Type <Text bold dimColor>/help</Text> for commands\n        </Text>\n        <Text dimColor>\n          Enter to send · \\Enter for newline · Ctrl+C to exit\n        </Text>\n      </Box>\n    </Box>\n  );\n}\n","export interface CommandContext {\n  clearConversation?: () => void;\n  showHelp?: () => void;\n  showStatus?: () => void;\n}\n\nexport interface Command {\n  name: string;\n  description: string;\n  execute: (context: CommandContext) => void | Promise<void>;\n}\n\nexport const createCommands = (context: CommandContext): Command[] => [\n  {\n    name: \"help\",\n    description: \"Show commands and keyboard shortcuts\",\n    execute: () => {\n      if (context.showHelp) {\n        context.showHelp();\n      }\n    },\n  },\n  {\n    name: \"clear\",\n    description: \"Clear conversation history\",\n    execute: () => {\n      if (context.clearConversation) {\n        context.clearConversation();\n      }\n    },\n  },\n  {\n    name: \"status\",\n    description: \"Show token usage and session info\",\n    execute: () => {\n      if (context.showStatus) {\n        context.showStatus();\n      }\n    },\n  },\n  {\n    name: \"exit\",\n    description: \"Exit the CLI\",\n    execute: () => {\n      process.exit(0);\n    },\n  },\n];\n","import type { LightWorkspaceType } from \"@dust-tt/client\";\nimport { Box, Text, useInput } from \"ink\";\nimport Spinner from \"ink-spinner\";\nimport React, { useCallback, useEffect, useState } from \"react\";\n\nimport { getDustClient, resetDustClient } from \"../utils/dustClient.js\";\nimport TokenStorage from \"../utils/tokenStorage.js\";\n\ninterface WorkspaceSelectorProps {\n  onComplete: () => void;\n}\n\nexport function WorkspaceSelector({ onComplete }: WorkspaceSelectorProps) {\n  const [isLoading, setIsLoading] = useState(true);\n  const [workspaces, setWorkspaces] = useState<LightWorkspaceType[]>([]);\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        setIsLoading(true);\n\n        const clientRes = await getDustClient();\n        if (clientRes.isErr()) {\n          setError(clientRes.error.message);\n          return;\n        }\n\n        const client = clientRes.value;\n        if (!client) {\n          setError(\"Failed to initialize API client. Please authenticate first.\");\n          setIsLoading(false);\n          return;\n        }\n\n        const meResponse = await client.me();\n        if (meResponse.isErr()) {\n          setError(`Error fetching workspaces: ${meResponse.error.message}`);\n          setIsLoading(false);\n          return;\n        }\n\n        const userWorkspaces = meResponse.value.workspaces || [];\n\n        if (userWorkspaces.length === 0) {\n          setError(\"You don't have any workspaces. Visit https://dust.tt to create one.\");\n          setIsLoading(false);\n          return;\n        }\n\n        if (userWorkspaces.length === 1) {\n          await TokenStorage.saveWorkspaceId(userWorkspaces[0].sId);\n          resetDustClient();\n          setIsLoading(false);\n          onComplete();\n          return;\n        }\n\n        setWorkspaces(userWorkspaces);\n        setIsLoading(false);\n      } catch (err) {\n        setError(`Failed to fetch workspaces: ${err instanceof Error ? err.message : String(err)}`);\n        setIsLoading(false);\n      }\n    })();\n  }, [onComplete]);\n\n  useInput(\n    (input, key) => {\n      if (workspaces.length === 0) {\n        return;\n      }\n\n      if (key.upArrow) {\n        setSelectedIndex((prev) => Math.max(0, prev - 1));\n      } else if (key.downArrow) {\n        setSelectedIndex((prev) => Math.min(workspaces.length - 1, prev + 1));\n      } else if (key.return) {\n        const selected = workspaces[selectedIndex];\n        (async () => {\n          await TokenStorage.saveWorkspaceId(selected.sId);\n          resetDustClient();\n          onComplete();\n        })();\n      }\n    },\n    { isActive: workspaces.length > 0 }\n  );\n\n  if (isLoading) {\n    return (\n      <Box>\n        <Text color=\"green\"><Spinner type=\"dots\" /></Text>\n        <Text> Loading your workspaces...</Text>\n      </Box>\n    );\n  }\n\n  if (error) {\n    return (\n      <Box flexDirection=\"column\">\n        <Text color=\"red\">Error: {error}</Text>\n      </Box>\n    );\n  }\n\n  return (\n    <Box flexDirection=\"column\">\n      <Box marginBottom={1}>\n        <Text bold>Select a workspace:</Text>\n      </Box>\n      {workspaces.map((ws, i) => (\n        <Box key={ws.sId}>\n          <Text color={i === selectedIndex ? \"blue\" : undefined}>\n            {i === selectedIndex ? \"> \" : \"  \"}\n            {ws.name} ({ws.role})\n          </Text>\n        </Box>\n      ))}\n    </Box>\n  );\n}\n"],"mappings":";;;;;;AAEA,OAAOA,aAAW;AAClB,SAAS,cAAc;AACvB,OAAO,UAAU;;;ACHjB,SAAS,OAAAC,MAAK,QAAAC,aAAY;AAC1B,OAAOC,cAAa;AACpB,OAAOC,UAAS,YAAAC,WAAU,eAAAC,cAAa,aAAAC,kBAAiB;;;ACFxD,SAAS,SAAS,OAAAC,MAAK,MAAAC,WAAU;;;ACAjC,SAAS,OAAAC,MAAK,MAAAC,WAAU;AAExB,SAAS,aAAAC,kBAAiB;AAC1B,OAAO,WAAW;;;ACMX,SAAS,cAAc,OAAwB;AACpD,MAAI,iBAAiB,OAAO;AAC1B,WAAO,MAAM;AAAA,EACf,WAAW,OAAO,UAAU,UAAU;AACpC,WAAO;AAAA,EACT;AAEA,SAAO,KAAK,UAAU,KAAK;AAC7B;AAEO,SAAS,eAAe,OAAuB;AACpD,MAAI,iBAAiB,OAAO;AAC1B,WAAO;AAAA,EACT;AAEA,SAAO,IAAI,MAAM,cAAc,KAAK,CAAC;AACvC;;;ACzBA,SAAS,KAAK,UAAU;AACxB,SAAS,iBAAiB;AAE1B,OAAO,YAAY;AAInB,IAAM,eAAe;AACrB,IAAM,mBAAmB;AACzB,IAAM,oBAAoB;AAC1B,IAAM,gBAAgB;AACtB,IAAM,aAAa;AAOZ,IAAM,eAAe;AAAA,EAC1B,MAAM,WAAW,aAAqB,cAAqC;AACzE,UAAM,OAAO,YAAY,cAAc,kBAAkB,WAAW;AACpE,UAAM,OAAO,YAAY,cAAc,mBAAmB,YAAY;AAAA,EACxE;AAAA,EAEA,MAAM,iBAAyC;AAC7C,WAAO,OAAO,YAAY,cAAc,gBAAgB;AAAA,EAC1D;AAAA,EAEA,MAAM,kBAA0C;AAC9C,WAAO,OAAO,YAAY,cAAc,iBAAiB;AAAA,EAC3D;AAAA,EAEA,MAAM,sBAAuD;AAC3D,UAAM,cAAc,MAAM,KAAK,eAAe;AAC9C,QAAI,CAAC,aAAa;AAChB,aAAO,IAAI,IAAI,IAAI,MAAM,uBAAuB,CAAC;AAAA,IACnD;AAEA,QAAI,YAAY,WAAW,KAAK,GAAG;AACjC,aAAO,IAAI,GAAG,IAAI;AAAA,IACpB;AAEA,QAAI;AACJ,QAAI;AACF,gBAAU,UAAsB,WAAW;AAAA,IAC7C,SAAS,OAAO;AACd,aAAO,IAAI,IAAI,eAAe,KAAK,CAAC;AAAA,IACtC;AAEA,UAAM,qBAAqB,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AACvD,WAAO,IAAI,GAAG,QAAQ,MAAM,kBAAkB;AAAA,EAChD;AAAA,EAEA,MAAM,gBAAgB,cAAqC;AACzD,UAAM,OAAO,YAAY,cAAc,eAAe,YAAY;AAAA,EACpE;AAAA,EAEA,MAAM,iBAAyC;AAC7C,WAAO,OAAO,YAAY,cAAc,aAAa;AAAA,EACvD;AAAA,EAEA,MAAM,WAAW,QAA+B;AAC9C,UAAM,OAAO,YAAY,cAAc,YAAY,MAAM;AAAA,EAC3D;AAAA,EAEA,MAAM,YAAoC;AACxC,WAAO,OAAO,YAAY,cAAc,UAAU;AAAA,EACpD;AAAA,EAEA,MAAM,cAA6B;AACjC,UAAM,OAAO,eAAe,cAAc,gBAAgB;AAC1D,UAAM,OAAO,eAAe,cAAc,iBAAiB;AAC3D,UAAM,OAAO,eAAe,cAAc,aAAa;AACvD,UAAM,OAAO,eAAe,cAAc,UAAU;AAAA,EACtD;AACF;AAEA,IAAO,uBAAQ;;;AF5DR,IAAM,cAAc;AAAA,EACzB,MAAM,gBAAiD;AACrD,UAAM,eAAe,MAAM,qBAAa,gBAAgB;AACxD,QAAI,CAAC,cAAc;AACjB,aAAO,IAAIC,KAAI,IAAI,MAAM,wBAAwB,CAAC;AAAA,IACpD;AAEA,UAAM,eAAe;AACrB,UAAM,WAAW;AAEjB,UAAM,WAAW,MAAM;AAAA,MACrB,WAAW,YAAY;AAAA,MACvB;AAAA,QACE,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,QAClB;AAAA,QACA,MAAM,IAAI,gBAAgB;AAAA,UACxB,YAAY;AAAA,UACZ,WAAW;AAAA,UACX,eAAe;AAAA,QACjB,CAAC;AAAA,MACH;AAAA,IACF;AAEA,QAAI,CAAC,SAAS,IAAI;AAChB,UAAI,SAAS,WAAW,OAAO,SAAS,WAAW,KAAK;AACtD,cAAM,qBAAa,YAAY;AAC/B,wBAAgB;AAAA,MAClB;AACA,aAAO,IAAIA,KAAI,IAAI,MAAM,0BAA0B,CAAC;AAAA,IACtD;AAEA,UAAM,OAAQ,MAAM,SAAS,KAAK;AAClC,UAAM,qBAAa,WAAW,KAAK,cAAc,KAAK,aAAa;AAEnE,oBAAgB;AAEhB,WAAO,IAAIC,IAAG,IAAI;AAAA,EACpB;AAAA,EAEA,MAAM,sBAA6D;AACjE,UAAM,cAAc,MAAM,qBAAa,eAAe;AAEtD,QAAI,2CAAa,WAAW,QAAQ;AAClC,aAAO,IAAIA,IAAG,WAAW;AAAA,IAC3B;AAEA,UAAM,UAAU,MAAM,qBAAa,oBAAoB;AAEvD,QAAI,QAAQ,MAAM,GAAG;AACnB,aAAO;AAAA,IACT;AAEA,QAAI,CAAC,QAAQ,SAAS,CAAC,aAAa;AAClC,YAAM,YAAY,MAAM,KAAK,cAAc;AAC3C,UAAI,UAAU,MAAM,GAAG;AACrB,eAAO,IAAID,KAAI,IAAI,MAAM,0BAA0B,CAAC;AAAA,MACtD;AAEA,aAAO,IAAIC,IAAG,MAAM,qBAAa,eAAe,CAAC;AAAA,IACnD;AAEA,QAAI;AACJ,QAAI;AACF,gBAAUC,WAAU,WAAW;AAAA,IACjC,SAAS,OAAO;AACd,YAAM,YAAY,MAAM,KAAK,cAAc;AAC3C,UAAI,UAAU,KAAK,GAAG;AACpB,eAAO,IAAID,IAAG,MAAM,qBAAa,eAAe,CAAC;AAAA,MACnD;AACA,aAAO,IAAID,KAAI,eAAe,KAAK,CAAC;AAAA,IACtC;AAEA,UAAM,qBAAqB,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AACvD,UAAM,0BAA0B,QAAQ,OAAO,KAAK;AAEpD,QAAI,yBAAyB,IAAI;AAC/B,YAAM,YAAY,MAAM,KAAK,cAAc;AAC3C,UAAI,UAAU,KAAK,GAAG;AACpB,eAAO,IAAIC,IAAG,MAAM,qBAAa,eAAe,CAAC;AAAA,MACnD;AACA,aAAO;AAAA,IACT;AAEA,WAAO,IAAIA,IAAG,WAAW;AAAA,EAC3B;AAAA,EAEA,MAAM,kBAAoC;AACxC,UAAM,sBAAsB,MAAM,qBAAa,oBAAoB;AACnE,QAAI,oBAAoB,MAAM,GAAG;AAC/B,aAAO;AAAA,IACT;AAEA,QAAI,oBAAoB,OAAO;AAC7B,aAAO;AAAA,IACT;AAEA,UAAM,YAAY,MAAM,KAAK,cAAc;AAC3C,QAAI,UAAU,KAAK,GAAG;AACpB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA,EAEA,MAAM,SAAwB;AAC5B,UAAM,qBAAa,YAAY;AAC/B,oBAAgB;AAAA,EAClB;AAAA,EAEA,MAAM,yBAAiD;AACrD,WAAO,qBAAa,eAAe;AAAA,EACrC;AAAA,EAEA,MAAM,sBAA8C;AAClD,UAAM,cAAc,MAAM,qBAAa,eAAe;AAEtD,QAAI,2CAAa,WAAW,QAAQ;AAClC,aAAO;AAAA,IACT;AAEA,UAAM,YAAY,MAAM,KAAK,cAAc;AAC3C,QAAI,CAAC,WAAW;AACd,aAAO;AAAA,IACT;AAEA,WAAO,qBAAa,eAAe;AAAA,EACrC;AACF;AAEA,IAAO,sBAAQ;;;AD9If,IAAI,kBAAkC;AAE/B,IAAM,eAAe,CAAC,WAAiD;AAC5E,QAAM,OAAO,MAAM;AACjB,YAAQ,QAAQ;AAAA,MACd,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IACX;AAAA,EACF,GAAG;AAEH,MAAI,CAAC,KAAK;AACR,WAAO,IAAIE,KAAI,IAAI,MAAM,iCAAiC,CAAC;AAAA,EAC7D;AAEA,SAAO,IAAIC,IAAG,GAAG;AACnB;AAEO,IAAM,gBAAgB,YAExB;AACH,MAAI,iBAAiB;AACnB,WAAO,IAAIA,IAAG,eAAe;AAAA,EAC/B;AAEA,QAAM,cAAc,MAAM,oBAAY,oBAAoB;AAE1D,MAAI,CAAC,aAAa;AAChB,WAAO,IAAIA,IAAG,IAAI;AAAA,EACpB;AAEA,QAAM,SAAS,MAAM,qBAAa,UAAU;AAC5C,QAAM,eAAe,aAAa,MAAM;AAExC,MAAI,aAAa,MAAM,GAAG;AACxB,WAAO,IAAID,KAAI,aAAa,KAAK;AAAA,EACnC;AAEA,oBAAkB,IAAI;AAAA,IACpB;AAAA,MACE,KAAK,aAAa;AAAA,IACpB;AAAA,IACA;AAAA,MACE,QAAQ,YAAY;AAClB,cAAM,QAAQ,MAAM,oBAAY,oBAAoB;AACpD,YAAI,MAAM,MAAM,GAAG;AACjB,iBAAO;AAAA,QACT;AACA,eAAO,MAAM,SAAS;AAAA,MACxB;AAAA,MACA,aAAc,MAAM,qBAAa,eAAe,KAAM;AAAA,MACtD,cAAc;AAAA,QACZ,sBAAsB,QAAQ,IAAI,uBAAuB;AAAA,QACzD,cAAc;AAAA,MAChB;AAAA,IACF;AAAA,IACA;AAAA,EACF;AAEA,SAAO,IAAIC,IAAG,eAAe;AAC/B;AAEO,IAAM,kBAAkB,MAAY;AACzC,oBAAkB;AACpB;;;AIzEA,SAAS,KAAK,YAAY;AAC1B,OAAO,aAAa;AACpB,SAAS,aAAAC,kBAAiB;AAC1B,OAAOC,YAAW;AAClB,OAAO,UAAU;AACjB,OAAO,SAAS,aAAa,WAAW,gBAAgB;AAqCjD,SAAS,KAAK,EAAE,YAAY,QAAQ,IAAI,GAAc;AAC3D,QAAM,CAAC,WAAW,YAAY,IAAI,SAAS,IAAI;AAC/C,QAAM,CAAC,OAAO,QAAQ,IAAI,SAAwB,IAAI;AACtD,QAAM,CAAC,YAAY,aAAa,IAAI,SAAoC,IAAI;AAC5E,QAAM,CAAC,WAAW,YAAY,IAAI,SAAS,KAAK;AAEhD,QAAM,kBAAkB,UAAU,QAAQ,IAAI;AAC9C,QAAM,eAAe,OAAO,QAAQ,IAAI;AAExC,QAAM,eAAe;AACrB,QAAM,WAAW;AAEjB,QAAM,eAAe;AAAA,IACnB,CAAC,mBAAuC;AACtC,mBAAa,IAAI;AAEjB,YAAM,sBAAsB,eAAe;AAC3C,YAAM,mBAAmB,eAAe;AACxC,YAAM,cAAc,KAAK,MAAM,mBAAmB,mBAAmB;AAErE,UAAI,WAAW;AAEf,YAAM,eAAe,YAAY;AAC/B,YAAI,YAAY,aAAa;AAC3B,uBAAa,KAAK;AAClB,mBAAS,6CAA6C;AACtD;AAAA,QACF;AAEA,YAAI;AACF,gBAAM,WAAW,MAAMC;AAAA,YACrB,WAAW,YAAY;AAAA,YACvB;AAAA,cACE,QAAQ;AAAA,cACR,SAAS,EAAE,gBAAgB,oCAAoC;AAAA,cAC/D,MAAM,IAAI,gBAAgB;AAAA,gBACxB,YAAY;AAAA,gBACZ,aAAa,eAAe;AAAA,gBAC5B,WAAW;AAAA,cACb,CAAC;AAAA,YACH;AAAA,UACF;AAEA,gBAAM,OAAQ,MAAM,SAAS,KAAK;AAElC,cAAI,WAAW,MAAM;AACnB,gBAAI,KAAK,UAAU,yBAAyB;AAC1C;AACA,yBAAW,cAAc,sBAAsB,GAAI;AAAA,YACrD,WAAW,KAAK,UAAU,aAAa;AACrC;AACA,yBAAW,eAAe,sBAAsB,KAAK,GAAI;AAAA,YAC3D,OAAO;AACL,2BAAa,KAAK;AAClB,uBAAS,yBAAyB,KAAK,qBAAqB,KAAK,KAAK,EAAE;AAAA,YAC1E;AAAA,UACF,OAAO;AACL,kBAAM,qBAAa,WAAW,KAAK,cAAc,KAAK,aAAa;AAEnE,gBAAI;AACF,oBAAM,eAAeC,WAA8B,KAAK,YAAY;AACpE,oBAAM,iBAAiB;AACvB,oBAAM,kBAAkB,GAAG,cAAc;AACzC,oBAAM,SAAS,aAAa,eAAe;AAC3C,oBAAM,qBAAa,WAAW,UAAU,aAAa;AAAA,YACvD,QAAQ;AACN,oBAAM,qBAAa,WAAW,aAAa;AAAA,YAC7C;AAEA,4BAAgB;AAChB,yBAAa,KAAK;AAClB,uBAAW;AAAA,UACb;AAAA,QACF,SAAS,KAAK;AACZ,uBAAa,KAAK;AAClB,mBAAS,eAAe,GAAG,EAAE,OAAO;AAAA,QACtC;AAAA,MACF;AAEA,iBAAW,cAAc,sBAAsB,GAAI;AAAA,IACrD;AAAA,IACA,CAAC,UAAU,cAAc,UAAU;AAAA,EACrC;AAEA,QAAM,kBAAkB,YAAY,YAAY;AAC9C,UAAM,gBAAgB,MAAM,qBAAa,oBAAoB;AAC7D,QAAI,cAAc,KAAK,KAAK,cAAc,OAAO;AAC/C,mBAAa,KAAK;AAClB,iBAAW;AACX;AAAA,IACF;AAEA,iBAAa,IAAI;AAEjB,QAAI;AACF,YAAM,WAAW,MAAMD;AAAA,QACrB,WAAW,YAAY;AAAA,QACvB;AAAA,UACE,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,oCAAoC;AAAA,UAC/D,MAAM,IAAI,gBAAgB,EAAE,WAAW,UAAU,OAAO,uBAAuB,CAAC;AAAA,QAClF;AAAA,MACF;AAEA,UAAI,CAAC,SAAS,IAAI;AAChB,iBAAS,4CAA4C;AACrD;AAAA,MACF;AAEA,YAAM,OAAQ,MAAM,SAAS,KAAK;AAClC,oBAAc,IAAI;AAClB,mBAAa,KAAK;AAElB,YAAM,KAAK,KAAK,yBAAyB;AACzC,mBAAa,IAAI;AAAA,IACnB,SAAS,KAAK;AACZ,eAAS,eAAe,GAAG,EAAE,OAAO;AAAA,IACtC;AAAA,EACF,GAAG,CAAC,UAAU,cAAc,cAAc,UAAU,CAAC;AAErD,QAAM,qBAAqB,YAAY,YAAY;AACjD,QAAI,CAAC,mBAAmB,CAAC,cAAc;AACrC;AAAA,IACF;AAEA,iBAAa,IAAI;AACjB,QAAI;AACF,YAAM,qBAAa,WAAW,iBAAiB,eAAe;AAC9D,YAAM,qBAAa,gBAAgB,YAAY;AAC/C,YAAM,qBAAa,WAAW,aAAa;AAC3C,sBAAgB;AAChB,mBAAa,KAAK;AAClB,iBAAW;AAAA,IACb,SAAS,KAAK;AACZ,eAAS,eAAe,GAAG,EAAE,OAAO;AACpC,mBAAa,KAAK;AAAA,IACpB;AAAA,EACF,GAAG,CAAC,iBAAiB,cAAc,UAAU,CAAC;AAE9C,YAAU,MAAM;AACd,QAAI,mBAAmB,cAAc;AACnC,WAAK,mBAAmB;AAAA,IAC1B,OAAO;AACL,WAAK,gBAAgB;AAAA,IACvB;AAAA,EACF,GAAG,CAAC,iBAAiB,cAAc,oBAAoB,eAAe,CAAC;AAEvE,MAAI,OAAO;AACT,WACE,oCAAC,OAAI,eAAc,YACjB,oCAAC,QAAK,OAAM,SAAM,WAAQ,KAAM,CAClC;AAAA,EAEJ;AAEA,MAAI,WAAW;AACb,WACE,oCAAC,WACC,oCAAC,QAAK,OAAM,WAAQ,oCAAC,WAAQ,MAAK,QAAO,CAAE,GAC3C,oCAAC,YAAK,iCAA+B,CACvC;AAAA,EAEJ;AAEA,MAAI,aAAa,YAAY;AAC3B,WACE,oCAAC,OAAI,eAAc,YACjB,oCAAC,WACC,oCAAC,QAAK,OAAM,WAAQ,oCAAC,WAAQ,MAAK,QAAO,CAAE,GAC3C,oCAAC,YAAK,kCAAgC,CACxC,GACA,oCAAC,OAAI,WAAW,KACd,oCAAC,YAAK,qBAAmB,GACzB,oCAAC,QAAK,OAAM,UAAS,MAAI,QAAE,WAAW,SAAU,CAClD,GACA,oCAAC,WACC,oCAAC,YAAK,KAAG,GACT,oCAAC,QAAK,OAAM,QAAO,WAAS,QAAE,WAAW,gBAAiB,CAC5D,GACA,oCAAC,YAAK,4DAA0D,CAClE;AAAA,EAEJ;AAEA,SACE,oCAAC,WACC,oCAAC,YAAK,iBAAe,CACvB;AAEJ;;;ACvOA,OAAOE,UAAS,YAAAC,WAAU,eAAAC,cAAa,aAAAC,YAAW,QAAQ,eAAe;AACzE,SAAS,OAAAC,MAAK,QAAAC,OAAM,cAAc;AAClC,OAAOC,cAAa;;;AC8DpB,eAAsB,oBACpB,YACA,QAC4D;AAE5D,QAAM,MAAM,MAAO,WAAmB,QAAQ;AAAA,IAC5C,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,MAAM;AAAA,MACJ,cAAc,EAAE,UAAU,OAAO,SAAS;AAAA,MAC1C,OAAO,OAAO;AAAA,MACd,QAAQ,OAAO;AAAA,MACf,YAAY,OAAO;AAAA,MACnB,aAAa,OAAO;AAAA,IACtB;AAAA,IACA,QAAQ;AAAA,EACV,CAAC;AAED,MAAI,IAAI,MAAM,GAAG;AACf,YAAQ,mBAAmB;AACzB,YAAM;AAAA,QACJ,MAAM;AAAA,QACN,SAAS,IAAI,MAAM;AAAA,MACrB;AAAA,IACF,GAAG;AAAA,EACL;AAEA,QAAM,EAAE,SAAS,IAAI,IAAI;AAEzB,MAAI,CAAC,SAAS,MAAM,CAAC,SAAS,MAAM;AAClC,UAAM,OACJ,OAAO,SAAS,SAAS,WAAW,SAAS,OAAO;AACtD,YAAQ,mBAAmB;AACzB,YAAM;AAAA,QACJ,MAAM;AAAA,QACN,SAAS,sCAAsC,SAAS,MAAM,IAAI,IAAI;AAAA,MACxE;AAAA,IACF,GAAG;AAAA,EACL;AAEA,SAAO,eAAe,SAAS,IAAkC;AACnE;AAEA,gBAAgB,eACd,MACmD;AACnD,QAAM,SAAS,KAAK,UAAU;AAC9B,QAAM,UAAU,IAAI,YAAY;AAChC,MAAI,SAAS;AAEb,MAAI;AACF,eAAS;AACP,YAAM,EAAE,OAAO,KAAK,IAAI,MAAM,OAAO,KAAK;AAE1C,UAAI,OAAO;AACT,kBAAU,QAAQ,OAAO,OAAO,EAAE,QAAQ,KAAK,CAAC;AAGhD,cAAM,QAAQ,OAAO,MAAM,IAAI;AAC/B,iBAAS,MAAM,IAAI,KAAK;AAExB,mBAAW,QAAQ,OAAO;AACxB,cAAI,KAAK,WAAW,QAAQ,GAAG;AAC7B,kBAAM,OAAO,KAAK,MAAM,CAAC,EAAE,KAAK;AAChC,gBAAI,SAAS,QAAQ;AACnB;AAAA,YACF;AACA,gBAAI;AACF,oBAAM,QAAQ,KAAK,MAAM,IAAI;AAC7B,oBAAM;AAAA,YACR,QAAQ;AAAA,YAER;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAEA,UAAI,MAAM;AACR;AAAA,MACF;AAAA,IACF;AAGA,QAAI,OAAO,WAAW,QAAQ,GAAG;AAC/B,YAAM,OAAO,OAAO,MAAM,CAAC,EAAE,KAAK;AAClC,UAAI,QAAQ,SAAS,QAAQ;AAC3B,YAAI;AACF,gBAAM,QAAQ,KAAK,MAAM,IAAI;AAC7B,gBAAM;AAAA,QACR,QAAQ;AAAA,QAER;AAAA,MACF;AAAA,IACF;AAAA,EACF,UAAE;AACA,WAAO,YAAY;AAAA,EACrB;AACF;;;ACpIO,SAAS,gBAAgB,QAAyB;AACvD,QAAM,EAAE,YAAY,cAAc,OAAO,aAAAC,cAAa,YAAY,MAAM,IAAI;AAC5E,QAAM,WAA0B,CAAC;AAGjC,MAAI,eAAqD;AACzD,QAAM,aAA2B,CAAC;AAClC,MAAI,OAAO;AAEX,WAAS,KAAK,OAAmB;AAC/B,QAAI,cAAc;AAChB,YAAM,UAAU;AAChB,qBAAe;AACf,cAAQ,KAAK;AAAA,IACf,OAAO;AACL,iBAAW,KAAK,KAAK;AAAA,IACvB;AAAA,EACF;AAEA,kBAAgB,SAAqC;AACnD,WAAO,CAAC,MAAM;AACZ,UAAI,WAAW,SAAS,GAAG;AACzB,cAAM,WAAW,MAAM;AAAA,MACzB,OAAO;AACL,cAAM,MAAM,IAAI,QAAoB,CAAC,YAAY;AAC/C,yBAAe;AAAA,QACjB,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO,WAAW,SAAS,GAAG;AAC5B,YAAM,WAAW,MAAM;AAAA,IACzB;AAAA,EACF;AAEA,iBAAe,oBAAoB;AAEjC,WAAO,MAAM;AACX,UAAI;AAEJ,UAAI;AACF,sBAAc,MAAM,oBAAoB,YAAY;AAAA,UAClD;AAAA,UACA;AAAA,UACA,QAAQ;AAAA,UACR;AAAA,QACF,CAAC;AAAA,MACH,SAAS,KAAK;AACZ,cAAM,UAAU,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG;AAC/D,aAAK,EAAE,MAAM,SAAS,QAAQ,CAAC;AAC/B;AAAA,MACF;AAGA,YAAM,YAAwB,CAAC;AAC/B,UAAI,cAAc;AAClB,UAAI,aAAa;AAEjB,uBAAiB,SAAS,aAAa;AACrC,gBAAQ,MAAM,MAAM;AAAA,UAClB,KAAK;AACH,2BAAe,MAAM;AACrB,iBAAK,EAAE,MAAM,cAAc,MAAM,MAAM,KAAK,CAAC;AAC7C;AAAA,UAEF,KAAK;AACH,iBAAK,EAAE,MAAM,kBAAkB,MAAM,MAAM,KAAK,CAAC;AACjD;AAAA,UAEF,KAAK,YAAY;AACf,kBAAM,YAAY;AAClB,sBAAU,KAAK;AAAA,cACb,IAAI,UAAU;AAAA,cACd,MAAM,UAAU;AAAA,cAChB,OAAO,UAAU;AAAA,YACnB,CAAC;AACD,iBAAK;AAAA,cACH,MAAM;AAAA,cACN,IAAI,UAAU;AAAA,cACd,MAAM,UAAU;AAAA,cAChB,OAAO,UAAU;AAAA,YACnB,CAAC;AACD;AAAA,UACF;AAAA,UAEA,KAAK;AACH,iBAAK;AAAA,cACH,MAAM;AAAA,cACN,aAAa,MAAM;AAAA,cACnB,cAAc,MAAM;AAAA,YACtB,CAAC;AACD;AAAA,UAEF,KAAK;AACH,yBAAa,MAAM;AACnB;AAAA,UAEF,KAAK;AACH,iBAAK;AAAA,cACH,MAAM;AAAA,cACN,SAAS,MAAM;AAAA,cACf,WAAW,MAAM;AAAA,YACnB,CAAC;AACD;AAAA,QACJ;AAAA,MACF;AAGA,UAAI,UAAU,SAAS,GAAG;AACxB,cAAM,gBAAgB,UAAU,IAAI,CAAC,QAAQ;AAAA,UAC3C,IAAI,GAAG;AAAA,UACP,MAAM,GAAG;AAAA,UACT,WAAW,KAAK,UAAU,GAAG,KAAK;AAAA,QACpC,EAAE;AACF,cAAM,WAA+B,CAAC;AACtC,YAAI,aAAa;AACf,mBAAS,KAAK,EAAE,MAAM,gBAAgB,OAAO,YAAY,CAAC;AAAA,QAC5D;AACA,mBAAW,MAAM,eAAe;AAC9B,mBAAS,KAAK,EAAE,MAAM,iBAAiB,OAAO,GAAG,CAAC;AAAA,QACpD;AACA,iBAAS,KAAK,EAAE,MAAM,aAAa,gBAAgB,eAAe,SAAS,CAAC;AAAA,MAC9E,WAAW,aAAa;AACtB,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,UAAU,CAAC,EAAE,MAAM,gBAAgB,OAAO,YAAY,CAAC;AAAA,QACzD,CAAC;AAAA,MACH;AAGA,UAAI,UAAU,WAAW,GAAG;AAC1B,aAAK,EAAE,MAAM,QAAQ,WAAW,CAAC;AACjC;AAAA,MACF;AAGA,iBAAW,YAAY,WAAW;AAChC,aAAK;AAAA,UACH,MAAM;AAAA,UACN,IAAI,SAAS;AAAA,UACb,MAAM,SAAS;AAAA,UACf,OAAO,SAAS;AAAA,QAClB,CAAC;AAED,cAAM,SAAS,MAAMA,aAAY,QAAQ;AAEzC,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,MAAM,SAAS;AAAA,UACf,kBAAkB,SAAS;AAAA,UAC3B,SAAS;AAAA,QACX,CAAC;AAED,aAAK;AAAA,UACH,MAAM;AAAA,UACN,IAAI,SAAS;AAAA,UACb,MAAM,SAAS;AAAA,UACf;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IAGF;AAAA,EACF;AAEA,SAAO;AAAA,IACL;AAAA,IAEA,YAAY,SAAiB;AAC3B,eAAS,KAAK,EAAE,MAAM,QAAQ,MAAM,QAAQ,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,QAAQ,CAAC,EAAE,CAAC;AACxF,wBAAkB;AAAA,IACpB;AAAA,IAEA,OAAO;AACL,aAAO;AACP,WAAK,EAAE,MAAM,QAAQ,YAAY,UAAU,CAAC;AAAA,IAC9C;AAAA,IAEA,cAAc;AACZ,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;ACpNA,SAAS,gBAAgB;AACzB,OAAO,QAAQ;AACf,OAAO,UAAU;AACjB,OAAO,QAAQ;AAKf,SAAS,gBAAgB,UAAiC;AACxD,MAAI,MAAM;AACV,SAAO,QAAQ,KAAK,QAAQ,GAAG,GAAG;AAChC,QAAI,GAAG,WAAW,KAAK,KAAK,KAAK,MAAM,CAAC,GAAG;AACzC,aAAO;AAAA,IACT;AACA,UAAM,KAAK,QAAQ,GAAG;AAAA,EACxB;AACA,SAAO;AACT;AAKA,SAAS,WAAW,aAA2C;AAC7D,MAAI,CAAC,aAAa;AAChB,WAAO;AAAA,EACT;AACA,QAAM,aAAa,KAAK,KAAK,aAAa,SAAS;AACnD,MAAI,GAAG,WAAW,UAAU,GAAG;AAC7B,WAAO,GAAG,aAAa,YAAY,OAAO;AAAA,EAC5C;AACA,SAAO;AACT;AAKA,SAAS,aAAaC,MAAqB;AACzC,MAAI;AACF,UAAM,SAAS,SAAS,sBAAsB,EAAE,KAAAA,MAAK,UAAU,QAAQ,CAAC;AACxE,WAAO,OAAO,KAAK,KAAK;AAAA,EAC1B,QAAQ;AACN,WAAO;AAAA,EACT;AACF;AAKA,SAAS,aAAaA,MAAqB;AACzC,MAAI;AACF,WAAO,SAAS,6BAA6B,EAAE,KAAAA,MAAK,UAAU,QAAQ,CAAC,EAAE,KAAK;AAAA,EAChF,QAAQ;AACN,WAAO;AAAA,EACT;AACF;AAKO,SAAS,kBAAkBA,MAAqB;AACrD,QAAM,cAAc,gBAAgBA,IAAG;AACvC,QAAM,SAAS,WAAW,WAAW;AACrC,QAAM,YAAY,aAAaA,IAAG;AAClC,QAAM,YAAY,aAAaA,IAAG;AAClC,QAAM,QAAO,oBAAI,KAAK,GAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAClD,QAAM,WAAW,GAAG,SAAS;AAE7B,MAAI,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA,uBAKQA,IAAG;AAAA,kBACR,eAAeA,IAAG;AAAA,cACtB,QAAQ;AAAA,UACZ,IAAI;AAAA,gBACE,SAAS;AAAA,gBACT,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAsBvB,MAAI,QAAQ;AACV,cAAU;AAAA;AAAA;AAAA,EAGZ,MAAM;AAAA,EACN;AAEA,SAAO;AACT;;;AC3GA,OAAOC,WAAU;;;ACAjB,OAAOC,SAAQ;AACf,SAAS,YAAY;AACrB,OAAOC,WAAU;AAEV,IAAM,sBAAsB;AAC5B,IAAM,4BAA4B;AAClC,IAAM,gBAAgB,KAAK,OAAO;AAElC,SAAS,eAAe,OAAuB;AACpD,MAAI,UAAU,GAAG;AACf,WAAO;AAAA,EACT;AAEA,QAAM,IAAI;AACV,QAAM,QAAQ,CAAC,SAAS,MAAM,MAAM,IAAI;AACxC,QAAM,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI,KAAK,IAAI,CAAC,CAAC;AAElD,SAAO,GAAG,YAAY,QAAQ,KAAK,IAAI,GAAG,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC;AACvE;AAEO,SAAS,eACd,UACqC;AACrC,QAAM,gBAAgBA,MAAK,QAAQ,QAAQ,EAAE,YAAY;AAEzD,MAAI,kBAAkB,SAAS,kBAAkB,QAAQ;AACvD,WAAO;AAAA,EACT;AAEA,QAAM,mBAAmB,oBAAI,IAAI;AAAA,IAC/B;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAO;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAO;AAAA,IAAU;AAAA,IAAQ;AAAA,IAChE;AAAA,IAAO;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAQ;AAAA,IAClE;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAM;AAAA,IAAM;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAQ;AAAA,EACvE,CAAC;AAED,MAAI,iBAAiB,IAAI,aAAa,GAAG;AACvC,WAAO;AAAA,EACT;AAEA,QAAM,kBAAkB,oBAAI,IAAI;AAAA,IAC9B;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAQ;AAAA,EACpD,CAAC;AAED,MAAI,gBAAgB,IAAI,aAAa,GAAG;AACtC,WAAO;AAAA,EACT;AAEA,MAAI,kBAAkB,QAAQ;AAC5B,WAAO;AAAA,EACT;AAEA,SAAO;AACT;AAEA,eAAsB,YACpB,UACA,SAAiB,GACjB,QAAgB,qBAC+B;AAC/C,MAAI,CAACD,IAAG,WAAW,QAAQ,GAAG;AAC5B,WAAO,EAAE,OAAO,WAAW,QAAQ,mBAAmB;AAAA,EACxD;AAEA,QAAM,QAAQ,MAAM,KAAK,QAAQ;AAEjC,MAAI,CAAC,MAAM,OAAO,GAAG;AACnB,WAAO,EAAE,OAAO,uBAAuB,QAAQ,GAAG;AAAA,EACpD;AAEA,MAAI,MAAM,OAAO,eAAe;AAC9B,WAAO,EAAE,OAAO,mBAAmB,eAAe,MAAM,IAAI,CAAC,UAAU,eAAe,aAAa,CAAC,GAAG;AAAA,EACzG;AAEA,QAAM,WAAW,eAAe,QAAQ;AAExC,UAAQ,UAAU;AAAA,IAChB,KAAK;AACH,aAAO,EAAE,OAAO,8BAA8B;AAAA,IAChD,KAAK;AAAA,IACL,KAAK,OAAO;AACV,YAAM,gBAAgB,MAAMA,IAAG,SAAS,SAAS,QAAQ;AACzD,YAAM,aAAa,cAAc,SAAS,QAAQ;AAClD,aAAO,EAAE,MAAM,WAAW;AAAA,IAC5B;AAAA,IACA,KAAK,QAAQ;AACX,YAAM,UAAU,MAAMA,IAAG,SAAS,SAAS,UAAU,OAAO;AAC5D,YAAM,QAAQ,QAAQ,MAAM,IAAI;AAChC,YAAM,eAAe,MAAM;AAE3B,YAAM,YAAY,KAAK,IAAI,QAAQ,YAAY;AAC/C,YAAM,UAAU,KAAK,IAAI,YAAY,OAAO,YAAY;AAExD,YAAM,gBAAgB,MAAM,MAAM,WAAW,OAAO;AAEpD,YAAM,WAAW,UAAU;AAC3B,UAAI,WAAW;AACf,YAAM,iBAAiB,cAAc,IAAI,CAAC,SAAS;AACjD,YAAI,KAAK,SAAS,2BAA2B;AAC3C,qBAAW;AACX,iBAAO,KAAK,UAAU,GAAG,yBAAyB,IAAI;AAAA,QACxD;AACA,eAAO;AAAA,MACT,CAAC;AAED,UAAI,aAAa;AACjB,UAAI,UAAU;AACZ,qBAAa,oCAAoC,YAAY,CAAC,IAAI,OAAO,OAAO,YAAY;AAAA;AAAA,MAC9F,WAAW,UAAU;AACnB,qBAAa,sEAAsE,yBAAyB;AAAA;AAAA,MAC9G;AAEA,YAAM,aAAa,aAAa,eAAe,KAAK,IAAI;AACxD,aAAO,EAAE,MAAM,WAAW;AAAA,IAC5B;AAAA,IACA;AACE,aAAO,EAAE,OAAO,yBAAyB;AAAA,EAC7C;AACF;;;ADhHO,SAAS,aAAa,SAA4B;AACvD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAEF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,WAAW;AAAA,UACT,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,QAAQ;AAAA,UACN,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,OAAO;AAAA,UACL,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,MACA,UAAU,CAAC,WAAW;AAAA,IACxB;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,WAAWE,MAAK;AAAA,QACpB,QAAQ;AAAA,QACR,MAAM;AAAA,MACR;AACA,YAAM,SAAU,MAAM,UAAqB;AAC3C,YAAM,QAAS,MAAM,SAAoB;AAEzC,YAAM,SAAS,MAAM,YAAY,UAAU,QAAQ,KAAK;AAExD,UAAI,WAAW,QAAQ;AACrB,eAAO,OAAO;AAAA,MAChB;AAEA,aAAO,OAAO;AAAA,IAChB;AAAA,EACF;AACF;;;AE9CA,OAAOC,SAAQ;AACf,OAAOC,WAAU;AAIV,SAAS,cAAc,SAA4B;AACxD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAEF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,WAAW;AAAA,UACT,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,SAAS;AAAA,UACP,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,MACA,UAAU,CAAC,aAAa,SAAS;AAAA,IACnC;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,WAAWA,MAAK;AAAA,QACpB,QAAQ;AAAA,QACR,MAAM;AAAA,MACR;AACA,YAAM,UAAU,MAAM;AAGtB,YAAM,MAAMA,MAAK,QAAQ,QAAQ;AACjC,YAAMD,IAAG,SAAS,MAAM,KAAK,EAAE,WAAW,KAAK,CAAC;AAEhD,YAAMA,IAAG,SAAS,UAAU,UAAU,SAAS,OAAO;AAEtD,aAAO,sBAAsB,QAAQ,MAAM,kBAAkB,QAAQ;AAAA,IACvE;AAAA,EACF;AACF;;;ACzCA,OAAOE,SAAQ;AACf,OAAOC,WAAU;AAIV,SAAS,aAAa,SAA4B;AACvD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAGF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,WAAW;AAAA,UACT,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,YAAY;AAAA,UACV,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,YAAY;AAAA,UACV,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,aAAa;AAAA,UACX,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,MACA,UAAU,CAAC,aAAa,cAAc,YAAY;AAAA,IACpD;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,WAAWA,MAAK;AAAA,QACpB,QAAQ;AAAA,QACR,MAAM;AAAA,MACR;AACA,YAAM,YAAY,MAAM;AACxB,YAAM,YAAY,MAAM;AACxB,YAAM,aAAc,MAAM,eAA2B;AAErD,UAAI,CAACD,IAAG,WAAW,QAAQ,GAAG;AAC5B,eAAO,+BAA+B,QAAQ;AAAA,MAChD;AAEA,YAAM,UAAU,MAAMA,IAAG,SAAS,SAAS,UAAU,OAAO;AAE5D,UAAI,CAAC,QAAQ,SAAS,SAAS,GAAG;AAChC,eAAO;AAAA,MACT;AAEA,UAAI,CAAC,YAAY;AAEf,cAAM,aAAa,QAAQ,QAAQ,SAAS;AAC5C,cAAM,cAAc,QAAQ,QAAQ,WAAW,aAAa,CAAC;AAC7D,YAAI,gBAAgB,IAAI;AACtB,iBAAO;AAAA,QACT;AAAA,MACF;AAEA,UAAI;AACJ,UAAI,YAAY;AACd,qBAAa,QAAQ,MAAM,SAAS,EAAE,KAAK,SAAS;AAAA,MACtD,OAAO;AACL,qBAAa,QAAQ,QAAQ,WAAW,SAAS;AAAA,MACnD;AAEA,YAAMA,IAAG,SAAS,UAAU,UAAU,YAAY,OAAO;AAEzD,YAAM,eAAe,UAAU,MAAM,IAAI,EAAE,SAAS,UAAU,MAAM,IAAI,EAAE;AAC1E,YAAM,aAAa,iBAAiB,IAChC,aACA,eAAe,IACb,SAAS,YAAY,WACrB,WAAW,KAAK,IAAI,YAAY,CAAC;AAEvC,aAAO,uBAAuB,QAAQ,KAAK,UAAU;AAAA,IACvD;AAAA,EACF;AACF;;;ACjFA,SAAS,aAAa;AAItB,IAAM,qBAAqB;AAC3B,IAAM,oBAAoB;AAEnB,SAAS,SAAS,SAA4B;AACnD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAGF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,SAAS;AAAA,UACP,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,YAAY;AAAA,UACV,MAAM;AAAA,UACN,aAAa,qCAAqC,kBAAkB;AAAA,QACtE;AAAA,QACA,KAAK;AAAA,UACH,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,MACA,UAAU,CAAC,SAAS;AAAA,IACtB;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,UAAU,MAAM;AACtB,YAAM,YAAa,MAAM,cAAyB;AAClD,YAAME,OAAO,MAAM,OAAkB,QAAQ;AAE7C,UAAI;AACF,cAAM,SAAS,MAAM,MAAM,QAAQ,CAAC,MAAM,OAAO,GAAG;AAAA,UAClD,KAAAA;AAAA,UACA,SAAS;AAAA,UACT,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,KAAK;AAAA,YACH,GAAG,QAAQ;AAAA,YACX,MAAM;AAAA,YACN,UAAU;AAAA,UACZ;AAAA,QACF,CAAC;AAED,YAAI,SAAS;AACb,YAAI,OAAO,QAAQ;AACjB,oBAAU,OAAO;AAAA,QACnB;AACA,YAAI,OAAO,QAAQ;AACjB,qBAAW,SAAS,kBAAkB,eAAe,OAAO;AAAA,QAC9D;AAEA,YAAI,OAAO,SAAS,mBAAmB;AACrC,mBAAS,OAAO,UAAU,GAAG,iBAAiB,IAAI;AAAA,QACpD;AAEA,YAAI,CAAC,QAAQ;AACX,mBAAS;AAAA,QACX;AAEA,eAAO,cAAc,OAAO,QAAQ;AAAA,EAAK,MAAM;AAAA,MACjD,SAAS,KAAc;AACrB,YACE,OACA,OAAO,QAAQ,YACf,YAAY,OACZ,YAAY,KACZ;AACA,gBAAM,UAAU;AAQhB,cAAI,QAAQ,UAAU;AACpB,mBAAO,kCAAkC,SAAS;AAAA,UACpD;AAEA,cAAI,SAAS;AACb,cAAI,QAAQ,QAAQ;AAClB,sBAAU,QAAQ;AAAA,UACpB;AACA,cAAI,QAAQ,QAAQ;AAClB,uBAAW,SAAS,kBAAkB,eAAe,QAAQ;AAAA,UAC/D;AAEA,cAAI,OAAO,SAAS,mBAAmB;AACrC,qBAAS,OAAO,UAAU,GAAG,iBAAiB,IAAI;AAAA,UACpD;AAEA,iBAAO,cAAc,QAAQ,YAAY,CAAC;AAAA,EAAK,UAAU,aAAa;AAAA,QACxE;AAEA,cAAM,UAAU,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG;AAC/D,eAAO,4BAA4B,OAAO;AAAA,MAC5C;AAAA,IACF;AAAA,EACF;AACF;;;AC1GA,SAAS,QAAQ,cAAc;AAC/B,OAAOC,WAAU;AACjB,SAAS,QAAAC,aAAY;AAIrB,IAAM,gBAAgB;AACtB,IAAM,mBAAmB;AAAA,EACvB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEO,SAAS,SAAS,SAA4B;AACnD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAEF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,SAAS;AAAA,UACP,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,WAAW;AAAA,UACT,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,OAAO;AAAA,UACL,MAAM;AAAA,UACN,aAAa,uCAAuC,aAAa;AAAA,QACnE;AAAA,MACF;AAAA,MACA,UAAU,CAAC,SAAS;AAAA,IACtB;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,UAAU,MAAM;AACtB,YAAM,YAAa,MAAM,YACrBD,MAAK,QAAQ,QAAQ,KAAK,MAAM,SAAmB,IACnD,QAAQ;AACZ,YAAM,QAAS,MAAM,SAAoB;AAEzC,YAAM,QAAQ,MAAM,OAAO,SAAS;AAAA,QAClC,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,UAAU;AAAA,MACZ,CAAC;AAED,UAAI,MAAM,WAAW,GAAG;AACtB,eAAO;AAAA,MACT;AAGA,YAAM,iBAAiB,MAAM,QAAQ;AAAA,QACnC,MAAM,MAAM,GAAG,QAAQ,CAAC,EAAE,IAAI,OAAO,MAAM;AACzC,gBAAM,WAAWA,MAAK,QAAQ,WAAW,CAAC;AAC1C,cAAI;AACF,kBAAM,IAAI,MAAMC,MAAK,QAAQ;AAC7B,mBAAO,EAAE,MAAM,GAAG,SAAS,EAAE,QAAQ;AAAA,UACvC,QAAQ;AACN,mBAAO,EAAE,MAAM,GAAG,SAAS,EAAE;AAAA,UAC/B;AAAA,QACF,CAAC;AAAA,MACH;AAEA,qBAAe,KAAK,CAAC,GAAG,MAAM,EAAE,UAAU,EAAE,OAAO;AACnD,YAAM,UAAU,eAAe,MAAM,GAAG,KAAK;AAE7C,UAAI,SAAS,QAAQ,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,IAAI;AAEjD,UAAI,MAAM,SAAS,OAAO;AACxB,kBAAU;AAAA;AAAA,GAAQ,MAAM,SAAS,KAAK;AAAA,MACxC;AAEA,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;ACnFA,OAAOC,WAAU;;;ACCjB,SAAS,OAAAC,MAAK,MAAAC,WAAU;AACxB,SAAS,aAAa;AACtB,SAAS,WAAW;AACpB,OAAOC,WAAU;AAUjB,eAAsB,YACpB,SACA,YACA,aACgC;AAChC,QAAM,WAAW,CAAC,MAAM,MAAM,MAAM,IAAI;AACxC,QAAM,iBAAiB,CAAC,QAAQ,gBAAgB,kBAAkB;AAClE,aAAW,OAAO,gBAAgB;AAChC,aAAS,KAAK,iBAAiB,GAAG,EAAE;AAAA,EACtC;AACA,MAAI,aAAa;AACf,aAAS,KAAK,aAAa,WAAW,EAAE;AAAA,EAC1C;AACA,WAAS,KAAK,OAAO;AACrB,WAAS,KAAK,GAAG;AAEjB,MAAI;AACF,UAAM,SAAS,MAAM,IAAI,QAAgB,CAAC,SAAS,WAAW;AAC5D,YAAM,QAAQ,MAAM,QAAQ,UAAU;AAAA,QACpC,KAAK;AAAA,QACL,aAAa;AAAA,MACf,CAAC;AACD,YAAM,eAAyB,CAAC;AAChC,YAAM,eAAyB,CAAC;AAEhC,YAAM,SAAS,CAAC,UAAkB,aAAa,KAAK,KAAK;AACzD,YAAM,WAAW,CAAC,UAAkB;AAClC,cAAM,YAAY,MAAM,SAAS;AACjC,YACE,CAAC,UAAU,SAAS,mBAAmB,KACvC,CAAC,2BAA2B,KAAK,SAAS,GAC1C;AACA,uBAAa,KAAK,KAAK;AAAA,QACzB;AAAA,MACF;AACA,YAAM,UAAU,CAAC,QAAe;AAC9B,gBAAQ;AACR,eAAO,IAAI,MAAM,gCAAgC,IAAI,OAAO,EAAE,CAAC;AAAA,MACjE;AACA,YAAM,UAAU,CAAC,SAAwB;AACvC,cAAM,aAAa,OAAO,OAAO,YAAY,EAAE,SAAS,MAAM;AAC9D,cAAM,aAAa,OAAO,OAAO,YAAY,EAAE,SAAS,MAAM,EAAE,KAAK;AACrE,gBAAQ;AACR,YAAI,SAAS,GAAG;AACd,kBAAQ,UAAU;AAAA,QACpB,WAAW,SAAS,GAAG;AACrB,kBAAQ,EAAE;AAAA,QACZ,OAAO;AACL,cAAI,YAAY;AACd;AAAA,cACE,IAAI,MAAM,gCAAgC,IAAI,KAAK,UAAU,EAAE;AAAA,YACjE;AAAA,UACF,OAAO;AACL,oBAAQ,EAAE;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAEA,YAAM,UAAU,MAAM;AACpB,cAAM,OAAO,eAAe,QAAQ,MAAM;AAC1C,cAAM,OAAO,eAAe,QAAQ,QAAQ;AAC5C,cAAM,eAAe,SAAS,OAAO;AACrC,cAAM,eAAe,SAAS,OAAO;AACrC,YAAI,MAAM,WAAW;AACnB,gBAAM,WAAW;AAAA,QACnB;AAAA,MACF;AAEA,YAAM,OAAO,GAAG,QAAQ,MAAM;AAC9B,YAAM,OAAO,GAAG,QAAQ,QAAQ;AAChC,YAAM,GAAG,SAAS,OAAO;AACzB,YAAM,GAAG,SAAS,OAAO;AAAA,IAC3B,CAAC;AAED,WAAO,IAAIC,IAAG,MAAM;AAAA,EACtB,SAAS,WAAoB;AAC3B,WAAO,IAAIC,KAAI,eAAe,SAAS,CAAC;AAAA,EAC1C;AACF;AAEO,SAAS,cACd,iBACA,UACc;AACd,QAAM,cAA4B,CAAC;AAEnC,QAAM,YAAY,gBAAgB,MAAM,GAAG;AAC3C,aAAW,QAAQ,WAAW;AAC5B,QAAI,CAAC,KAAK,KAAK,GAAG;AAChB;AAAA,IACF;AAEA,UAAM,aAAa,KAAK,QAAQ,GAAG;AACnC,QAAI,eAAe,IAAI;AACrB;AAAA,IACF;AACA,UAAM,cAAc,KAAK,QAAQ,KAAK,aAAa,CAAC;AACpD,QAAI,gBAAgB,IAAI;AACtB;AAAA,IACF;AAEA,UAAM,sBAAsB,KAAK,UAAU,GAAG,UAAU;AACxD,UAAM,UAAUC,MAAK,QAAQ,UAAU,mBAAmB;AAC1D,UAAM,eAAeA,MAAK,SAAS,UAAU,OAAO;AAEpD,UAAM,cAAc,KAAK,UAAU,aAAa,GAAG,WAAW;AAC9D,UAAM,aAAa,SAAS,WAAW;AAEvC,QAAI,MAAM,UAAU,GAAG;AACrB;AAAA,IACF;AAEA,UAAM,UAAU,KAAK,UAAU,cAAc,CAAC;AAE9C,gBAAY,KAAK;AAAA,MACf,UAAU;AAAA,MACV;AAAA,MACA;AAAA,IACF,CAAC;AAAA,EACH;AAEA,SAAO;AACT;;;ADnIA,IAAM,cAAc;AACpB,IAAM,kBAAkB;AAEjB,SAAS,SAAS,SAA4B;AACnD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAEF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,SAAS;AAAA,UACP,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,WAAW;AAAA,UACT,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,cAAc;AAAA,UACZ,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,MACA,UAAU,CAAC,SAAS;AAAA,IACtB;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,UAAU,MAAM;AACtB,YAAM,YAAa,MAAM,YACrBC,MAAK,QAAQ,QAAQ,KAAK,MAAM,SAAmB,IACnD,QAAQ;AACZ,YAAM,cAAc,MAAM;AAE1B,YAAM,aAAa,MAAM,YAAY,SAAS,WAAW,WAAW;AAEpE,UAAI,WAAW,MAAM,GAAG;AACtB,eAAO,UAAU,WAAW,MAAM,OAAO;AAAA,MAC3C;AAEA,YAAM,YAAY,WAAW;AAE7B,UAAI,CAAC,UAAU,KAAK,GAAG;AACrB,eAAO;AAAA,MACT;AAEA,YAAM,UAAU,cAAc,WAAW,SAAS;AAElD,UAAI,QAAQ,WAAW,GAAG;AACxB,eAAO;AAAA,MACT;AAEA,YAAM,UAAU,QAAQ,MAAM,GAAG,WAAW;AAC5C,YAAM,QAAQ,QAAQ,IAAI,CAAC,MAAM;AAC/B,cAAM,UACJ,EAAE,QAAQ,SAAS,kBACf,EAAE,QAAQ,UAAU,GAAG,eAAe,IAAI,cAC1C,EAAE;AACR,eAAO,GAAG,EAAE,QAAQ,IAAI,EAAE,UAAU,KAAK,OAAO;AAAA,MAClD,CAAC;AAED,UAAI,SAAS,MAAM,KAAK,IAAI;AAE5B,UAAI,QAAQ,SAAS,aAAa;AAChC,kBAAU;AAAA;AAAA,GAAQ,QAAQ,SAAS,WAAW;AAAA,MAChD;AAEA,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;AEzEO,SAAS,YAAY,SAA4B;AACtD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAEF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,UAAU;AAAA,UACR,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,MACF;AAAA,MACA,UAAU,CAAC,UAAU;AAAA,IACvB;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,WAAW,MAAM;AACvB,aAAO,QAAQ,QAAQ,QAAQ;AAAA,IACjC;AAAA,EACF;AACF;;;AChBO,SAAS,SAAS,SAA4B;AACnD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,aACE;AAAA,IAGF,aAAa;AAAA,MACX,MAAM;AAAA,MACN,YAAY;AAAA,QACV,MAAM;AAAA,UACJ,MAAM;AAAA,UACN,MAAM,CAAC,SAAS,YAAY;AAAA,UAC5B,aAAa;AAAA,QACf;AAAA,QACA,QAAQ;AAAA,UACN,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,OAAO;AAAA,UACL,MAAM;AAAA,UACN,aAAa;AAAA,QACf;AAAA,QACA,OAAO;AAAA,UACL,MAAM;AAAA,UACN,OAAO,EAAE,MAAM,SAAS;AAAA,UACxB,aACE;AAAA,QACJ;AAAA,MACF;AAAA,MACA,UAAU,CAAC,QAAQ,QAAQ;AAAA,IAC7B;AAAA,IACA,MAAM,QAAQ,OAAO;AACnB,YAAM,WAAW,MAAM;AACvB,YAAM,SAAS,MAAM;AAErB,UAAI,aAAa,cAAc;AAC7B,cAAM,YAAY,MAAM;AACxB,YAAI,CAAC,WAAW;AACd,iBAAO;AAAA,QACT;AACA,YAAI,CAAC,QAAQ,YAAY;AACvB,iBAAO;AAAA,QACT;AAGA,cAAM,EAAE,mBAAAC,mBAAkB,IAAI,MAAM,OAAO,6BAAoB;AAC/D,cAAM,OAAOA,mBAAkB,OAAO;AACtC,eAAO,KAAK,QAAQ,EAAE,OAAO,WAAW,SAAS,OAAO,CAAC;AAAA,MAC3D;AAEA,UAAI,aAAa,SAAS;AACxB,eAAO,iBAAiB,SAAS,QAAQ,MAAM,KAA6B;AAAA,MAC9E;AAEA,aAAO,6BAA6B,QAAQ;AAAA,IAC9C;AAAA,EACF;AACF;AAEA,eAAe,iBACb,SACA,QACA,YACiB;AACjB,QAAM,aAAa,QAAQ;AAC3B,MAAI,CAAC,YAAY;AACf,WAAO;AAAA,EACT;AAGA,QAAM,WAAW,YAAY;AAAA,IAC3B,GAAG;AAAA,IACH,SAAS,YAAY;AAAA,EACvB,CAAC;AAED,MAAI,eAAe,SAAS,OAAO,CAAC,MAAM,EAAE,SAAS,MAAM;AAE3D,MAAI,cAAc,WAAW,SAAS,GAAG;AACvC,UAAM,YAAY,IAAI,IAAI,UAAU;AACpC,mBAAe,aAAa,OAAO,CAAC,MAAM,UAAU,IAAI,EAAE,IAAI,CAAC;AAAA,EACjE;AAEA,QAAM,WAAW,mBAAmB,YAAY;AAChD,QAAM,eAAe,kBAAkB,QAAQ,GAAG,IAChD;AAEF,QAAM,OAAO,gBAAgB;AAAA,IAC3B;AAAA,IACA;AAAA,IACA,OAAO;AAAA,IACP,aAAa,CAAC,SAAS,YAAgB,cAAc,MAAM,QAAQ,eAAe;AAAA,IAClF,WAAW;AAAA,EACb,CAAC;AAGD,MAAI,eAAe;AACnB,MAAI,SAAS;AAGb,OAAK,YAAY,MAAM;AAEvB,mBAAiB,SAAS,KAAK,OAAO,GAAG;AACvC,YAAQ,MAAM,MAAM;AAAA,MAClB,KAAK;AACH,wBAAgB,MAAM;AACtB;AAAA,MACF,KAAK;AACH,iBAAS;AACT;AAAA,MACF,KAAK;AACH,eAAO,oBAAoB,MAAM,OAAO;AAAA,IAC5C;AAEA,QAAI,QAAQ;AACV;AAAA,IACF;AAAA,EACF;AAEA,SAAO,gBAAgB;AACzB;;;ACnGA,IAAM,sBAAsB,oBAAI,IAAI,CAAC,aAAa,QAAQ,QAAQ,UAAU,CAAC;AAKtE,SAAS,YAAY,SAA8B;AACxD,QAAM,QAAgB;AAAA,IACpB,aAAa,OAAO;AAAA,IACpB,cAAc,OAAO;AAAA,IACrB,aAAa,OAAO;AAAA,IACpB,SAAS,OAAO;AAAA,IAChB,SAAS,OAAO;AAAA,IAChB,SAAS,OAAO;AAAA,IAChB,YAAY,OAAO;AAAA,EACrB;AAEA,MAAI,QAAQ,YAAY;AACtB,UAAM,KAAK,kBAAkB,OAAO,CAAC;AACrC,UAAM,KAAK,SAAS,OAAO,CAAC;AAAA,EAC9B;AAEA,SAAO;AACT;AAKO,SAAS,mBAAmB,OAAiC;AAClE,SAAO,MAAM,IAAI,CAAC,OAAO;AAAA,IACvB,MAAM,EAAE;AAAA,IACR,aAAa,EAAE;AAAA,IACf,aAAa,EAAE;AAAA,EACjB,EAAE;AACJ;AAKA,eAAsB,YACpB,OACA,MACA,iBACiB;AACjB,QAAM,OAAO,MAAM,KAAK,CAAC,MAAM,EAAE,SAAS,KAAK,IAAI;AACnD,MAAI,CAAC,MAAM;AACT,WAAO,wBAAwB,KAAK,IAAI;AAAA,EAC1C;AAEA,MAAI,CAAC,oBAAoB,IAAI,KAAK,IAAI,GAAG;AACvC,UAAM,WAAW,MAAM,gBAAgB,IAAI;AAC3C,QAAI,CAAC,UAAU;AACb,aAAO;AAAA,IACT;AAAA,EACF;AAEA,MAAI;AACF,WAAO,MAAM,KAAK,QAAQ,KAAK,KAAK;AAAA,EACtC,SAAS,KAAK;AACZ,UAAM,UAAU,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG;AAC/D,WAAO,mBAAmB,KAAK,IAAI,KAAK,OAAO;AAAA,EACjD;AACF;;;ACzFA,OAAOC,UAAS,YAAAC,iBAAgB;AAChC,SAAS,OAAAC,MAAK,QAAAC,OAAM,gBAAgB;;;ACDpC,SAAS,OAAAC,MAAK,QAAAC,aAAY;AAC1B,OAAOC,YAAW;AAUX,SAAS,gBAAgB;AAAA,EAC9B;AAAA,EACA;AAAA,EACA;AACF,GAAyB;AACvB,QAAM,mBAAmB,SAAS;AAAA,IAAO,CAAC,YACxC,QAAQ,KAAK,YAAY,EAAE,WAAW,MAAM,YAAY,CAAC;AAAA,EAC3D;AAEA,MAAI,iBAAiB,WAAW,GAAG;AACjC,WACE,gBAAAA,OAAA,cAACF,MAAA,EAAI,eAAc,YACjB,gBAAAE,OAAA,cAACF,MAAA,EAAI,UAAU,KACb,gBAAAE,OAAA,cAACD,OAAA,EAAK,UAAQ,QAAC,mBAAiB,CAClC,CACF;AAAA,EAEJ;AAEA,SACE,gBAAAC,OAAA,cAACF,MAAA,EAAI,eAAc,YACjB,gBAAAE,OAAA,cAACF,MAAA,EAAI,UAAU,GAAG,eAAc,YAC7B,iBAAiB,IAAI,CAAC,SAAS,UAAU;AACxC,UAAM,aAAa,UAAU;AAC7B,WACE,gBAAAE,OAAA,cAACF,MAAA,EAAI,KAAK,QAAQ,MAAM,eAAc,SACpC,gBAAAE,OAAA,cAACF,MAAA,EAAI,OAAO,MACV,gBAAAE,OAAA;AAAA,MAACD;AAAA,MAAA;AAAA,QACC,OAAO,aAAa,SAAS;AAAA,QAC7B,MAAM;AAAA;AAAA,MACP;AAAA,MACG,QAAQ;AAAA,IACZ,CACF,GACA,gBAAAC,OAAA,cAACD,OAAA,EAAK,UAAU,CAAC,cAAa,QAAQ,WAAY,CACpD;AAAA,EAEJ,CAAC,CACH,CACF;AAEJ;;;ADtCO,SAAS,SAAS;AAAA,EACvB;AAAA,EACA;AAAA,EACA;AAAA,EACA,cAAc;AAAA,EACd,WAAW;AACb,GAAkB;AAChB,QAAM,CAAC,OAAO,QAAQ,IAAIE,UAAS,EAAE;AACrC,QAAM,CAAC,gBAAgB,iBAAiB,IAAIA,UAAS,CAAC;AAGtD,QAAM,CAAC,qBAAqB,sBAAsB,IAAIA,UAAS,KAAK;AACpE,QAAM,CAAC,cAAc,eAAe,IAAIA,UAAS,EAAE;AACnD,QAAM,CAAC,sBAAsB,uBAAuB,IAAIA,UAAS,CAAC;AAElE,QAAM,sBAAsB,MAC1B,SAAS;AAAA,IAAO,CAAC,QACf,IAAI,KAAK,YAAY,EAAE,WAAW,aAAa,YAAY,CAAC;AAAA,EAC9D;AAEF,QAAM,kBAAkB,MAAM;AAC5B,2BAAuB,KAAK;AAC5B,oBAAgB,EAAE;AAClB,4BAAwB,CAAC;AAAA,EAC3B;AAEA;AAAA,IACE,CAAC,OAAO,QAAQ;AACd,UAAI,SAAU;AAGd,UAAI,qBAAqB;AACvB,YAAI,IAAI,QAAQ;AACd,0BAAgB;AAChB;AAAA,QACF;AAEA,YAAI,IAAI,SAAS;AACf,kCAAwB,CAAC,SAAS,KAAK,IAAI,GAAG,OAAO,CAAC,CAAC;AACvD;AAAA,QACF;AAEA,YAAI,IAAI,WAAW;AACjB,gBAAM,WAAW,oBAAoB;AACrC;AAAA,YAAwB,CAAC,SACvB,KAAK,IAAI,SAAS,SAAS,GAAG,OAAO,CAAC;AAAA,UACxC;AACA;AAAA,QACF;AAEA,YAAI,IAAI,QAAQ;AACd,gBAAM,WAAW,oBAAoB;AACrC,cAAI,SAAS,SAAS,KAAK,uBAAuB,SAAS,QAAQ;AACjE,kBAAM,WAAW,SAAS,oBAAoB;AAC9C,4BAAgB;AAChB,qBAAS,EAAE;AACX,8BAAkB,CAAC;AACnB,4BAAgB,QAAQ;AAAA,UAC1B;AACA;AAAA,QACF;AAEA,YAAI,IAAI,aAAa,IAAI,QAAQ;AAC/B,cAAI,aAAa,SAAS,GAAG;AAC3B,4BAAgB,CAAC,SAAS,KAAK,MAAM,GAAG,EAAE,CAAC;AAC3C,oCAAwB,CAAC;AAAA,UAC3B,OAAO;AACL,4BAAgB;AAAA,UAClB;AACA;AAAA,QACF;AAGA,YAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,QAAQ,SAAS,MAAM,WAAW,GAAG;AACzD,0BAAgB,CAAC,SAAS,OAAO,KAAK;AACtC,kCAAwB,CAAC;AAAA,QAC3B;AACA;AAAA,MACF;AAKA,UACE,UAAU,OACV,UAAU,MACV,mBAAmB,KACnB,CAAC,IAAI,QACL,CAAC,IAAI,MACL;AACA,+BAAuB,IAAI;AAC3B,wBAAgB,EAAE;AAClB,gCAAwB,CAAC;AACzB;AAAA,MACF;AAEA,UAAI,IAAI,QAAQ;AAEd,YAAI,iBAAiB,KAAK,MAAM,iBAAiB,CAAC,MAAM,MAAM;AAC5D,gBAAM,WACJ,MAAM,MAAM,GAAG,iBAAiB,CAAC,IACjC,OACA,MAAM,MAAM,cAAc;AAC5B,mBAAS,QAAQ;AACjB;AAAA,QACF;AAEA,YAAI,MAAM,KAAK,GAAG;AAChB,mBAAS,MAAM,KAAK,CAAC;AACrB,mBAAS,EAAE;AACX,4BAAkB,CAAC;AAAA,QACrB;AACA;AAAA,MACF;AAEA,UAAI,IAAI,aAAa,IAAI,QAAQ;AAC/B,YAAI,iBAAiB,GAAG;AACtB;AAAA,YACE,MAAM,MAAM,GAAG,iBAAiB,CAAC,IAAI,MAAM,MAAM,cAAc;AAAA,UACjE;AACA,4BAAkB,iBAAiB,CAAC;AAAA,QACtC;AACA;AAAA,MACF;AAEA,UAAI,IAAI,QAAQ,UAAU,KAAK;AAC7B,gBAAQ,KAAK,CAAC;AAAA,MAChB;AAEA,UAAI,IAAI,QAAQ,UAAU,KAAK;AAC7B,iBAAS,EAAE;AACX,0BAAkB,CAAC;AACnB;AAAA,MACF;AAGA,UAAI,IAAI,QAAQ,UAAU,KAAK;AAC7B,YAAI,SAAS;AACb,eAAO,SAAS,KAAK,MAAM,SAAS,CAAC,MAAM,MAAM;AAC/C;AAAA,QACF;AACA,0BAAkB,MAAM;AACxB;AAAA,MACF;AAGA,UAAI,IAAI,QAAQ,UAAU,KAAK;AAC7B,YAAI,SAAS;AACb,eAAO,SAAS,MAAM,UAAU,MAAM,MAAM,MAAM,MAAM;AACtD;AAAA,QACF;AACA,0BAAkB,MAAM;AACxB;AAAA,MACF;AAGA,UAAI,IAAI,QAAQ,UAAU,OAAO,iBAAiB,GAAG;AACnD,YAAI,SAAS,iBAAiB;AAC9B,eAAO,SAAS,KAAK,KAAK,KAAK,MAAM,MAAM,CAAC,GAAG;AAC7C;AAAA,QACF;AACA,eAAO,SAAS,KAAK,CAAC,KAAK,KAAK,MAAM,SAAS,CAAC,CAAC,GAAG;AAClD;AAAA,QACF;AACA,0BAAkB,MAAM;AACxB;AAAA,MACF;AAGA,UAAI,IAAI,QAAQ,UAAU,OAAO,iBAAiB,MAAM,QAAQ;AAC9D,YAAI,SAAS;AACb,YAAI,KAAK,KAAK,MAAM,MAAM,CAAC,GAAG;AAC5B,iBACE,SAAS,MAAM,UACf,KAAK,KAAK,MAAM,MAAM,CAAC,KACvB,MAAM,MAAM,MAAM,MAClB;AACA;AAAA,UACF;AACA,cAAI,MAAM,MAAM,MAAM,MAAM;AAC1B,8BAAkB,MAAM;AACxB;AAAA,UACF;AAAA,QACF,OAAO;AACL,iBAAO,SAAS,MAAM,UAAU,CAAC,KAAK,KAAK,MAAM,MAAM,CAAC,GAAG;AACzD;AAAA,UACF;AACA,iBACE,SAAS,MAAM,UACf,KAAK,KAAK,MAAM,MAAM,CAAC,KACvB,MAAM,MAAM,MAAM,MAClB;AACA;AAAA,UACF;AAAA,QACF;AACA,0BAAkB,MAAM;AACxB;AAAA,MACF;AAGA,UAAI,IAAI,aAAa,iBAAiB,GAAG;AACvC,0BAAkB,iBAAiB,CAAC;AACpC;AAAA,MACF;AAGA,UAAI,IAAI,cAAc,iBAAiB,MAAM,QAAQ;AACnD,0BAAkB,iBAAiB,CAAC;AACpC;AAAA,MACF;AAGA,UAAI,IAAI,SAAS;AACf,cAAMC,SAAQ,MAAM,MAAM,IAAI;AAC9B,YAAI,MAAM;AACV,YAAI,YAAY;AAChB,YAAI,YAAY;AAEhB,iBAAS,IAAI,GAAG,IAAIA,OAAM,QAAQ,KAAK;AACrC,cACE,kBAAkB,OAClB,kBAAkB,MAAMA,OAAM,CAAC,EAAE,QACjC;AACA,wBAAY;AACZ,wBAAY,iBAAiB;AAC7B;AAAA,UACF;AACA,iBAAOA,OAAM,CAAC,EAAE,SAAS;AAAA,QAC3B;AAEA,YAAI,YAAY,GAAG;AACjB,gBAAM,iBAAiBA,OAAM,YAAY,CAAC,EAAE;AAC5C,gBAAM,eAAe,KAAK,IAAI,WAAW,cAAc;AACvD,cAAI,eAAe;AACnB,mBAAS,IAAI,GAAG,IAAI,YAAY,GAAG,KAAK;AACtC,4BAAgBA,OAAM,CAAC,EAAE,SAAS;AAAA,UACpC;AACA,0BAAgB;AAChB,4BAAkB,YAAY;AAAA,QAChC,OAAO;AACL,4BAAkB,CAAC;AAAA,QACrB;AACA;AAAA,MACF;AAGA,UAAI,IAAI,WAAW;AACjB,cAAMA,SAAQ,MAAM,MAAM,IAAI;AAC9B,YAAI,MAAM;AACV,YAAI,YAAY;AAChB,YAAI,YAAY;AAEhB,iBAAS,IAAI,GAAG,IAAIA,OAAM,QAAQ,KAAK;AACrC,cACE,kBAAkB,OAClB,kBAAkB,MAAMA,OAAM,CAAC,EAAE,QACjC;AACA,wBAAY;AACZ,wBAAY,iBAAiB;AAC7B;AAAA,UACF;AACA,iBAAOA,OAAM,CAAC,EAAE,SAAS;AAAA,QAC3B;AAEA,YAAI,YAAYA,OAAM,SAAS,GAAG;AAChC,gBAAM,iBAAiBA,OAAM,YAAY,CAAC,EAAE;AAC5C,gBAAM,eAAe,KAAK,IAAI,WAAW,cAAc;AACvD,cAAI,eAAe;AACnB,mBAAS,IAAI,GAAG,KAAK,WAAW,KAAK;AACnC,4BAAgBA,OAAM,CAAC,EAAE,SAAS;AAAA,UACpC;AACA,0BAAgB;AAChB,4BAAkB,YAAY;AAAA,QAChC,OAAO;AACL,4BAAkB,MAAM,MAAM;AAAA,QAChC;AACA;AAAA,MACF;AAGA,UAAI,CAAC,IAAI,QAAQ,CAAC,IAAI,QAAQ,OAAO;AACnC,YAAI,MAAM,SAAS,GAAG;AAEpB,gBAAM,aAAa,MAAM,QAAQ,OAAO,IAAI;AAC5C,gBAAM,WACJ,MAAM,MAAM,GAAG,cAAc,IAC7B,aACA,MAAM,MAAM,cAAc;AAC5B,mBAAS,QAAQ;AACjB,4BAAkB,iBAAiB,WAAW,MAAM;AAAA,QACtD,OAAO;AACL,gBAAM,WACJ,MAAM,MAAM,GAAG,cAAc,IAC7B,QACA,MAAM,MAAM,cAAc;AAC5B,mBAAS,QAAQ;AACjB,4BAAkB,iBAAiB,CAAC;AAAA,QACtC;AAAA,MACF;AAAA,IACF;AAAA,IACA,EAAE,UAAU,CAAC,SAAS;AAAA,EACxB;AAGA,QAAM,eAAe,sBAAsB,IAAI,YAAY,KAAK;AAChE,QAAM,wBAAwB,sBAC1B,aAAa,SAAS,IACtB;AAEJ,QAAM,QAAQ,aAAa,MAAM,IAAI;AACrC,MAAI,aAAa;AACjB,MAAI,aAAa;AACjB,MAAI,kBAAkB;AAEtB,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,QACE,yBAAyB,cACzB,yBAAyB,aAAa,MAAM,CAAC,EAAE,QAC/C;AACA,mBAAa;AACb,wBAAkB,wBAAwB;AAC1C;AAAA,IACF;AACA,kBAAc,MAAM,CAAC,EAAE,SAAS;AAAA,EAClC;AAEA,SACE,gBAAAC,OAAA,cAACC,MAAA,EAAI,eAAc,YAEhB,uBAAuB,CAAC,YACvB,gBAAAD,OAAA;AAAA,IAAC;AAAA;AAAA,MACC,OAAO;AAAA,MACP,eAAe;AAAA,MACf;AAAA;AAAA,EACF,GAGF,gBAAAA,OAAA;AAAA,IAACC;AAAA,IAAA;AAAA,MACC,eAAc;AAAA,MACd,aAAY;AAAA,MACZ,aAAa,WAAW,SAAS;AAAA,MACjC,aAAa;AAAA,MACb,cAAc;AAAA;AAAA,IAEb,eACC,MAAM,IAAI,CAAC,MAAM,UACf,gBAAAD,OAAA,cAACC,MAAA,EAAI,KAAK,SACP,UAAU,KACT,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,MAAI,QACpB,KAAK,GACR,GAED,UAAU,KAAK,gBAAAF,OAAA,cAACE,OAAA,MAAM,IAAK,GAC3B,CAAC,YAAY,UAAU,aACtB,gBAAAF,OAAA,cAAAA,OAAA,gBACE,gBAAAA,OAAA,cAACE,OAAA,MAAM,KAAK,UAAU,GAAG,eAAe,CAAE,GAC1C,gBAAAF,OAAA,cAACE,OAAA,EAAK,iBAAgB,QAAO,OAAM,WAChC,KAAK,OAAO,eAAe,KAAK,GACnC,GACA,gBAAAF,OAAA,cAACE,OAAA,MAAM,KAAK,UAAU,kBAAkB,CAAC,CAAE,CAC7C,IAEA,gBAAAF,OAAA,cAACE,OAAA,MAAM,SAAS,KAAK,MAAM,IAAK,CAEpC,CACD,IAED,gBAAAF,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,MAAI,QACpB,KAAK,GACR,GACC,WACC,gBAAAF,OAAA,cAACE,OAAA,MAAK,GAAC,IAEP,gBAAAF,OAAA,cAAAA,OAAA,gBACE,gBAAAA,OAAA,cAACE,OAAA,EAAK,iBAAgB,QAAO,OAAM,WAChC,GACH,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAC,KAAE,WAAY,CAC/B,CAEJ;AAAA,EAEJ,GACC,CAAC,YACA,gBAAAF,OAAA,cAACC,MAAA,EAAI,YAAY,KACf,gBAAAD,OAAA,cAACE,OAAA,EAAK,UAAQ,QACX,sBACG,qEACA,gFACN,CACF,CAEJ;AAEJ;;;AEzZA,SAAS,OAAAC,MAAK,QAAAC,OAAM,YAAAC,iBAAgB;AAEpC,OAAOC,UAAS,YAAAC,iBAAgB;AAUhC,IAAM,mBAAqC;AAAA,EACzC,EAAE,IAAI,WAAW,OAAO,WAAW,aAAa,yBAAyB;AAAA,EACzE;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,aAAa;AAAA,EACf;AACF;AAEA,SAAS,eAAe,MAAwB;AAC9C,QAAM,QAAQ,KAAK;AACnB,UAAQ,KAAK,MAAM;AAAA,IACjB,KAAK;AACH,aAAO,OAAO,MAAM,YAAY,WAAW,MAAM,UAAU;AAAA,IAC7D,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AACH,aAAO,OAAO,MAAM,SAAS,WAAW,MAAM,OAAO;AAAA,IACvD,KAAK;AACH,aAAO,OAAO,MAAM,UAAU,WAAW,MAAM,QAAQ;AAAA,IACzD,KAAK;AACH,aAAO,OAAO,MAAM,gBAAgB,WAAW,MAAM,cAAc;AAAA,IACrE;AACE,aAAO,KAAK,UAAU,OAAO,MAAM,CAAC;AAAA,EACxC;AACF;AAOO,IAAM,uBAAsD,CAAC;AAAA,EAClE;AAAA,EACA;AACF,MAAM;AACJ,QAAM,CAAC,QAAQ,SAAS,IAAIA,UAAS,CAAC;AAEtC,EAAAF,UAAS,CAAC,QAAQ,QAAQ;AACxB,QAAI,IAAI,SAAS;AACf,gBAAU,CAAC,SAAU,OAAO,IAAI,OAAO,IAAI,iBAAiB,SAAS,CAAE;AACvE;AAAA,IACF;AAEA,QAAI,IAAI,WAAW;AACjB,gBAAU,CAAC,SAAU,OAAO,iBAAiB,SAAS,IAAI,OAAO,IAAI,CAAE;AACvE;AAAA,IACF;AAEA,QAAI,IAAI,QAAQ;AACd,YAAM,iBAAiB,iBAAiB,MAAM;AAC9C,iBAAW,eAAe,OAAO,SAAS;AAC1C;AAAA,IACF;AAAA,EACF,CAAC;AAED,QAAM,UAAU,eAAe,IAAI;AAEnC,SACE,gBAAAC,OAAA,cAACH,MAAA,EAAI,eAAc,YACjB,gBAAAG,OAAA,cAACH,MAAA,EAAI,UAAU,GAAG,eAAc,UAAS,WAAW,KAClD,gBAAAG,OAAA,cAACF,OAAA,EAAK,OAAM,UAAS,MAAI,QACtB,KAAK,IACR,GACC,WAAW,gBAAAE,OAAA,cAACF,OAAA,MAAM,OAAQ,CAC7B,GACA,gBAAAE,OAAA,cAACH,MAAA,EAAI,UAAU,GAAG,eAAc,YAC7B,iBAAiB,IAAI,CAAC,QAAQ,UAAU;AACvC,UAAM,aAAa,UAAU;AAC7B,WACE,gBAAAG,OAAA,cAACH,MAAA,EAAI,KAAK,OAAO,IAAI,eAAc,SACjC,gBAAAG,OAAA,cAACH,MAAA,EAAI,OAAO,MACV,gBAAAG,OAAA;AAAA,MAACF;AAAA,MAAA;AAAA,QACC,OAAO,aAAa,SAAS;AAAA,QAC7B,MAAM;AAAA;AAAA,MAEL,OAAO;AAAA,IACV,CACF,GACA,gBAAAE,OAAA,cAACF,OAAA,EAAK,UAAU,CAAC,cAAa,OAAO,WAAY,CACnD;AAAA,EAEJ,CAAC,CACH,CACF;AAEJ;;;AClGA,OAAOI,YAAW;AAClB,SAAS,OAAAC,MAAK,QAAAC,aAAY;AAgB1B,IAAM,cAAsC;AAAA,EAC1C,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,MAAM;AAAA,EACN,MAAM;AAAA,EACN,MAAM;AAAA,EACN,UAAU;AAAA,EACV,iBAAiB;AAAA,EACjB,MAAM;AACR;AAEA,SAAS,SAAS,MAAsB;AACtC,SAAO,YAAY,IAAI,KAAK;AAC9B;AAEA,SAAS,gBACP,MACA,OACQ;AACR,MAAI,CAAC,aAAa,cAAc,WAAW,EAAE,SAAS,IAAI,GAAG;AAC3D,UAAM,IAAI,MAAM,QAAQ,MAAM,aAAa,MAAM;AACjD,WAAO,OAAO,MAAM,WAAW,gBAAgB,CAAC,IAAI;AAAA,EACtD;AACA,MAAI,SAAS,QAAQ;AACnB,UAAM,MAAM,MAAM;AAClB,WAAO,OAAO,QAAQ,WAAW,SAAS,KAAK,EAAE,IAAI;AAAA,EACvD;AACA,MAAI,SAAS,QAAQ;AACnB,UAAM,UAAU,MAAM,WAAW,MAAM;AACvC,WAAO,OAAO,YAAY,WAAW,SAAS,SAAS,EAAE,IAAI;AAAA,EAC/D;AACA,MAAI,SAAS,QAAQ;AACnB,UAAM,UAAU,MAAM,WAAW,MAAM;AACvC,WAAO,OAAO,YAAY,WAAW,SAAS,SAAS,EAAE,IAAI;AAAA,EAC/D;AACA,MAAI,SAAS,mBAAmB;AAC9B,UAAM,QAAQ,MAAM,cAAc,MAAM;AACxC,WAAO,OAAO,UAAU,WAAW,QAAQ;AAAA,EAC7C;AACA,aAAW,OAAO,OAAO,OAAO,KAAK,GAAG;AACtC,QAAI,OAAO,QAAQ,UAAU;AAC3B,aAAO,SAAS,KAAK,EAAE;AAAA,IACzB;AAAA,EACF;AACA,SAAO;AACT;AAEA,SAAS,gBAAgB,GAAmB;AAC1C,QAAM,QAAQ,EAAE,MAAM,GAAG;AACzB,MAAI,MAAM,SAAS,GAAG;AACpB,WAAO,SAAS,MAAM,MAAM,EAAE,EAAE,KAAK,GAAG;AAAA,EAC1C;AACA,SAAO;AACT;AAEA,SAAS,SAAS,KAAa,WAA2B;AACxD,MAAI,IAAI,UAAU,UAAW,QAAO;AACpC,SAAO,IAAI,UAAU,GAAG,SAAS,IAAI;AACvC;AAEA,SAAS,eAAe,SAAyB;AAC/C,MAAI,UAAU,IAAK,QAAO;AAC1B,MAAI,UAAU,GAAI,QAAO,GAAG,QAAQ,QAAQ,CAAC,CAAC;AAC9C,SAAO,GAAG,KAAK,MAAM,OAAO,CAAC;AAC/B;AAOA,SAAS,eAAe,QAAgB,QAA4B;AAClE,QAAM,QAAoB,CAAC;AAC3B,aAAW,QAAQ,OAAO,MAAM,IAAI,GAAG;AACrC,UAAM,KAAK,EAAE,SAAS,MAAM,MAAM,SAAS,CAAC;AAAA,EAC9C;AACA,aAAW,QAAQ,OAAO,MAAM,IAAI,GAAG;AACrC,UAAM,KAAK,EAAE,SAAS,MAAM,MAAM,MAAM,CAAC;AAAA,EAC3C;AACA,SAAO;AACT;AAEA,SAAS,aAAa,QAA0B;AAC9C,QAAM,QAAQ,OAAO,MAAM,IAAI,EAAE,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC;AACvD,SAAO,MAAM,MAAM,GAAG,EAAE;AAC1B;AAEO,SAAS,cAAc,EAAE,UAAU,GAAuB;AAC/D,SACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,eAAc,YAChB,UAAU,IAAI,CAAC,OAAO;AACrB,UAAM,QAAQ,SAAS,GAAG,IAAI;AAC9B,UAAM,QAAQ,gBAAgB,GAAG,MAAM,GAAG,KAAK;AAC/C,UAAM,aACJ,GAAG,WAAW;AAChB,UAAM,UACJ,eACC,GAAG,SAAS,GAAG,OAAO,YAAY,EAAE,WAAW,OAAO,IAAI;AAC7D,UAAM,WAAW,GAAG,WAAW,eAAe,GAAG,QAAQ,IAAI;AAE7D,WACE,gBAAAD,OAAA,cAACC,MAAA,EAAI,KAAK,GAAG,IAAI,eAAc,YAC7B,gBAAAD,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA;AAAA,MAACE;AAAA,MAAA;AAAA,QACC,OACE,GAAG,WAAW,cACV,WACA,UACE,QACA;AAAA;AAAA,MAGP,GAAG,WAAW,cAAc,cAAS,UAAU,cAAS;AAAA,IAC3D,GACA,gBAAAF,OAAA;AAAA,MAACE;AAAA,MAAA;AAAA,QACC,MAAI;AAAA,QACJ,OACE,GAAG,WAAW,cACV,WACA,UACE,QACA;AAAA;AAAA,MAGP;AAAA,IACH,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,UAAQ,MAAM,KAAM,GAC/B,YAAY,gBAAAF,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAE,MAAM,QAAS,CAC9C,GACC,GAAG,UAAU,WACZ,gBAAAF,OAAA,cAACC,MAAA,EAAI,YAAY,GAAG,eAAc,YAC/B,aAAa,GAAG,MAAM,EAAE,IAAI,CAAC,MAAM,MAClC,gBAAAD,OAAA,cAACE,OAAA,EAAK,KAAK,GAAG,OAAM,OAAM,UAAQ,QAC/B,IACH,CACD,CACH,GAED,GAAG,SAAS,eACX,GAAG,WAAW,eACd,OAAO,GAAG,MAAM,eAAe,YAC/B,OAAO,GAAG,MAAM,eAAe,YAC7B,gBAAAF,OAAA,cAACC,MAAA,EAAI,YAAY,GAAG,eAAc,YAC/B;AAAA,MACC,GAAG,MAAM;AAAA,MACT,GAAG,MAAM;AAAA,IACX,EAAE,IAAI,CAAC,MAAM,MACX,gBAAAD,OAAA;AAAA,MAACE;AAAA,MAAA;AAAA,QACC,KAAK;AAAA,QACL,iBACE,KAAK,SAAS,WAAW,YAAY;AAAA;AAAA,MAGvC,gBAAAF,OAAA;AAAA,QAACE;AAAA,QAAA;AAAA,UACC,OAAO,KAAK,SAAS,WAAW,QAAQ;AAAA,UACxC,MAAI;AAAA;AAAA,QAEH,KAAK,SAAS,WAAW,QAAQ;AAAA,MACpC;AAAA,MACA,gBAAAF,OAAA,cAACE,OAAA,MAAM,KAAK,SAAQ,GAAC;AAAA,IACvB,CACD,CACH,CAEN;AAAA,EAEJ,CAAC,CACH;AAEJ;;;AC3LA,OAAOC,YAAW;AAClB,SAAS,OAAAC,MAAK,QAAAC,aAAY;AAC1B,SAAS,YAAAC,iBAAgB;AACzB,SAAS,eAAe;AAMxB,SAASC,cAAaC,MAAqB;AACzC,MAAI;AACF,WAAOF,UAAS,mCAAmC;AAAA,MACjD,KAAAE;AAAA,MACA,UAAU;AAAA,MACV,OAAO,CAAC,QAAQ,QAAQ,MAAM;AAAA,IAChC,CAAC,EAAE,KAAK;AAAA,EACV,QAAQ;AACN,WAAO;AAAA,EACT;AACF;AAEA,SAAS,YAAY,GAAmB;AACtC,QAAM,OAAO,QAAQ;AACrB,MAAI,EAAE,WAAW,IAAI,GAAG;AACtB,WAAO,MAAM,EAAE,MAAM,KAAK,MAAM;AAAA,EAClC;AACA,SAAO;AACT;AAEO,SAAS,cAAc,EAAE,KAAAA,KAAI,GAAuB;AACzD,QAAM,SAASD,cAAaC,IAAG;AAC/B,QAAM,WAAW,YAAYA,IAAG;AAEhC,SACE,gBAAAL,OAAA,cAACC,MAAA,EAAI,WAAW,GAAG,cAAc,KAC/B,gBAAAD,OAAA,cAACC,MAAA,EAAI,eAAc,UAAS,aAAa,KACvC,gBAAAD,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,SAAQ,UAAQ,QACzB,QACH,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,WAAS,eAAM,GAC3B,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,OAAM,UAAQ,QACvB,eACH,CACF,GACA,gBAAAF,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,SAAQ,UAAQ,QACzB,QACH,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,WAAS,eAAM,GAC3B,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,SAAO,oBAAM,CAC3B,GACA,gBAAAF,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,UAAQ,QACxB,qBACH,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,UAAQ,QACxB,oBACH,CACF,GACA,gBAAAF,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,UAAQ,qBAAO,GAC3B,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,UAAS,UAAQ,QAC1B,UACH,CACF,CACF,GACA,gBAAAF,OAAA,cAACC,MAAA,EAAI,eAAc,UAAS,gBAAe,YACzC,gBAAAD,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAC,yBACM,QACrB,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAC,YACL,gBAAAF,OAAA,cAACE,OAAA,EAAK,MAAI,MAAC,UAAQ,QAAE,MAAO,GACnC,UAAM,SAAK,gBAAAF,OAAA,cAACE,OAAA,EAAK,MAAI,MAAC,UAAQ,QAAC,OAAK,GAAO,eAC9C,GACA,gBAAAF,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAC,4DAEf,CACF,CACF;AAEJ;;;ACrEO,IAAM,iBAAiB,CAAC,YAAuC;AAAA,EACpE;AAAA,IACE,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS,MAAM;AACb,UAAI,QAAQ,UAAU;AACpB,gBAAQ,SAAS;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS,MAAM;AACb,UAAI,QAAQ,mBAAmB;AAC7B,gBAAQ,kBAAkB;AAAA,MAC5B;AAAA,IACF;AAAA,EACF;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS,MAAM;AACb,UAAI,QAAQ,YAAY;AACtB,gBAAQ,WAAW;AAAA,MACrB;AAAA,IACF;AAAA,EACF;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,aAAa;AAAA,IACb,SAAS,MAAM;AACb,cAAQ,KAAK,CAAC;AAAA,IAChB;AAAA,EACF;AACF;;;ApBFA,SAAS,iBAAiB,GAAmB;AAC3C,MAAI,KAAK,IAAM,QAAO,IAAI,IAAI,KAAM,QAAQ,CAAC,CAAC;AAC9C,SAAO,GAAG,CAAC;AACb;AAEA,IAAM,YAAY,SAAI,OAAO,EAAE;AAExB,SAAS,KAAK,EAAE,YAAY,KAAAI,MAAK,eAAAC,eAAc,GAAc;AAClE,QAAM,CAAC,SAAS,UAAU,IAAIC,UAAwB;AAAA,IACpD,EAAE,MAAM,WAAW,IAAI,UAAU;AAAA,EACnC,CAAC;AACD,QAAM,CAAC,WAAW,YAAY,IAAIA,UAAqB,CAAC,CAAC;AACzD,QAAM,CAAC,cAAc,eAAe,IAAIA,UAAS,KAAK;AACtD,QAAM,CAAC,aAAa,cAAc,IAAIA,UAAS,EAAE,OAAO,GAAG,QAAQ,EAAE,CAAC;AAGtE,QAAM,qBAAqB,OAA0C,IAAI;AACzE,QAAM,CAAC,iBAAiB,kBAAkB,IAAIA,UAAwB,IAAI;AAG1E,QAAM,sBAAsB;AAAA,IAC1B;AAAA,EACF;AACA,QAAM,CAAC,iBAAiB,kBAAkB,IAAIA,UAA0B,IAAI;AAE5E,QAAM,UAAU,OAAkD,IAAI;AACtE,QAAM,YAAY,OAAO,CAAC;AAE1B,QAAM,SAASC,aAAY,MAAM;AAC/B,cAAU,WAAW;AACrB,WAAO,QAAQ,UAAU,OAAO;AAAA,EAClC,GAAG,CAAC,CAAC;AAGL,EAAAC,WAAU,MAAM;AACd,UAAM,kBAAkB,CAAC,SAAqC;AAC5D,aAAO,IAAI,QAAiB,CAAC,YAAY;AACvC,2BAAmB,IAAI;AACvB,4BAAoB,UAAU;AAAA,MAChC,CAAC;AAAA,IACH;AAEA,UAAM,cAA2B;AAAA,MAC/B,KAAAJ;AAAA,MACA;AAAA,MACA,SAAS,OAAO,aAAqB;AACnC,eAAO,IAAI,QAAgB,CAAC,YAAY;AACtC,6BAAmB,QAAQ;AAC3B,6BAAmB,UAAU;AAAA,QAC/B,CAAC;AAAA,MACH;AAAA,MACA;AAAA,IACF;AAEA,UAAM,QAAQ,YAAY,WAAW;AACrC,UAAM,WAAW,mBAAmB,KAAK;AACzC,UAAM,eAAe,kBAAkBA,IAAG;AAE1C,UAAM,OAAO,gBAAgB;AAAA,MAC3B;AAAA,MACA;AAAA,MACA,OAAO;AAAA,MACP,aAAa,CAAC,SAAS,YAAY,OAAO,MAAM,eAAe;AAAA,IACjE,CAAC;AAED,YAAQ,UAAU;AAGlB,KAAC,YAAY;AACX,uBAAiB,SAAS,KAAK,OAAO,GAAG;AACvC,oBAAY,KAAK;AAAA,MACnB;AAAA,IACF,GAAG;AAGH,QAAIC,gBAAe;AACjB,sBAAgB,IAAI;AACpB,iBAAW,CAAC,SAAS;AAAA,QACnB,GAAG;AAAA,QACH,EAAE,IAAI,OAAO,GAAG,MAAM,QAAQ,SAASA,eAAc;AAAA,QACrD,EAAE,IAAI,OAAO,GAAG,MAAM,YAAY;AAAA,MACpC,CAAC;AACD,WAAK,YAAYA,cAAa;AAAA,IAChC;AAAA,EACF,GAAG,CAAC,CAAC;AAEL,QAAM,cAAcE;AAAA,IAClB,CAAC,UAAsB;AACrB,cAAQ,MAAM,MAAM;AAAA,QAClB,KAAK;AACH,uBAAa,CAAC,SAAS;AACrB,kBAAM,OAAO,KAAK,KAAK,SAAS,CAAC;AACjC,gBAAI,QAAQ,KAAK,SAAS,YAAY;AACpC,qBAAO;AAAA,gBACL,GAAG,KAAK,MAAM,GAAG,EAAE;AAAA,gBACnB,EAAE,GAAG,MAAM,MAAM,KAAK,OAAO,MAAM,KAAK;AAAA,cAC1C;AAAA,YACF;AACA,mBAAO;AAAA,cACL,GAAG;AAAA,cACH,EAAE,MAAM,YAAY,IAAI,QAAQ,KAAK,IAAI,CAAC,IAAI,MAAM,MAAM,KAAK;AAAA,YACjE;AAAA,UACF,CAAC;AACD;AAAA,QAEF,KAAK;AACH,uBAAa,CAAC,SAAS;AACrB,kBAAM,OAAO,KAAK,KAAK,SAAS,CAAC;AACjC,gBAAI,QAAQ,KAAK,SAAS,QAAQ;AAChC,qBAAO;AAAA,gBACL,GAAG,KAAK,MAAM,GAAG,EAAE;AAAA,gBACnB,EAAE,GAAG,MAAM,MAAM,KAAK,OAAO,MAAM,KAAK;AAAA,cAC1C;AAAA,YACF;AACA,mBAAO;AAAA,cACL,GAAG;AAAA,cACH,EAAE,MAAM,QAAQ,IAAI,QAAQ,KAAK,IAAI,CAAC,IAAI,MAAM,MAAM,KAAK;AAAA,YAC7D;AAAA,UACF,CAAC;AACD;AAAA,QAEF,KAAK;AACH,uBAAa,CAAC,SAAS;AAAA,YACrB,GAAG;AAAA,YACH;AAAA,cACE,MAAM;AAAA,cACN,IAAI,WAAW,MAAM,EAAE;AAAA,cACvB,MAAM;AAAA,gBACJ,IAAI,MAAM;AAAA,gBACV,MAAM,MAAM;AAAA,gBACZ,OAAO,MAAM;AAAA,gBACb,QAAQ;AAAA,gBACR,WAAW,KAAK,IAAI;AAAA,cACtB;AAAA,YACF;AAAA,UACF,CAAC;AACD;AAAA,QAEF,KAAK;AACH;AAAA,YAAa,CAAC,SACZ,KAAK;AAAA,cAAI,CAAC,SACR,KAAK,SAAS,eAAe,KAAK,KAAK,OAAO,MAAM,KAChD;AAAA,gBACE,GAAG;AAAA,gBACH,MAAM,EAAE,GAAG,KAAK,MAAM,QAAQ,YAAqB;AAAA,cACrD,IACA;AAAA,YACN;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH;AAAA,YAAa,CAAC,SACZ,KAAK;AAAA,cAAI,CAAC,SACR,KAAK,SAAS,eAAe,KAAK,KAAK,OAAO,MAAM,KAChD;AAAA,gBACE,GAAG;AAAA,gBACH,MAAM;AAAA,kBACJ,GAAG,KAAK;AAAA,kBACR,QAAQ;AAAA,kBACR,QAAQ,MAAM;AAAA,kBACd,UAAU,KAAK,KAAK,aACf,KAAK,IAAI,IAAI,KAAK,KAAK,aAAa,MACrC;AAAA,gBACN;AAAA,cACF,IACA;AAAA,YACN;AAAA,UACF;AACA;AAAA,QAEF,KAAK;AACH,yBAAe,CAAC,UAAU;AAAA,YACxB,OAAO,KAAK,QAAQ,MAAM;AAAA,YAC1B,QAAQ,KAAK,SAAS,MAAM;AAAA,UAC9B,EAAE;AACF;AAAA,QAEF,KAAK;AAEH,uBAAa,CAAC,SAAS;AACrB,gBAAI,KAAK,SAAS,GAAG;AACnB,oBAAM,eAA8B,KAAK,IAAI,CAAC,SAAS;AACrD,wBAAQ,KAAK,MAAM;AAAA,kBACjB,KAAK;AACH,2BAAO;AAAA,sBACL,MAAM;AAAA,sBACN,IAAI,KAAK;AAAA,sBACT,SAAS,KAAK;AAAA,oBAChB;AAAA,kBACF,KAAK;AACH,2BAAO;AAAA,sBACL,MAAM;AAAA,sBACN,IAAI,KAAK;AAAA,sBACT,SAAS,KAAK;AAAA,oBAChB;AAAA,kBACF,KAAK;AACH,2BAAO;AAAA,sBACL,MAAM;AAAA,sBACN,IAAI,KAAK;AAAA,sBACT,MAAM,KAAK;AAAA,oBACb;AAAA,gBACJ;AAAA,cACF,CAAC;AACD,yBAAW,CAAC,MAAM;AAAA,gBAChB,GAAG;AAAA,gBACH,GAAG;AAAA,gBACH,EAAE,MAAM,aAAa,IAAI,OAAO,KAAK,IAAI,CAAC,GAAG;AAAA,cAC/C,CAAC;AAAA,YACH;AACA,mBAAO,CAAC;AAAA,UACV,CAAC;AACD,0BAAgB,KAAK;AACrB;AAAA,QAEF,KAAK;AACH,uBAAa,CAAC,CAAC;AACf,qBAAW,CAAC,SAAS;AAAA,YACnB,GAAG;AAAA,YACH,EAAE,MAAM,SAAS,IAAI,OAAO,KAAK,IAAI,CAAC,IAAI,SAAS,MAAM,QAAQ;AAAA,YACjE,EAAE,MAAM,aAAa,IAAI,OAAO,KAAK,IAAI,CAAC,GAAG;AAAA,UAC/C,CAAC;AACD,0BAAgB,KAAK;AACrB;AAAA,MACJ;AAAA,IACF;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AAEA,QAAM,WAAW;AAAA,IACf,MACE,eAAe;AAAA,MACb,UAAU,MAAM;AACd,mBAAW,CAAC,SAAS;AAAA,UACnB,GAAG;AAAA,UACH;AAAA,YACE,IAAI,OAAO;AAAA,YACX,MAAM;AAAA,YACN,SAAS;AAAA,cACP;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACF,EAAE,KAAK,IAAI;AAAA,UACb;AAAA,UACA,EAAE,IAAI,OAAO,GAAG,MAAM,YAAY;AAAA,QACpC,CAAC;AAAA,MACH;AAAA,MACA,mBAAmB,MAAM;AACvB,mBAAW,CAAC,EAAE,MAAM,WAAW,IAAI,UAAU,CAAC,CAAC;AAC/C,qBAAa,CAAC,CAAC;AAAA,MACjB;AAAA,MACA,YAAY,MAAM;AAChB,mBAAW,CAAC,SAAS;AAAA,UACnB,GAAG;AAAA,UACH;AAAA,YACE,IAAI,OAAO;AAAA,YACX,MAAM;AAAA,YACN,SAAS;AAAA,cACP,cAAcH,IAAG;AAAA,cACjB,WAAW,iBAAiB,YAAY,KAAK,CAAC,SAAS,iBAAiB,YAAY,MAAM,CAAC;AAAA,cAC3F,aAAa,QAAQ,OAAO,CAAC,MAAM,EAAE,SAAS,MAAM,EAAE,MAAM;AAAA,cAC5D,eAAe,eAAe,QAAQ,IAAI;AAAA,YAC5C,EAAE,KAAK,IAAI;AAAA,UACb;AAAA,UACA,EAAE,IAAI,OAAO,GAAG,MAAM,YAAY;AAAA,QACpC,CAAC;AAAA,MACH;AAAA,IACF,CAAC;AAAA,IACH,CAAC,QAAQA,MAAK,aAAa,SAAS,YAAY;AAAA,EAClD;AAEA,QAAM,sBAAsBG,aAAY,CAAC,YAAqB;AAC5D,SAAK,QAAQ,QAAQ,CAAC,CAAC;AAAA,EACzB,GAAG,CAAC,CAAC;AAEL,QAAM,eAAeA;AAAA,IACnB,CAAC,SAAiB;AAEhB,UAAI,mBAAmB,mBAAmB,SAAS;AACjD,2BAAmB,QAAQ,IAAI;AAC/B,2BAAmB,UAAU;AAC7B,2BAAmB,IAAI;AACvB;AAAA,MACF;AAEA,UAAI,CAAC,QAAQ,WAAW,cAAc;AACpC;AAAA,MACF;AAEA,sBAAgB,IAAI;AACpB,iBAAW,CAAC,SAAS;AAAA,QACnB,GAAG;AAAA,QACH,EAAE,IAAI,OAAO,GAAG,MAAM,QAAQ,SAAS,KAAK;AAAA,QAC5C,EAAE,IAAI,OAAO,GAAG,MAAM,YAAY;AAAA,MACpC,CAAC;AACD,cAAQ,QAAQ,YAAY,IAAI;AAAA,IAClC;AAAA,IACA,CAAC,cAAc,QAAQ,eAAe;AAAA,EACxC;AAGA,QAAM,oBAAoB,UAAU;AAAA,IAClC,CAAC,SAAS,KAAK,SAAS,eAAe,KAAK,KAAK,WAAW;AAAA,EAC9D;AAEA,SACE,gBAAAE,OAAA,cAACC,MAAA,EAAI,eAAc,UAAS,SAAS,KAEnC,gBAAAD,OAAA,cAAC,UAAO,OAAO,WACZ,CAAC,SAAS;AACT,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,eACE,gBAAAA,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAAC,iBAAc,KAAKL,MAAK,CAC3B;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAK,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,IAAI,eAAc,YAC/B,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,SAAQ,MAAI,QAAC,KAEzB,GACA,gBAAAF,OAAA,cAACE,OAAA,MAAM,KAAK,OAAQ,CACtB;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,UAAQ,MAAC,QAAM,QAC/B,KAAK,OACR,CACF;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,MAAM,KAAK,OAAQ,CACtB;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAAC,iBAAc,WAAW,CAAC,KAAK,IAAI,GAAG,CACzC;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAA,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAE,KAAK,OAAQ,CAC/B;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,OAAM,MAAI,QACnB,kBACD,gBAAAF,OAAA,cAACE,OAAA,EAAK,OAAM,SAAO,KAAK,OAAQ,CAClC,CACF;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAE,SAAU,CAC5B;AAAA,IAEN;AAAA,EACF,CACF,GAGC,UAAU,IAAI,CAAC,SAAS;AACvB,YAAQ,KAAK,MAAM;AAAA,MACjB,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,UAAQ,MAAC,QAAM,QAC/B,KAAK,IACR,CACF;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAACE,OAAA,MAAM,KAAK,IAAK,CACnB;AAAA,MAEJ,KAAK;AACH,eACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,KAAK,MACb,gBAAAD,OAAA,cAAC,iBAAc,WAAW,CAAC,KAAK,IAAI,GAAG,CACzC;AAAA,IAEN;AAAA,EACF,CAAC,GAGA,gBAAgB,UAAU,WAAW,KACpC,gBAAAA,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,UACV,gBAAAF,OAAA,cAACG,UAAA,EAAQ,MAAK,QAAO,CACvB,GACA,gBAAAH,OAAA,cAACE,OAAA,EAAK,OAAM,UAAO,cAAY,CACjC,GAID,gBAAgB,qBACf,gBAAAF,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,UACV,gBAAAF,OAAA,cAACG,UAAA,EAAQ,MAAK,QAAO,CACvB,GACA,gBAAAH,OAAA,cAACE,OAAA,EAAK,OAAM,UAAO,aAAW,CAChC,GAID,mBACC,gBAAAF,OAAA;AAAA,IAAC;AAAA;AAAA,MACC,MAAM;AAAA,MACN,YAAY,CAAC,aAAa;AACxB,YAAI,oBAAoB,SAAS;AAC/B,8BAAoB,QAAQ,QAAQ;AACpC,8BAAoB,UAAU;AAAA,QAChC;AACA,2BAAmB,IAAI;AAAA,MACzB;AAAA;AAAA,EACF,GAID,mBACC,gBAAAA,OAAA,cAACC,MAAA,EAAI,UAAU,GAAG,eAAc,UAAS,WAAW,KAClD,gBAAAD,OAAA,cAACC,MAAA,EAAI,OAAO,MACV,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,QAAO,MAAI,QAAC,YAExB,CACF,GACA,gBAAAF,OAAA,cAACE,OAAA,MAAM,eAAgB,CACzB,GAIF,gBAAAF,OAAA;AAAA,IAAC;AAAA;AAAA,MACC,UAAU;AAAA,MACV,iBAAiB;AAAA,MACjB;AAAA,MACA,UAAW,gBAAgB,CAAC,mBAAoB,CAAC,CAAC;AAAA,MAClD,aACE,kBACI,mCACA;AAAA;AAAA,EAER,IAGE,YAAY,QAAQ,KAAK,YAAY,SAAS,MAC9C,gBAAAA,OAAA,cAACC,MAAA,EAAI,WAAW,KACd,gBAAAD,OAAA,cAACE,OAAA,EAAK,UAAQ,QAAC,YACJ,iBAAiB,YAAY,KAAK,GAAE,SAAM,KAClD,iBAAiB,YAAY,MAAM,GAAE,MACxC,CACF,CAEJ;AAEJ;;;AqB3gBA,SAAS,OAAAE,MAAK,QAAAC,OAAM,YAAAC,iBAAgB;AACpC,OAAOC,cAAa;AACpB,OAAOC,UAAsB,aAAAC,YAAW,YAAAC,iBAAgB;AASjD,SAAS,kBAAkB,EAAE,WAAW,GAA2B;AACxE,QAAM,CAAC,WAAW,YAAY,IAAIC,UAAS,IAAI;AAC/C,QAAM,CAAC,YAAY,aAAa,IAAIA,UAA+B,CAAC,CAAC;AACrE,QAAM,CAAC,eAAe,gBAAgB,IAAIA,UAAS,CAAC;AACpD,QAAM,CAAC,OAAO,QAAQ,IAAIA,UAAwB,IAAI;AAEtD,EAAAC,WAAU,MAAM;AACd,KAAC,YAAY;AACX,UAAI;AACF,qBAAa,IAAI;AAEjB,cAAM,YAAY,MAAM,cAAc;AACtC,YAAI,UAAU,MAAM,GAAG;AACrB,mBAAS,UAAU,MAAM,OAAO;AAChC;AAAA,QACF;AAEA,cAAM,SAAS,UAAU;AACzB,YAAI,CAAC,QAAQ;AACX,mBAAS,6DAA6D;AACtE,uBAAa,KAAK;AAClB;AAAA,QACF;AAEA,cAAM,aAAa,MAAM,OAAO,GAAG;AACnC,YAAI,WAAW,MAAM,GAAG;AACtB,mBAAS,8BAA8B,WAAW,MAAM,OAAO,EAAE;AACjE,uBAAa,KAAK;AAClB;AAAA,QACF;AAEA,cAAM,iBAAiB,WAAW,MAAM,cAAc,CAAC;AAEvD,YAAI,eAAe,WAAW,GAAG;AAC/B,mBAAS,qEAAqE;AAC9E,uBAAa,KAAK;AAClB;AAAA,QACF;AAEA,YAAI,eAAe,WAAW,GAAG;AAC/B,gBAAM,qBAAa,gBAAgB,eAAe,CAAC,EAAE,GAAG;AACxD,0BAAgB;AAChB,uBAAa,KAAK;AAClB,qBAAW;AACX;AAAA,QACF;AAEA,sBAAc,cAAc;AAC5B,qBAAa,KAAK;AAAA,MACpB,SAAS,KAAK;AACZ,iBAAS,+BAA+B,eAAe,QAAQ,IAAI,UAAU,OAAO,GAAG,CAAC,EAAE;AAC1F,qBAAa,KAAK;AAAA,MACpB;AAAA,IACF,GAAG;AAAA,EACL,GAAG,CAAC,UAAU,CAAC;AAEf,EAAAC;AAAA,IACE,CAAC,OAAO,QAAQ;AACd,UAAI,WAAW,WAAW,GAAG;AAC3B;AAAA,MACF;AAEA,UAAI,IAAI,SAAS;AACf,yBAAiB,CAAC,SAAS,KAAK,IAAI,GAAG,OAAO,CAAC,CAAC;AAAA,MAClD,WAAW,IAAI,WAAW;AACxB,yBAAiB,CAAC,SAAS,KAAK,IAAI,WAAW,SAAS,GAAG,OAAO,CAAC,CAAC;AAAA,MACtE,WAAW,IAAI,QAAQ;AACrB,cAAM,WAAW,WAAW,aAAa;AACzC,SAAC,YAAY;AACX,gBAAM,qBAAa,gBAAgB,SAAS,GAAG;AAC/C,0BAAgB;AAChB,qBAAW;AAAA,QACb,GAAG;AAAA,MACL;AAAA,IACF;AAAA,IACA,EAAE,UAAU,WAAW,SAAS,EAAE;AAAA,EACpC;AAEA,MAAI,WAAW;AACb,WACE,gBAAAC,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,WAAQ,gBAAAF,OAAA,cAACG,UAAA,EAAQ,MAAK,QAAO,CAAE,GAC3C,gBAAAH,OAAA,cAACE,OAAA,MAAK,6BAA2B,CACnC;AAAA,EAEJ;AAEA,MAAI,OAAO;AACT,WACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,eAAc,YACjB,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,SAAM,WAAQ,KAAM,CAClC;AAAA,EAEJ;AAEA,SACE,gBAAAF,OAAA,cAACC,MAAA,EAAI,eAAc,YACjB,gBAAAD,OAAA,cAACC,MAAA,EAAI,cAAc,KACjB,gBAAAD,OAAA,cAACE,OAAA,EAAK,MAAI,QAAC,qBAAmB,CAChC,GACC,WAAW,IAAI,CAAC,IAAI,MACnB,gBAAAF,OAAA,cAACC,MAAA,EAAI,KAAK,GAAG,OACX,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAO,MAAM,gBAAgB,SAAS,UACzC,MAAM,gBAAgB,OAAO,MAC7B,GAAG,MAAK,MAAG,GAAG,MAAK,GACtB,CACF,CACD,CACH;AAEJ;;;A3BrGO,SAAS,IAAI,EAAE,KAAAE,MAAK,eAAAC,gBAAe,QAAQ,IAAI,GAAa;AACjE,QAAM,CAAC,OAAO,QAAQ,IAAIC,UAAmB,UAAU;AACvD,QAAM,CAAC,YAAY,aAAa,IAAIA,UAAyB,IAAI;AACjE,QAAM,CAAC,OAAO,QAAQ,IAAIA,UAAwB,IAAI;AAEtD,QAAM,mBAAmBC,aAAY,YAAY;AAE/C,UAAM,cAAc,MAAM,qBAAa,eAAe;AACtD,QAAI,CAAC,eAAe,gBAAgB,MAAM;AACxC,eAAS,kBAAkB;AAC3B;AAAA,IACF;AAGA,oBAAgB;AAEhB,UAAM,YAAY,MAAM,cAAc;AACtC,QAAI,UAAU,MAAM,GAAG;AACrB,eAAS,UAAU,MAAM,OAAO;AAChC,eAAS,OAAO;AAChB;AAAA,IACF;AAEA,UAAM,SAAS,UAAU;AACzB,QAAI,CAAC,QAAQ;AACX,eAAS,MAAM;AACf;AAAA,IACF;AAEA,kBAAc,MAAM;AACpB,aAAS,OAAO;AAAA,EAClB,GAAG,CAAC,CAAC;AAEL,EAAAC,WAAU,MAAM;AACd,KAAC,YAAY;AACX,YAAM,SAAS,MAAM,oBAAY,gBAAgB;AACjD,UAAI,QAAQ;AACV,cAAM,iBAAiB;AAAA,MACzB,OAAO;AACL,iBAAS,MAAM;AAAA,MACjB;AAAA,IACF,GAAG;AAAA,EACL,GAAG,CAAC,gBAAgB,CAAC;AAErB,QAAM,qBAAqBD,aAAY,YAAY;AACjD,UAAM,iBAAiB;AAAA,EACzB,GAAG,CAAC,gBAAgB,CAAC;AAErB,QAAM,0BAA0BA,aAAY,YAAY;AACtD,oBAAgB;AAChB,UAAM,YAAY,MAAM,cAAc;AACtC,QAAI,UAAU,MAAM,GAAG;AACrB,eAAS,UAAU,MAAM,OAAO;AAChC,eAAS,OAAO;AAChB;AAAA,IACF;AAEA,UAAM,SAAS,UAAU;AACzB,QAAI,CAAC,QAAQ;AACX,eAAS,wDAAwD;AACjE,eAAS,OAAO;AAChB;AAAA,IACF;AAEA,kBAAc,MAAM;AACpB,aAAS,OAAO;AAAA,EAClB,GAAG,CAAC,CAAC;AAEL,MAAI,UAAU,YAAY;AACxB,WACE,gBAAAE,OAAA,cAACC,MAAA,MACC,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,WAAQ,gBAAAF,OAAA,cAACG,UAAA,EAAQ,MAAK,QAAO,CAAE,GAC3C,gBAAAH,OAAA,cAACE,OAAA,MAAK,8BAA4B,CACpC;AAAA,EAEJ;AAEA,MAAI,UAAU,QAAQ;AACpB,WAAO,gBAAAF,OAAA,cAAC,QAAK,YAAY,oBAAoB,QAAgB,KAAU;AAAA,EACzE;AAEA,MAAI,UAAU,oBAAoB;AAChC,WAAO,gBAAAA,OAAA,cAAC,qBAAkB,YAAY,yBAAyB;AAAA,EACjE;AAEA,MAAI,UAAU,WAAW,CAAC,YAAY;AACpC,WACE,gBAAAA,OAAA,cAACC,MAAA,EAAI,eAAc,YACjB,gBAAAD,OAAA,cAACE,OAAA,EAAK,OAAM,SAAM,WAAQ,SAAS,uBAAwB,GAC3D,gBAAAF,OAAA,cAACE,OAAA,MAAK,iDAA+C,CACvD;AAAA,EAEJ;AAEA,SAAO,gBAAAF,OAAA,cAAC,QAAK,YAAwB,KAAKL,MAAK,eAAeC,gBAAe;AAC/E;;;AD5GA,IAAM,MAAM;AAAA,EACV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA;AAAA,IACE,YAAY;AAAA,IACZ,OAAO;AAAA,MACL,QAAQ;AAAA,QACN,MAAM;AAAA,MACR;AAAA,MACA,KAAK;AAAA,QACH,MAAM;AAAA,MACR;AAAA,MACA,KAAK;AAAA,QACH,MAAM;AAAA,QACN,SAAS,QAAQ,IAAI;AAAA,MACvB;AAAA,IACF;AAAA,EACF;AACF;AAEA,IAAM,gBAAgB,IAAI,MAAM,KAAK,GAAG,KAAK;AAC7C,IAAM,MAAM,IAAI,MAAM;AAEtB;AAAA,EACE,gBAAAQ,QAAA;AAAA,IAAC;AAAA;AAAA,MACC;AAAA,MACA;AAAA,MACA,QAAQ,IAAI,MAAM;AAAA,MAClB,KAAK,IAAI,MAAM;AAAA;AAAA,EACjB;AACF;","names":["React","Box","Text","Spinner","React","useState","useCallback","useEffect","Err","Ok","Err","Ok","jwtDecode","Err","Ok","jwtDecode","Err","Ok","jwtDecode","fetch","fetch","jwtDecode","React","useState","useCallback","useEffect","Box","Text","Spinner","executeTool","cwd","path","fs","path","path","fs","path","fs","path","cwd","path","stat","path","Err","Ok","path","Ok","Err","path","path","callDustAgentTool","React","useState","Box","Text","Box","Text","React","useState","lines","React","Box","Text","Box","Text","useInput","React","useState","React","Box","Text","React","Box","Text","execSync","getGitBranch","cwd","cwd","initialPrompt","useState","useCallback","useEffect","React","Box","Text","Spinner","Box","Text","useInput","Spinner","React","useEffect","useState","useState","useEffect","useInput","React","Box","Text","Spinner","cwd","initialPrompt","useState","useCallback","useEffect","React","Box","Text","Spinner","React"]}
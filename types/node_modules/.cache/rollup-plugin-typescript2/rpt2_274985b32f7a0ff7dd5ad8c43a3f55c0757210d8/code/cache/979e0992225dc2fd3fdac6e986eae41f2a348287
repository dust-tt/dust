{"code":"import { createParser } from \"eventsource-parser\";\nimport { Err, Ok } from \"../../front/lib/result\";\nimport { isAPIError } from \"./error\";\nconst { DUST_PROD_API = \"https://dust.tt\", NODE_ENV } = process.env;\n/**\n * This help functions process a streamed response in the format of the Dust API for running\n * streamed apps.\n *\n * @param res an HTTP response ready to be consumed as a stream\n */\nexport async function processStreamedRunResponse(res, logger) {\n    if (!res.ok || !res.body) {\n        return new Err({\n            type: \"dust_api_error\",\n            message: `Error running streamed app: status_code=${res.status}`,\n        });\n    }\n    let hasRunId = false;\n    let rejectDustRunIdPromise;\n    let resolveDustRunIdPromise;\n    const dustRunIdPromise = new Promise((resolve, reject) => {\n        rejectDustRunIdPromise = reject;\n        resolveDustRunIdPromise = resolve;\n    });\n    let pendingEvents = [];\n    const parser = createParser((event) => {\n        if (event.type === \"event\") {\n            if (event.data) {\n                try {\n                    const data = JSON.parse(event.data);\n                    switch (data.type) {\n                        case \"error\": {\n                            pendingEvents.push({\n                                type: \"error\",\n                                content: {\n                                    code: data.content.code,\n                                    message: data.content.message,\n                                },\n                            });\n                            break;\n                        }\n                        case \"run_status\": {\n                            pendingEvents.push({\n                                type: data.type,\n                                content: data.content,\n                            });\n                            break;\n                        }\n                        case \"block_status\": {\n                            pendingEvents.push({\n                                type: data.type,\n                                content: data.content,\n                            });\n                            break;\n                        }\n                        case \"block_execution\": {\n                            pendingEvents.push({\n                                type: data.type,\n                                content: data.content,\n                            });\n                            break;\n                        }\n                        case \"tokens\": {\n                            pendingEvents.push({\n                                type: \"tokens\",\n                                content: data.content,\n                            });\n                            break;\n                        }\n                        case \"function_call\": {\n                            pendingEvents.push({\n                                type: \"function_call\",\n                                content: data.content,\n                            });\n                            break;\n                        }\n                        case \"function_call_arguments_tokens\": {\n                            pendingEvents.push({\n                                type: \"function_call_arguments_tokens\",\n                                content: data.content,\n                            });\n                            break;\n                        }\n                        case \"final\": {\n                            pendingEvents.push({\n                                type: \"final\",\n                            });\n                        }\n                    }\n                    if (data.content?.run_id && !hasRunId) {\n                        hasRunId = true;\n                        resolveDustRunIdPromise(data.content.run_id);\n                    }\n                }\n                catch (err) {\n                    logger.error({ error: err }, \"Failed parsing chunk from Dust API\");\n                }\n            }\n        }\n    });\n    const reader = res.body.getReader();\n    const streamEvents = async function* () {\n        try {\n            while (true) {\n                const { done, value } = await reader.read();\n                if (done) {\n                    break;\n                }\n                parser.feed(new TextDecoder().decode(value));\n                for (const event of pendingEvents) {\n                    yield event;\n                }\n                pendingEvents = [];\n            }\n            if (!hasRunId) {\n                // once the stream is entirely consumed, if we haven't received a run id, reject the promise\n                setImmediate(() => {\n                    logger.error({}, \"No run id received.\");\n                    rejectDustRunIdPromise(new Error(\"No run id received\"));\n                });\n            }\n        }\n        catch (e) {\n            yield {\n                type: \"error\",\n                content: {\n                    code: \"stream_error\",\n                    message: \"Error streaming chunks\",\n                },\n            };\n            logger.error({\n                error: e,\n            }, \"Error streaming chunks.\");\n        }\n        finally {\n            reader.releaseLock();\n        }\n    };\n    return new Ok({ eventStream: streamEvents(), dustRunId: dustRunIdPromise });\n}\nexport class DustAPI {\n    _credentials;\n    _useLocalInDev;\n    _logger;\n    _urlOverride;\n    /**\n     * @param credentials DustAPICrededentials\n     */\n    constructor(credentials, logger, { useLocalInDev, urlOverride, } = { useLocalInDev: false }) {\n        this._credentials = credentials;\n        this._logger = logger;\n        this._useLocalInDev = useLocalInDev;\n        this._urlOverride = urlOverride;\n    }\n    workspaceId() {\n        return this._credentials.workspaceId;\n    }\n    apiUrl() {\n        if (this._urlOverride) {\n            return this._urlOverride;\n        }\n        return this._useLocalInDev && NODE_ENV === \"development\"\n            ? \"http://localhost:3000\"\n            : DUST_PROD_API;\n    }\n    /**\n     * This functions talks directly to the Dust production API to create a run.\n     *\n     * @param app DustAppType the app to run streamed\n     * @param config DustAppConfigType the app config\n     * @param inputs any[] the app inputs\n     */\n    async runApp(app, config, inputs, { useWorkspaceCredentials } = {\n        useWorkspaceCredentials: false,\n    }) {\n        let url = `${this.apiUrl()}/api/v1/w/${app.workspaceId}/apps/${app.appId}/runs`;\n        if (useWorkspaceCredentials) {\n            url += \"?use_workspace_credentials=true\";\n        }\n        const res = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n            },\n            body: JSON.stringify({\n                specification_hash: app.appHash,\n                config: config,\n                stream: false,\n                blocking: true,\n                inputs: inputs,\n            }),\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.run);\n    }\n    /**\n     * This functions talks directly to the Dust production API to create a streamed run.\n     *\n     * @param app DustAppType the app to run streamed\n     * @param config DustAppConfigType the app config\n     * @param inputs any[] the app inputs\n     */\n    async runAppStreamed(app, config, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    inputs, { useWorkspaceCredentials } = {\n        useWorkspaceCredentials: false,\n    }) {\n        let url = `${this.apiUrl()}/api/v1/w/${app.workspaceId}/apps/${app.appId}/runs`;\n        if (useWorkspaceCredentials) {\n            url += \"?use_workspace_credentials=true\";\n        }\n        const res = await fetch(url, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n            },\n            body: JSON.stringify({\n                specification_hash: app.appHash,\n                config: config,\n                stream: true,\n                blocking: false,\n                inputs: inputs,\n            }),\n        });\n        return processStreamedRunResponse(res, this._logger);\n    }\n    /**\n     * This actions talks to the Dust production API to retrieve the list of data sources of the\n     * specified workspace id.\n     *\n     * @param workspaceId string the workspace id to fetch data sources for\n     */\n    async getDataSources(workspaceId) {\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${workspaceId}/data_sources`, {\n            method: \"GET\",\n            headers: {\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n            },\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.data_sources);\n    }\n    async getAgentConfigurations() {\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${this.workspaceId()}/assistant/agent_configurations`, {\n            method: \"GET\",\n            headers: {\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n                \"Content-Type\": \"application/json\",\n            },\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.agentConfigurations);\n    }\n    async postContentFragment({ conversationId, contentFragment, }) {\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${this.workspaceId()}/assistant/conversations/${conversationId}/content_fragments`, {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                ...contentFragment,\n            }),\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.contentFragment);\n    }\n    // When creating a conversation with a user message, the API returns only after the user message\n    // was created (and if applicable the assocaited agent messages).\n    async createConversation({ title, visibility, message, contentFragment, }) {\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${this.workspaceId()}/assistant/conversations`, {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                title,\n                visibility,\n                message,\n                contentFragment,\n            }),\n        });\n        return this._resultFromResponse(res);\n    }\n    async postUserMessage({ conversationId, message, }) {\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${this.workspaceId()}/assistant/conversations/${conversationId}/messages`, {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                ...message,\n            }),\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.message);\n    }\n    async streamAgentMessageEvents({ conversation, message, }) {\n        const headers = {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${this._credentials.apiKey}`,\n        };\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${this.workspaceId()}/assistant/conversations/${conversation.sId}/messages/${message.sId}/events`, {\n            method: \"GET\",\n            headers: headers,\n        });\n        if (!res.ok || !res.body) {\n            return new Err({\n                type: \"dust_api_error\",\n                message: `Error running streamed app: status_code=${res.status}  - message=${await res.text()}`,\n            });\n        }\n        let pendingEvents = [];\n        const parser = createParser((event) => {\n            if (event.type === \"event\") {\n                if (event.data) {\n                    try {\n                        const data = JSON.parse(event.data).data;\n                        switch (data.type) {\n                            case \"user_message_error\": {\n                                pendingEvents.push(data);\n                                break;\n                            }\n                            case \"agent_error\": {\n                                pendingEvents.push(data);\n                                break;\n                            }\n                            case \"agent_action_success\": {\n                                pendingEvents.push(data);\n                                break;\n                            }\n                            case \"generation_tokens\": {\n                                pendingEvents.push(data);\n                                break;\n                            }\n                            case \"agent_generation_success\": {\n                                pendingEvents.push(data);\n                                break;\n                            }\n                        }\n                    }\n                    catch (err) {\n                        this._logger.error({ error: err }, \"Failed parsing chunk from Dust API\");\n                    }\n                }\n            }\n        });\n        const reader = res.body.getReader();\n        const logger = this._logger;\n        const streamEvents = async function* () {\n            try {\n                while (true) {\n                    const { done, value } = await reader.read();\n                    if (done) {\n                        break;\n                    }\n                    parser.feed(new TextDecoder().decode(value));\n                    for (const event of pendingEvents) {\n                        yield event;\n                    }\n                    pendingEvents = [];\n                }\n            }\n            catch (e) {\n                yield {\n                    type: \"error\",\n                    content: {\n                        code: \"stream_error\",\n                        message: \"Error streaming chunks\",\n                    },\n                };\n                logger.error({\n                    error: e,\n                }, \"Error streaming chunks.\");\n            }\n            finally {\n                reader.releaseLock();\n            }\n        };\n        return new Ok({ eventStream: streamEvents() });\n    }\n    async getConversation({ conversationId, }) {\n        const res = await fetch(`${this.apiUrl()}/api/v1/w/${this.workspaceId()}/assistant/conversations/${conversationId}`, {\n            method: \"GET\",\n            headers: {\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n                \"Content-Type\": \"application/json\",\n            },\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.conversation);\n    }\n    async tokenize(text, dataSourceName) {\n        const urlSafeName = encodeURIComponent(dataSourceName);\n        const endpoint = `${this.apiUrl()}/api/v1/w/${this.workspaceId()}/data_sources/${urlSafeName}/tokenize`;\n        const res = await fetch(endpoint, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n            },\n            body: JSON.stringify({\n                text,\n            }),\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.tokens);\n    }\n    async getActiveMemberEmailsInWorkspace() {\n        const endpoint = `${this.apiUrl()}/api/v1/w/${this.workspaceId()}/members/emails?activeOnly=true`;\n        const res = await fetch(endpoint, {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n            },\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.emails);\n    }\n    async getWorkspaceVerifiedDomains() {\n        const endpoint = `${this.apiUrl()}/api/v1/w/${this.workspaceId()}/verified_domains`;\n        const res = await fetch(endpoint, {\n            method: \"GET\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                Authorization: `Bearer ${this._credentials.apiKey}`,\n            },\n        });\n        const r = await this._resultFromResponse(res);\n        if (r.isErr()) {\n            return r;\n        }\n        return new Ok(r.value.verified_domains);\n    }\n    async _resultFromResponse(response) {\n        // We get the text and attempt to parse so that we can log the raw text in case of error (the\n        // body is already consumed by response.json() if used otherwise).\n        const text = await response.text();\n        let json = null;\n        try {\n            json = JSON.parse(text);\n        }\n        catch (e) {\n            const err = {\n                type: \"unexpected_response_format\",\n                message: `Unexpected response format from DustAPI: ${e}`,\n            };\n            this._logger.error({\n                dustError: err,\n                parseError: e,\n                rawText: text,\n                status: response.status,\n            }, \"DustAPI error\");\n            return new Err(err);\n        }\n        if (!response.ok) {\n            const err = json?.error;\n            if (isAPIError(err)) {\n                this._logger.error({ dustError: err, status: response.status }, \"DustAPI error\");\n                return new Err(err);\n            }\n            else {\n                const err = {\n                    type: \"unexpected_error_format\",\n                    message: \"Unexpected error format from DustAPI\",\n                };\n                this._logger.error({ dustError: err, json, status: response.status }, \"DustAPI error\");\n                return new Err(err);\n            }\n        }\n        else {\n            return new Ok(json);\n        }\n    }\n}\n//# sourceMappingURL=dust_api.js.map","references":["/Users/edouardwautier/Projects/dust/types/node_modules/eventsource-parser/dist/index.d.ts","/Users/edouardwautier/Projects/dust/types/node_modules/io-ts/lib/index.d.ts","/Users/edouardwautier/Projects/dust/types/src/front/api_handlers/public/assistant.ts","/Users/edouardwautier/Projects/dust/types/src/front/assistant/agent.ts","/Users/edouardwautier/Projects/dust/types/src/front/assistant/conversation.ts","/Users/edouardwautier/Projects/dust/types/src/front/data_source.ts","/Users/edouardwautier/Projects/dust/types/src/front/lib/core_api.ts","/Users/edouardwautier/Projects/dust/types/src/front/lib/result.ts","/Users/edouardwautier/Projects/dust/types/src/front/run.ts","/Users/edouardwautier/Projects/dust/types/src/shared/logger.ts","/Users/edouardwautier/Projects/dust/types/src/front/workspace.ts","/Users/edouardwautier/Projects/dust/types/src/front/lib/api/assistant/agent.ts","/Users/edouardwautier/Projects/dust/types/src/front/lib/api/assistant/conversation.ts","/Users/edouardwautier/Projects/dust/types/src/front/lib/api/assistant/generation.ts","/Users/edouardwautier/Projects/dust/types/src/front/lib/error.ts"],"map":"{\"version\":3,\"file\":\"dust_api.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/front/lib/dust_api.ts\"],\"names\":[],\"mappings\":\"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\"}","dtsmap":{"name":"/Users/edouardwautier/Projects/dust/types/node_modules/.cache/rollup-plugin-typescript2/placeholder/front/lib/dust_api.d.ts.map","writeByteOrderMark":false,"text":"{\"version\":3,\"file\":\"dust_api.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/front/lib/dust_api.ts\"],\"names\":[],\"mappings\":\"AACA,OAAO,KAAK,CAAC,MAAM,OAAO,CAAC;AAE3B,OAAO,EACL,0CAA0C,EAC1C,wCAAwC,EACxC,mCAAmC,EACpC,MAAM,2CAA2C,CAAC;AACnD,OAAO,EAAE,2BAA2B,EAAE,MAAM,6BAA6B,CAAC;AAC1E,OAAO,EACL,gBAAgB,EAChB,mBAAmB,EACnB,gBAAgB,EAChB,eAAe,EAChB,MAAM,oCAAoC,CAAC;AAC5C,OAAO,EAAE,cAAc,EAAE,MAAM,yBAAyB,CAAC;AACzD,OAAO,EAAE,gBAAgB,EAAE,MAAM,0BAA0B,CAAC;AAC5D,OAAO,EAAE,GAAG,EAAE,EAAE,EAAE,MAAM,EAAE,MAAM,wBAAwB,CAAC;AACzD,OAAO,EAAE,OAAO,EAAE,MAAM,iBAAiB,CAAC;AAC1C,OAAO,EAAE,eAAe,EAAE,MAAM,qBAAqB,CAAC;AACtD,OAAO,EAAE,eAAe,EAAE,MAAM,cAAc,CAAC;AAC/C,OAAO,EACL,uBAAuB,EACvB,eAAe,EACf,2BAA2B,EAC5B,MAAM,uBAAuB,CAAC;AAC/B,OAAO,EAAE,qBAAqB,EAAE,MAAM,8BAA8B,CAAC;AACrE,OAAO,EAAE,qBAAqB,EAAE,MAAM,4BAA4B,CAAC;AACnE,OAAO,EAAE,QAAQ,EAAc,MAAM,SAAS,CAAC;AAI/C,MAAM,MAAM,WAAW,GAAG;IACxB,WAAW,EAAE,MAAM,CAAC;IACpB,KAAK,EAAE,MAAM,CAAC;IACd,OAAO,EAAE,MAAM,CAAC;CACjB,CAAC;AAEF,MAAM,MAAM,iBAAiB,GAAG;IAC9B,CAAC,GAAG,EAAE,MAAM,GAAG,OAAO,CAAC;CACxB,CAAC;AAEF,KAAK,sBAAsB,GAAG;IAC5B,IAAI,EAAE,OAAO,CAAC;IACd,OAAO,EAAE;QACP,IAAI,EAAE,MAAM,CAAC;QACb,OAAO,EAAE,MAAM,CAAC;KACjB,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,wBAAwB,GAAG;IACrC,IAAI,EAAE,YAAY,CAAC;IACnB,OAAO,EAAE;QACP,MAAM,EAAE,SAAS,GAAG,WAAW,GAAG,SAAS,CAAC;QAC5C,MAAM,EAAE,MAAM,CAAC;KAChB,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,0BAA0B,GAAG;IACvC,IAAI,EAAE,cAAc,CAAC;IACrB,OAAO,EAAE;QACP,UAAU,EAAE,MAAM,CAAC;QACnB,IAAI,EAAE,MAAM,CAAC;QACb,MAAM,EAAE,SAAS,GAAG,WAAW,GAAG,SAAS,CAAC;QAC5C,aAAa,EAAE,MAAM,CAAC;QACtB,WAAW,EAAE,MAAM,CAAC;KACrB,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,6BAA6B,GAAG;IAC1C,IAAI,EAAE,iBAAiB,CAAC;IACxB,OAAO,EAAE;QACP,UAAU,EAAE,MAAM,CAAC;QACnB,UAAU,EAAE,MAAM,CAAC;QACnB,SAAS,EAAE;YACT,KAAK,EAAE,OAAO,GAAG,IAAI,CAAC;YACtB,KAAK,EAAE,MAAM,GAAG,IAAI,CAAC;YACrB,IAAI,EAAE,OAAO,GAAG,IAAI,CAAC;SACtB,EAAE,EAAE,CAAC;KACP,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,oBAAoB,GAAG;IACjC,IAAI,EAAE,OAAO,CAAC;CACf,CAAC;AAEF,MAAM,MAAM,qBAAqB,GAAG;IAClC,IAAI,EAAE,QAAQ,CAAC;IACf,OAAO,EAAE;QACP,UAAU,EAAE,MAAM,CAAC;QACnB,UAAU,EAAE,MAAM,CAAC;QACnB,WAAW,EAAE,MAAM,CAAC;QACpB,GAAG,EAAE;YACH,IAAI,EAAE,MAAM,CAAC;YACb,SAAS,EAAE,MAAM,CAAC;SACnB,GAAG,IAAI,CAAC;QACT,MAAM,EAAE;YACN,IAAI,EAAE,MAAM,CAAC;YACb,MAAM,CAAC,EAAE,MAAM,EAAE,CAAC;YAClB,QAAQ,CAAC,EAAE,MAAM,EAAE,CAAC;SACrB,CAAC;KACH,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,2BAA2B,GAAG;IACxC,IAAI,EAAE,eAAe,CAAC;IACtB,OAAO,EAAE;QACP,UAAU,EAAE,MAAM,CAAC;QACnB,UAAU,EAAE,MAAM,CAAC;QACnB,WAAW,EAAE,MAAM,CAAC;QACpB,GAAG,EAAE;YACH,IAAI,EAAE,MAAM,CAAC;YACb,SAAS,EAAE,MAAM,CAAC;SACnB,GAAG,IAAI,CAAC;QACT,aAAa,EAAE;YACb,IAAI,EAAE,MAAM,CAAC;SACd,CAAC;KACH,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,0CAA0C,GAAG;IACvD,IAAI,EAAE,gCAAgC,CAAC;IACvC,OAAO,EAAE;QACP,UAAU,EAAE,MAAM,CAAC;QACnB,UAAU,EAAE,MAAM,CAAC;QACnB,WAAW,EAAE,MAAM,CAAC;QACpB,GAAG,EAAE;YACH,IAAI,EAAE,MAAM,CAAC;YACb,SAAS,EAAE,MAAM,CAAC;SACnB,GAAG,IAAI,CAAC;QACT,MAAM,EAAE;YACN,IAAI,EAAE,MAAM,CAAC;SACd,CAAC;KACH,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,kBAAkB,GAAG;IAC/B,MAAM,EAAE,MAAM,CAAC;IACf,WAAW,EAAE,MAAM,CAAC;CACrB,CAAC;AAEF,KAAK,oCAAoC,GAAG,CAAC,CAAC,MAAM,CAClD,OAAO,0CAA0C,CAClD,CAAC;AAEF,MAAM,MAAM,eAAe,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC;AAErD;;;;;GAKG;AACH,wBAAsB,0BAA0B,CAC9C,GAAG,EAAE,QAAQ,EACb,MAAM,EAAE,eAAe;;;;;;IAkJxB;AAED,qBAAa,OAAO;IAClB,YAAY,EAAE,kBAAkB,CAAC;IACjC,cAAc,EAAE,OAAO,CAAC;IACxB,OAAO,EAAE,eAAe,CAAC;IACzB,YAAY,CAAC,EAAE,MAAM,CAAC;IAEtB;;OAEG;gBAED,WAAW,EAAE,kBAAkB,EAC/B,MAAM,EAAE,eAAe,EACvB,EACE,aAAa,EACb,WAAW,GACZ,GAAE;QACD,aAAa,EAAE,OAAO,CAAC;QACvB,WAAW,CAAC,EAAE,MAAM,CAAC;KACK;IAQ9B,WAAW,IAAI,MAAM;IAIrB,MAAM;IASN;;;;;;OAMG;IACG,MAAM,CACV,GAAG,EAAE,WAAW,EAChB,MAAM,EAAE,iBAAiB,EACzB,MAAM,EAAE,OAAO,EAAE,EACjB,EAAE,uBAAuB,EAAE,GAAE;QAAE,uBAAuB,EAAE,OAAO,CAAA;KAE9D,GACA,OAAO,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;IA+BpC;;;;;;OAMG;IACG,cAAc,CAClB,GAAG,EAAE,WAAW,EAChB,MAAM,EAAE,iBAAiB,EAEzB,MAAM,EAAE,GAAG,EAAE,EACb,EAAE,uBAAuB,EAAE,GAAE;QAAE,uBAAuB,EAAE,OAAO,CAAA;KAE9D;;;;;;;IA0BH;;;;;OAKG;IACG,cAAc,CAClB,WAAW,EAAE,MAAM,GAClB,OAAO,CAAC,eAAe,CAAC,cAAc,EAAE,CAAC,CAAC;IAmBvC,sBAAsB,IAAI,OAAO,CACrC,eAAe,CAAC,2BAA2B,EAAE,CAAC,CAC/C;IAqBK,mBAAmB,CAAC,EACxB,cAAc,EACd,eAAe,GAChB,EAAE;QACD,cAAc,EAAE,MAAM,CAAC;QACvB,eAAe,EAAE,oCAAoC,CAAC;KACvD,GAAG,OAAO,CAAC,eAAe,CAAC,mBAAmB,CAAC,CAAC;IAyB3C,kBAAkB,CAAC,EACvB,KAAK,EACL,UAAU,EACV,OAAO,EACP,eAAe,GAChB,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,wCAAwC,CAAC,GAAG,OAAO,CACpE,eAAe,CAAC;QACd,YAAY,EAAE,gBAAgB,CAAC;QAC/B,OAAO,EAAE,eAAe,CAAC;KAC1B,CAAC,CACH;IAqBK,eAAe,CAAC,EACpB,cAAc,EACd,OAAO,GACR,EAAE;QACD,cAAc,EAAE,MAAM,CAAC;QACvB,OAAO,EAAE,CAAC,CAAC,MAAM,CAAC,OAAO,mCAAmC,CAAC,CAAC;KAC/D,GAAG,OAAO,CAAC,eAAe,CAAC,eAAe,CAAC,CAAC;IAuBvC,wBAAwB,CAAC,EAC7B,YAAY,EACZ,OAAO,GACR,EAAE;QACD,YAAY,EAAE,gBAAgB,CAAC;QAC/B,OAAO,EAAE,gBAAgB,CAAC;KAC3B;;;;;;IA4GK,eAAe,CAAC,EACpB,cAAc,GACf,EAAE;QACD,cAAc,EAAE,MAAM,CAAC;KACxB,GAAG,OAAO,CAAC,eAAe,CAAC,gBAAgB,CAAC,CAAC;IAoBxC,QAAQ,CACZ,IAAI,EAAE,MAAM,EACZ,cAAc,EAAE,MAAM,GACrB,OAAO,CAAC,eAAe,CAAC,gBAAgB,EAAE,CAAC,CAAC;IAuBzC,gCAAgC;IAoBhC,2BAA2B;YAoBnB,mBAAmB;CAkDlC\"}"},"dts":{"name":"/Users/edouardwautier/Projects/dust/types/node_modules/.cache/rollup-plugin-typescript2/placeholder/front/lib/dust_api.d.ts","writeByteOrderMark":false,"text":"import * as t from \"io-ts\";\nimport { PublicPostContentFragmentRequestBodySchema, PublicPostConversationsRequestBodySchema, PublicPostMessagesRequestBodySchema } from \"../../front/api_handlers/public/assistant\";\nimport { LightAgentConfigurationType } from \"../../front/assistant/agent\";\nimport { AgentMessageType, ContentFragmentType, ConversationType, UserMessageType } from \"../../front/assistant/conversation\";\nimport { DataSourceType } from \"../../front/data_source\";\nimport { CoreAPITokenType } from \"../../front/lib/core_api\";\nimport { Err, Ok, Result } from \"../../front/lib/result\";\nimport { RunType } from \"../../front/run\";\nimport { LoggerInterface } from \"../../shared/logger\";\nimport { WorkspaceDomain } from \"../workspace\";\nimport { AgentActionSuccessEvent, AgentErrorEvent, AgentGenerationSuccessEvent } from \"./api/assistant/agent\";\nimport { UserMessageErrorEvent } from \"./api/assistant/conversation\";\nimport { GenerationTokensEvent } from \"./api/assistant/generation\";\nimport { APIError } from \"./error\";\nexport type DustAppType = {\n    workspaceId: string;\n    appId: string;\n    appHash: string;\n};\nexport type DustAppConfigType = {\n    [key: string]: unknown;\n};\ntype DustAppRunErroredEvent = {\n    type: \"error\";\n    content: {\n        code: string;\n        message: string;\n    };\n};\nexport type DustAppRunRunStatusEvent = {\n    type: \"run_status\";\n    content: {\n        status: \"running\" | \"succeeded\" | \"errored\";\n        run_id: string;\n    };\n};\nexport type DustAppRunBlockStatusEvent = {\n    type: \"block_status\";\n    content: {\n        block_type: string;\n        name: string;\n        status: \"running\" | \"succeeded\" | \"errored\";\n        success_count: number;\n        error_count: number;\n    };\n};\nexport type DustAppRunBlockExecutionEvent = {\n    type: \"block_execution\";\n    content: {\n        block_type: string;\n        block_name: string;\n        execution: {\n            value: unknown | null;\n            error: string | null;\n            meta: unknown | null;\n        }[][];\n    };\n};\nexport type DustAppRunFinalEvent = {\n    type: \"final\";\n};\nexport type DustAppRunTokensEvent = {\n    type: \"tokens\";\n    content: {\n        block_type: string;\n        block_name: string;\n        input_index: number;\n        map: {\n            name: string;\n            iteration: number;\n        } | null;\n        tokens: {\n            text: string;\n            tokens?: string[];\n            logprobs?: number[];\n        };\n    };\n};\nexport type DustAppRunFunctionCallEvent = {\n    type: \"function_call\";\n    content: {\n        block_type: string;\n        block_name: string;\n        input_index: number;\n        map: {\n            name: string;\n            iteration: number;\n        } | null;\n        function_call: {\n            name: string;\n        };\n    };\n};\nexport type DustAppRunFunctionCallArgumentsTokensEvent = {\n    type: \"function_call_arguments_tokens\";\n    content: {\n        block_type: string;\n        block_name: string;\n        input_index: number;\n        map: {\n            name: string;\n            iteration: number;\n        } | null;\n        tokens: {\n            text: string;\n        };\n    };\n};\nexport type DustAPICredentials = {\n    apiKey: string;\n    workspaceId: string;\n};\ntype PublicPostContentFragmentRequestBody = t.TypeOf<typeof PublicPostContentFragmentRequestBodySchema>;\nexport type DustAPIResponse<T> = Result<T, APIError>;\n/**\n * This help functions process a streamed response in the format of the Dust API for running\n * streamed apps.\n *\n * @param res an HTTP response ready to be consumed as a stream\n */\nexport declare function processStreamedRunResponse(res: Response, logger: LoggerInterface): Promise<Err<{\n    type: string;\n    message: string;\n}> | Ok<{\n    eventStream: AsyncGenerator<DustAppRunErroredEvent | DustAppRunRunStatusEvent | DustAppRunBlockStatusEvent | DustAppRunBlockExecutionEvent | DustAppRunFinalEvent | DustAppRunTokensEvent | DustAppRunFunctionCallEvent | DustAppRunFunctionCallArgumentsTokensEvent, void, unknown>;\n    dustRunId: Promise<string>;\n}>>;\nexport declare class DustAPI {\n    _credentials: DustAPICredentials;\n    _useLocalInDev: boolean;\n    _logger: LoggerInterface;\n    _urlOverride?: string;\n    /**\n     * @param credentials DustAPICrededentials\n     */\n    constructor(credentials: DustAPICredentials, logger: LoggerInterface, { useLocalInDev, urlOverride, }?: {\n        useLocalInDev: boolean;\n        urlOverride?: string;\n    });\n    workspaceId(): string;\n    apiUrl(): string;\n    /**\n     * This functions talks directly to the Dust production API to create a run.\n     *\n     * @param app DustAppType the app to run streamed\n     * @param config DustAppConfigType the app config\n     * @param inputs any[] the app inputs\n     */\n    runApp(app: DustAppType, config: DustAppConfigType, inputs: unknown[], { useWorkspaceCredentials }?: {\n        useWorkspaceCredentials: boolean;\n    }): Promise<DustAPIResponse<RunType>>;\n    /**\n     * This functions talks directly to the Dust production API to create a streamed run.\n     *\n     * @param app DustAppType the app to run streamed\n     * @param config DustAppConfigType the app config\n     * @param inputs any[] the app inputs\n     */\n    runAppStreamed(app: DustAppType, config: DustAppConfigType, inputs: any[], { useWorkspaceCredentials }?: {\n        useWorkspaceCredentials: boolean;\n    }): Promise<Err<{\n        type: string;\n        message: string;\n    }> | Ok<{\n        eventStream: AsyncGenerator<DustAppRunErroredEvent | DustAppRunRunStatusEvent | DustAppRunBlockStatusEvent | DustAppRunBlockExecutionEvent | DustAppRunFinalEvent | DustAppRunTokensEvent | DustAppRunFunctionCallEvent | DustAppRunFunctionCallArgumentsTokensEvent, void, unknown>;\n        dustRunId: Promise<string>;\n    }>>;\n    /**\n     * This actions talks to the Dust production API to retrieve the list of data sources of the\n     * specified workspace id.\n     *\n     * @param workspaceId string the workspace id to fetch data sources for\n     */\n    getDataSources(workspaceId: string): Promise<DustAPIResponse<DataSourceType[]>>;\n    getAgentConfigurations(): Promise<DustAPIResponse<LightAgentConfigurationType[]>>;\n    postContentFragment({ conversationId, contentFragment, }: {\n        conversationId: string;\n        contentFragment: PublicPostContentFragmentRequestBody;\n    }): Promise<DustAPIResponse<ContentFragmentType>>;\n    createConversation({ title, visibility, message, contentFragment, }: t.TypeOf<typeof PublicPostConversationsRequestBodySchema>): Promise<DustAPIResponse<{\n        conversation: ConversationType;\n        message: UserMessageType;\n    }>>;\n    postUserMessage({ conversationId, message, }: {\n        conversationId: string;\n        message: t.TypeOf<typeof PublicPostMessagesRequestBodySchema>;\n    }): Promise<DustAPIResponse<UserMessageType>>;\n    streamAgentMessageEvents({ conversation, message, }: {\n        conversation: ConversationType;\n        message: AgentMessageType;\n    }): Promise<Err<{\n        type: string;\n        message: string;\n    }> | Ok<{\n        eventStream: AsyncGenerator<DustAppRunErroredEvent | UserMessageErrorEvent | AgentErrorEvent | AgentActionSuccessEvent | GenerationTokensEvent | AgentGenerationSuccessEvent, void, unknown>;\n    }>>;\n    getConversation({ conversationId, }: {\n        conversationId: string;\n    }): Promise<DustAPIResponse<ConversationType>>;\n    tokenize(text: string, dataSourceName: string): Promise<DustAPIResponse<CoreAPITokenType[]>>;\n    getActiveMemberEmailsInWorkspace(): Promise<Err<APIError> | Ok<string[]>>;\n    getWorkspaceVerifiedDomains(): Promise<Err<APIError> | Ok<WorkspaceDomain[]>>;\n    private _resultFromResponse;\n}\nexport {};\n//# sourceMappingURL=dust_api.d.ts.map"}}

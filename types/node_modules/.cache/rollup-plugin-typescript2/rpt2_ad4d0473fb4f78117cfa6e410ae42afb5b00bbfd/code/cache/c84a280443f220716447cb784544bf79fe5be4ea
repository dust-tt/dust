{"code":"import { v4 as uuidv4 } from \"uuid\";\nlet once = false;\nexport function setupGlobalErrorHandler(logger) {\n    if (once) {\n        logger.info({}, \"Global error handler already setup\");\n        return;\n    }\n    once = true;\n    process.on(\"unhandledRejection\", (reason, promise) => {\n        // uuid here serves as a correlation id for the console.error and the logger.error.\n        const uuid = uuidv4();\n        // console.log here is important because the promise.catch() below could fail.\n        console.error(\"unhandledRejection\", promise, reason, uuid);\n        promise.catch((error) => {\n            // We'll get the call stack from error only if the promise was rejected with an error object.\n            // Example: new Promise((_, reject) => reject(new Error(\"Some error\")))\n            logger.error({ error, panic: true, uuid, reason }, \"Unhandled Rejection\");\n        });\n    });\n    process.on(\"uncaughtException\", (error) => {\n        logger.error({ error, panic: true }, \"Uncaught Exception\");\n    });\n}\n//# sourceMappingURL=global_error_handler.js.map","references":["/Users/edouardwautier/Projects/dust/types/node_modules/@types/uuid/index.d.ts","/Users/edouardwautier/Projects/dust/types/src/shared/logger.ts"],"map":"{\"version\":3,\"file\":\"global_error_handler.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/shared/utils/global_error_handler.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,EAAE,IAAI,MAAM,EAAE,MAAM,MAAM,CAAC;AAIpC,IAAI,IAAI,GAAG,KAAK,CAAC;AAEjB,MAAM,UAAU,uBAAuB,CAAC,MAAuB;IAC7D,IAAI,IAAI,EAAE;QACR,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,oCAAoC,CAAC,CAAC;QACtD,OAAO;KACR;IACD,IAAI,GAAG,IAAI,CAAC;IACZ,OAAO,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,EAAE;QACnD,mFAAmF;QACnF,MAAM,IAAI,GAAG,MAAM,EAAE,CAAC;QACtB,8EAA8E;QAC9E,OAAO,CAAC,KAAK,CAAC,oBAAoB,EAAE,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAE3D,OAAO,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;YACtB,6FAA6F;YAC7F,uEAAuE;YACvE,MAAM,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,qBAAqB,CAAC,CAAC;QAC5E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC,KAAK,EAAE,EAAE;QACxC,MAAM,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,EAAE,oBAAoB,CAAC,CAAC;IAC7D,CAAC,CAAC,CAAC;AACL,CAAC\"}"}

-- Migration created on Sep 05, 2025
SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'webhook_sources';
SELECT t.typname enum_name, array_agg(e.enumlabel ORDER BY enumsortorder) enum_value FROM pg_type t JOIN pg_enum e ON t.oid = e.enumtypid JOIN pg_catalog.pg_namespace n ON n.oid = t.typnamespace WHERE n.nspname = 'public' AND t.typname='enum_webhook_sources_signatureAlgorithm' GROUP BY 1;
DO 'BEGIN CREATE TYPE "public"."enum_webhook_sources_signatureAlgorithm" AS ENUM(''sha1'', ''sha256'', ''sha512''); EXCEPTION WHEN duplicate_object THEN null; END';
WITH ranges AS (  SELECT pg_range.rngtypid, pg_type.typname AS rngtypname,         pg_type.typarray AS rngtyparray, pg_range.rngsubtype    FROM pg_range LEFT OUTER JOIN pg_type ON pg_type.oid = pg_range.rngtypid)SELECT pg_type.typname, pg_type.typtype, pg_type.oid, pg_type.typarray,       ranges.rngtypname, ranges.rngtypid, ranges.rngtyparray  FROM pg_type LEFT OUTER JOIN ranges ON pg_type.oid = ranges.rngsubtype WHERE (pg_type.typtype IN('b', 'e'));
CREATE TABLE IF NOT EXISTS "webhook_sources" ("createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "name" VARCHAR(255) NOT NULL, "secret" TEXT, "signatureHeader" VARCHAR(255), "signatureAlgorithm" "public"."enum_webhook_sources_signatureAlgorithm", "allowedIPs" VARCHAR(255)[] NOT NULL DEFAULT ARRAY[]::VARCHAR(255)[], "customHeaders" JSONB, "workspaceId" BIGINT NOT NULL REFERENCES "workspaces" ("id") ON DELETE RESTRICT ON UPDATE CASCADE, "id"  BIGSERIAL , PRIMARY KEY ("id"));
SELECT i.relname AS name, ix.indisprimary AS primary, ix.indisunique AS unique, ix.indkey AS indkey, array_agg(a.attnum) as column_indexes, array_agg(a.attname) AS column_names, pg_get_indexdef(ix.indexrelid) AS definition FROM pg_class t, pg_class i, pg_index ix, pg_attribute a WHERE t.oid = ix.indrelid AND i.oid = ix.indexrelid AND a.attrelid = t.oid AND t.relkind = 'r' and t.relname = 'webhook_sources' GROUP BY i.relname, ix.indexrelid, ix.indisprimary, ix.indisunique, ix.indkey ORDER BY i.relname;
CREATE UNIQUE INDEX "webhook_sources_workspace_id_name" ON "webhook_sources" ("workspaceId", "name");

#!/usr/bin/env bash

export DEVBOX_NO_ENVRC_UPDATE=1
export DIRENV_LOG_FORMAT=""

# Load devbox environment
eval "$(devbox shellenv --init-hook --install --no-refresh-alias)"

# Unset DEVELOPER_DIR to allow system git to work properly
unset DEVELOPER_DIR

# Layer 1: Base config (from devbox.json) - already loaded above

# Layer 2: Docker Compose variables
if [ -f .env ]; then
  set -a
  source .env
  set +a
fi

# Layer 3: Local development overrides (non-sensitive)
if [ -f .env.local ]; then
  set -a
  source .env.local
  set +a
fi

# Layer 4: Secrets (sensitive credentials)
if [ -f .env.secrets ]; then
  set -a
  source .env.secrets
  set +a
fi

# Additional environment setup
export PATH="$PWD/node_modules/.bin:$PATH"

echo "üåü Dust development environment activated"
echo "   üìù Loaded: devbox.json ‚Üí .env ‚Üí .env.local ‚Üí .env.secrets"
echo "   Run 'devbox services up' to start all services"
